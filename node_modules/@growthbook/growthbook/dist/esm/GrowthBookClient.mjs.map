{"version":3,"file":"GrowthBookClient.mjs","names":["loadSDKVersion","configureCache","refreshFeatures","startStreaming","unsubscribe","runExperiment","evalFeature","_evalFeature","getAllStickyBucketAssignmentDocs","decryptPayload","getApiHosts","SDK_VERSION","GrowthBookClient","constructor","options","version","_options","debug","ready","_features","_experiments","log","bind","setPayload","payload","_payload","data","decryptionKey","_decryptedPayload","features","experiments","savedGroups","initSync","encryptedExperiments","encryptedFeatures","Error","init","cacheSettings","success","source","res","_refresh","allowStale","getApiInfo","apiHost","getClientKey","clientKey","getPayload","getFeatures","getDecryptedPayload","timeout","skipCache","streaming","instance","disableCache","backgroundSync","getGlobalAttributes","globalAttributes","setGlobalAttributes","attributes","destroy","undefined","runInlineExperiment","experiment","userContext","result","_getEvalContext","user","global","_getGlobalContext","stack","evaluatedFeatures","Set","enabled","qaMode","forcedFeatureValues","forcedVariations","trackingCallback","onFeatureUsage","isOn","key","on","isOff","off","getFeatureValue","defaultValue","value","id","msg","ctx","console","setTrackingCallback","callback","applyStickyBuckets","partialContext","stickyBucketService","stickyBucketAssignmentDocs","saveStickyBucketAssignmentDoc","doc","saveAssignments","createScopedInstance","UserScopedGrowthBook","gb","_gb","_userContext"],"sources":["../../src/GrowthBookClient.ts"],"sourcesContent":["import type {\n  ApiHost,\n  ClientKey,\n  Experiment,\n  FeatureApiResponse,\n  FeatureResult,\n  RefreshFeaturesOptions,\n  Result,\n  WidenPrimitives,\n  EvalContext,\n  InitOptions,\n  InitResponse,\n  InitSyncOptions,\n  GlobalContext,\n  UserContext,\n  ClientOptions,\n  FeatureDefinitions,\n  AutoExperiment,\n  TrackingCallbackWithUser,\n  Attributes,\n} from \"./types/growthbook\";\nimport { loadSDKVersion } from \"./util\";\nimport {\n  configureCache,\n  refreshFeatures,\n  startStreaming,\n  unsubscribe,\n} from \"./feature-repository\";\nimport {\n  runExperiment,\n  evalFeature as _evalFeature,\n  getAllStickyBucketAssignmentDocs,\n  decryptPayload,\n  getApiHosts,\n} from \"./core\";\nimport { StickyBucketService } from \"./sticky-bucket-service\";\n\nconst SDK_VERSION = loadSDKVersion();\n\nexport class GrowthBookClient<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  public debug: boolean;\n  public ready: boolean;\n  public version: string;\n\n  // Properties and methods that start with \"_\" are mangled by Terser (saves ~150 bytes)\n  private _options: ClientOptions;\n\n  private _features: FeatureDefinitions;\n  private _experiments: AutoExperiment[];\n  private _payload: FeatureApiResponse | undefined;\n  private _decryptedPayload: FeatureApiResponse | undefined;\n\n  constructor(options?: ClientOptions) {\n    options = options || {};\n    // These properties are all initialized in the constructor instead of above\n    // This saves ~80 bytes in the final output\n    this.version = SDK_VERSION;\n    this._options = options;\n    this.debug = !!options.debug;\n    this.ready = false;\n    this._features = {};\n    this._experiments = [];\n\n    this.log = this.log.bind(this);\n  }\n\n  public async setPayload(payload: FeatureApiResponse): Promise<void> {\n    this._payload = payload;\n    const data = await decryptPayload(payload, this._options.decryptionKey);\n    this._decryptedPayload = data;\n    if (data.features) {\n      this._features = data.features;\n    }\n    if (data.experiments) {\n      this._experiments = data.experiments;\n    }\n    if (data.savedGroups) {\n      this._options.savedGroups = data.savedGroups;\n    }\n    this.ready = true;\n  }\n\n  public initSync(options: InitSyncOptions): GrowthBookClient<AppFeatures> {\n    const payload = options.payload;\n\n    if (payload.encryptedExperiments || payload.encryptedFeatures) {\n      throw new Error(\"initSync does not support encrypted payloads\");\n    }\n\n    this._payload = payload;\n    this._decryptedPayload = payload;\n    if (payload.features) {\n      this._features = payload.features;\n    }\n    if (payload.experiments) {\n      this._experiments = payload.experiments;\n    }\n\n    this.ready = true;\n\n    startStreaming(this, options);\n\n    return this;\n  }\n\n  public async init(options?: InitOptions): Promise<InitResponse> {\n    options = options || {};\n\n    if (options.cacheSettings) {\n      configureCache(options.cacheSettings);\n    }\n\n    if (options.payload) {\n      await this.setPayload(options.payload);\n      startStreaming(this, options);\n      return {\n        success: true,\n        source: \"init\",\n      };\n    } else {\n      const { data, ...res } = await this._refresh({\n        ...options,\n        allowStale: true,\n      });\n      startStreaming(this, options);\n      await this.setPayload(data || {});\n      return res;\n    }\n  }\n\n  public async refreshFeatures(\n    options?: RefreshFeaturesOptions\n  ): Promise<void> {\n    const res = await this._refresh({\n      ...(options || {}),\n      allowStale: false,\n    });\n    if (res.data) {\n      await this.setPayload(res.data);\n    }\n  }\n\n  public getApiInfo(): [ApiHost, ClientKey] {\n    return [this.getApiHosts().apiHost, this.getClientKey()];\n  }\n  public getApiHosts() {\n    return getApiHosts(this._options);\n  }\n  public getClientKey(): string {\n    return this._options.clientKey || \"\";\n  }\n  public getPayload(): FeatureApiResponse {\n    return (\n      this._payload || {\n        features: this.getFeatures(),\n        experiments: this._experiments || [],\n      }\n    );\n  }\n  public getDecryptedPayload(): FeatureApiResponse {\n    return this._decryptedPayload || this.getPayload();\n  }\n\n  private async _refresh({\n    timeout,\n    skipCache,\n    allowStale,\n    streaming,\n  }: RefreshFeaturesOptions & {\n    allowStale?: boolean;\n    streaming?: boolean;\n  }) {\n    if (!this._options.clientKey) {\n      throw new Error(\"Missing clientKey\");\n    }\n    // Trigger refresh in feature repository\n    return refreshFeatures({\n      instance: this,\n      timeout,\n      skipCache: skipCache || this._options.disableCache,\n      allowStale,\n      backgroundSync: streaming ?? true,\n    });\n  }\n\n  public getFeatures() {\n    return this._features || {};\n  }\n\n  public getGlobalAttributes(): Attributes {\n    return this._options.globalAttributes || {};\n  }\n  public setGlobalAttributes(attributes: Attributes) {\n    this._options.globalAttributes = attributes;\n  }\n\n  public destroy() {\n    unsubscribe(this);\n\n    // Release references to save memory\n    this._features = {};\n    this._experiments = [];\n    this._decryptedPayload = undefined;\n    this._payload = undefined;\n    this._options = {};\n  }\n\n  public runInlineExperiment<T>(\n    experiment: Experiment<T>,\n    userContext: UserContext\n  ): Result<T> {\n    const { result } = runExperiment(\n      experiment,\n      null,\n      this._getEvalContext(userContext)\n    );\n    return result;\n  }\n\n  private _getEvalContext(userContext: UserContext): EvalContext {\n    if (this._options.globalAttributes) {\n      userContext = {\n        ...userContext,\n        attributes: {\n          ...this._options.globalAttributes,\n          ...userContext.attributes,\n        },\n      };\n    }\n\n    return {\n      user: userContext,\n      global: this._getGlobalContext(),\n      stack: {\n        evaluatedFeatures: new Set(),\n      },\n    };\n  }\n\n  private _getGlobalContext(): GlobalContext {\n    return {\n      features: this._features,\n      experiments: this._experiments,\n      log: this.log,\n      enabled: this._options.enabled,\n      qaMode: this._options.qaMode,\n      savedGroups: this._options.savedGroups,\n      forcedFeatureValues: this._options.forcedFeatureValues,\n      forcedVariations: this._options.forcedVariations,\n      trackingCallback: this._options.trackingCallback,\n      onFeatureUsage: this._options.onFeatureUsage,\n    };\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(\n    key: K,\n    userContext: UserContext\n  ): boolean {\n    return this.evalFeature(key, userContext).on;\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(\n    key: K,\n    userContext: UserContext\n  ): boolean {\n    return this.evalFeature(key, userContext).off;\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V, userContext: UserContext): WidenPrimitives<V> {\n    const value = this.evalFeature<WidenPrimitives<V>, K>(key, userContext)\n      .value;\n    return value === null ? (defaultValue as WidenPrimitives<V>) : value;\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K, userContext: UserContext): FeatureResult<V | null> {\n    return _evalFeature(id, this._getEvalContext(userContext));\n  }\n\n  log(msg: string, ctx: Record<string, unknown>) {\n    if (!this.debug) return;\n    if (this._options.log) this._options.log(msg, ctx);\n    else console.log(msg, ctx);\n  }\n\n  public setTrackingCallback(callback: TrackingCallbackWithUser) {\n    this._options.trackingCallback = callback;\n  }\n\n  public async applyStickyBuckets(\n    partialContext: Omit<\n      UserContext,\n      \"stickyBucketService\" | \"stickyBucketAssignmentDocs\"\n    >,\n    stickyBucketService: StickyBucketService\n  ): Promise<UserContext> {\n    const ctx = this._getEvalContext(partialContext);\n\n    const stickyBucketAssignmentDocs = await getAllStickyBucketAssignmentDocs(\n      ctx,\n      stickyBucketService\n    );\n\n    const userContext: UserContext = {\n      ...partialContext,\n      stickyBucketAssignmentDocs,\n      saveStickyBucketAssignmentDoc: (doc) =>\n        stickyBucketService.saveAssignments(doc),\n    };\n\n    return userContext;\n  }\n\n  public createScopedInstance(userContext: UserContext) {\n    return new UserScopedGrowthBook(this, userContext);\n  }\n}\n\nexport class UserScopedGrowthBook<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  AppFeatures extends Record<string, any> = Record<string, any>\n> {\n  private _gb: GrowthBookClient;\n  private _userContext: UserContext;\n\n  constructor(gb: GrowthBookClient<AppFeatures>, userContext: UserContext) {\n    this._gb = gb;\n    this._userContext = userContext;\n  }\n\n  public runInlineExperiment<T>(experiment: Experiment<T>): Result<T> {\n    return this._gb.runInlineExperiment(experiment, this._userContext);\n  }\n\n  public isOn<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this._gb.isOn(key, this._userContext);\n  }\n\n  public isOff<K extends string & keyof AppFeatures = string>(key: K): boolean {\n    return this._gb.isOff(key, this._userContext);\n  }\n\n  public getFeatureValue<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(key: K, defaultValue: V): WidenPrimitives<V> {\n    return this._gb.getFeatureValue(key, defaultValue, this._userContext);\n  }\n\n  public evalFeature<\n    V extends AppFeatures[K],\n    K extends string & keyof AppFeatures = string\n  >(id: K): FeatureResult<V | null> {\n    return this._gb.evalFeature(id, this._userContext);\n  }\n}\n"],"mappings":"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"}