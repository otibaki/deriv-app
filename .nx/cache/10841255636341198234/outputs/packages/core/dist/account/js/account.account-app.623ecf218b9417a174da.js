"use strict";(self.webpackChunk_deriv_account=self.webpackChunk_deriv_account||[]).push([["account-app"],{"./App.tsx":(e,t,i)=>{i.r(t),i.d(t,{default:()=>pa});var a=i("react-router"),o=i("@deriv/stores"),s=i("react"),n=i.n(s),r=i("react-router-dom"),l=i("@deriv/shared"),c=i("@deriv/translations"),d=i("../../../node_modules/clsx/dist/clsx.mjs"),_=i("formik"),u=i("@deriv/api"),m=i("@deriv/components"),p=i("@deriv/hooks"),f=i("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),h=i("./Components/form-body/index.ts"),x=i("./Components/form-footer/index.ts"),g=i("./Components/form-sub-header/index.ts"),b=i("./Components/forms/form-fields/index.ts"),y=i("@deriv-com/translations"),j=i("../../../node_modules/react/jsx-runtime.js");const v=e=>{let{required:t,account_opening_reason_list:i,setFieldValue:a,disabled:o,fieldFocused:s,is_modal:r}=e;const{isDesktop:l}=(0,f.Y)(),{localize:c}=(0,y.useTranslations)();return(0,j.jsx)(n().Fragment,{children:(0,j.jsx)(_.Field,{name:"account_opening_reason",children:e=>{let{field:n,meta:_}=e;return(0,j.jsx)("div",{className:"account-form__fieldset",id:"account-opening-reason",children:l?(0,j.jsx)(m.Dropdown,{placeholder:c(t?"Account opening reason*":"Account opening reason"),...n,disabled:o,is_align_text_left:!0,list:i,error:_.touched&&_.error?_.error:"",required:!0,className:(0,d.A)({"focus-field":s}),list_portal_id:r?"modal_root":""}):(0,j.jsx)(m.SelectNative,{placeholder:c("Please select"),...n,label:c(t?"Account opening reason*":"Account opening reason"),list_items:i,error:_.touched&&_.error?_.error:"",onChange:e=>{n.onChange(e),a("account_opening_reason",e.target.value,!0)},required:!0,data_testid:"account_opening_reason_mobile",disabled:o,className:(0,d.A)({"focus-field":s})})})}})})},z=e=>{let{label:t,name:i,required:a=!1,disabled:o=!1,list_items:n,onItemSelection:r,placeholder:l,list_height:c,is_country_code_dropdown:d=!1}=e;const{isDesktop:u}=(0,f.Y)(),p=(e,t)=>i=>{let{value:a,text:o}=i;t(e,(a&&o)??"",!0)};return(0,j.jsx)(_.Field,{name:i,children:e=>{let{field:i,meta:{touched:_,error:f},form:{setFieldValue:h}}=e;return(0,j.jsx)(s.Fragment,{children:u?(0,j.jsx)(m.Autocomplete,{...i,disabled:o,label:t,list_items:n,placeholder:l,required:a,"data-lpignore":"true",autoComplete:"new-password",error:_?f:void 0,onItemSelection:r??p(i.name,h),"data-testid":`dt_${i.name}`,list_height:c}):(0,j.jsx)(m.SelectNative,{...i,list_items:n,label:t,required:a,disabled:o,error:_?f:void 0,use_text:!0,is_country_code_dropdown:d,"data-testid":`dt_${i.name}`})})}})};var w=i("./Components/leave-confirm/index.ts"),S=i("./Components/load-error-message/index.ts");const k=()=>{const e=(0,s.useRef)(null);return(0,s.useEffect)((()=>{setTimeout((()=>e?.current?.scrollIntoView()),0)}),[]),(0,j.jsx)("div",{className:"poa-address-mismatch-hint-box--wrapper",ref:e,children:(0,j.jsx)(m.InlineMessage,{type:"warning",size:"xs",message:(0,j.jsx)(c.Localize,{i18n_default_text:"It appears that the address in your document doesn’t match the address in your Deriv profile. Please update your personal details now with the correct address."})})})};var N=i("./Helpers/utils.tsx");const C=(0,o.observer)((e=>{let{editable_fields:t,parent_ref:i,should_display_long_message:a,tin_validation_config:n,handleChange:r,should_focus_fields:c}=e;const{values:d,setFieldValue:u,touched:h,errors:x,setValues:g}=(0,_.useFormikContext)(),{isDesktop:v}=(0,f.Y)(),{data:z}=(0,p.useResidenceList)(),{client:w}=(0,o.useStore)(),{is_virtual:S,account_settings:k,account_status:C}=w,{tin_employment_status_bypass:I,is_tin_mandatory:T}=n,L=!!S||Boolean(C?.status?.includes("mt5_additional_kyc_required")),A=!S&&d.employment_status&&!I?.includes(d.employment_status)&&L,[D,P]=(0,s.useState)(!1),[E,F]=(0,s.useState)(!1),R=(0,s.useRef)(null),O=(0,s.useRef)(null),M=e=>{const t=e?.target;return"A"===t.tagName?(e?.stopPropagation(),!1):!R.current?.contains(t)&&!O.current?.contains(t)},U=()=>{P(!1),F(!1)};(0,s.useEffect)((()=>{if(d.tax_residence){const e=z.find((e=>e.text===d.tax_residence))?.value;e&&r(e)}}),[r,d.tax_residence,z]),(0,s.useEffect)((()=>{d.tax_residence&&d.tax_identification_number||u("tax_identification_confirm",!1,!0)}),[d.tax_residence,d.tax_identification_number,u]),(0,s.useEffect)((()=>{const e=i?.current;return e&&e.addEventListener("scroll",U),()=>{e&&e.removeEventListener("scroll",U),P(!1),F(!1)}}),[i]),(0,s.useEffect)((()=>{n&&u("tax_identification_number",d.tax_identification_number,!0)}),[n,u,d.tax_identification_number]),(0,s.useEffect)((()=>{h.tax_identification_number&&d.tax_identification_number&&u("tin_skipped",0,!0)}),[d.tax_identification_number,u,h.tax_identification_number]);const q=(0,s.useMemo)((()=>(0,N.dS)("tax_identification_number",t)&&(0,N.dS)("tax_residence",t)||!d.tax_identification_number||!d.tax_residence||!!d.tin_skipped),[t,d.tax_identification_number,d.tax_residence,d.tin_skipped]);(0,m.useOnClickOutside)(R,(()=>P(!1)),M),(0,m.useOnClickOutside)(O,(()=>F(!1)),M);const B=I?.includes(d.employment_status)&&!!d.tax_residence||Boolean(d.tin_skipped),Y=!k.tax_identification_number||h.tax_identification_number,V=e=>(0,N.dS)(e,t);return(0,j.jsxs)("div",{id:"employment-tax-section",children:[(0,j.jsx)(b.bE,{required:L,is_disabled:V("employment_status"),fieldFocused:c&&!k.employment_status}),!k.tax_identification_number&&B&&(0,j.jsx)(m.Checkbox,{name:"tin_skipped",className:"employment_tax_detail_field-checkbox","data-lpignore":!0,onChange:()=>{const e=d.tin_skipped?0:1;g({...d,tin_skipped:e,tax_identification_number:"",tax_identification_confirm:!1},!0)},value:d.tin_skipped,label:(0,j.jsx)(y.Localize,{i18n_default_text:"I do not have tax information"}),withTabIndex:0,"data-testid":"tin_skipped",label_font_size:v?"xs":"xxs",label_line_height:"m"}),(0,j.jsx)("div",{ref:R,className:"account-form__fieldset",children:(0,j.jsx)(b.Oz,{disabled:V("tax_residence")||d.tin_skipped&&!k.tin_skipped,is_tax_residence_popover_open:D,setIsTaxResidencePopoverOpen:P,setIsTinPopoverOpen:F,required:a&&!d.tin_skipped||A,fieldFocused:c&&(!k.tax_residence||!k.residence)})}),(0,j.jsx)("div",{ref:O,className:"account-form__fieldset",children:(0,j.jsx)(b.t$,{disabled:V("tax_identification_number")||d.tin_skipped&&!k.tin_skipped,is_tin_popover_open:E,setIsTinPopoverOpen:F,setIsTaxResidencePopoverOpen:P,required:a&&!d.tin_skipped||A&&T,fieldFocused:c&&d.employment_status&&!d.tin_skipped&&(a||A)})}),Y&&(0,j.jsx)(m.Checkbox,{name:"tax_identification_confirm",className:"employment_tax_detail_field-checkbox","data-lpignore":!0,onChange:()=>u("tax_identification_confirm",!d.tax_identification_confirm,!0),value:d.tax_identification_confirm,label:a?(0,j.jsx)(y.Localize,{i18n_default_text:"I hereby confirm that the tax information provided is true and complete. I will also inform {{legal_entity_name}} about any changes to this information.",values:{legal_entity_name:(0,l.getLegalEntityName)("maltainvest")}}):(0,j.jsx)(y.Localize,{i18n_default_text:"I confirm that my tax information is accurate and complete."}),withTabIndex:0,"data-testid":"tax_identification_confirm",has_error:!(!h.tax_identification_confirm||!x.tax_identification_confirm),label_font_size:v?"xs":"xxs",label_line_height:"m",disabled:q})]})})),I=e=>{const{client:t}=(0,o.useStore)(),{is_authorize:i}=t,{data:a,...s}=(0,u.useQuery)("kyc_auth_status",{payload:e,options:{enabled:i}});return{kyc_auth_status:a?.kyc_auth_status,...s}},T=[{text:(0,c.localize)("Speculative"),value:"Speculative"},{text:(0,c.localize)("Income Earning"),value:"Income Earning"},{text:(0,c.localize)("Hedging"),value:"Hedging"}],L=e=>{let{children:t,className:i}=e;return(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)("div",{className:i,children:t})})};var A=i("../../../node_modules/yup/es/index.js"),D=i("../../../node_modules/dayjs/dayjs.min.js"),P=i.n(D),E=i("@deriv-com/utils");const{taxIdentificationNumber:F,address:R,addressCity:O,addressState:M,postalCode:U,phoneNumber:q,name:B,postalOfficeBoxNumber:Y}=E.ValidationConstants.patterns,{addressPermittedSpecialCharacters:V}=E.ValidationConstants.messagesHints;A.Zg(A.Yj,"validatePhoneNumberLength",(function(e,t){return this.test("is-valid-phone-number-length",e||(0,y.localize)("You should enter 9-20 numbers."),(e=>{if("string"==typeof e){const i=e.startsWith("+")?e.slice(1):e;return t?/^[0-9]{5,15}$/.test(i):/^[0-9]{9,20}$/.test(i)}return!1}))}));const $=/^[0-9]{5,15}$/,W=e=>{let{tin_config:t,is_mf:i=!1,is_real:a=!1,is_tin_auto_set:o=!1,is_duplicate_account:s=!1,is_employment_status_tin_mandatory:n=!1}=e;return A.Ik({employment_status:A.Yj().when("is_employment_status_tin_mandatory",{is:()=>n,then:A.Yj().required((0,y.localize)("Employment status is required.")),otherwise:A.Yj().notRequired()}),tax_residence:A.Yj().when("is_mf",{is:()=>i,then:A.Yj().required((0,y.localize)("Tax residence is required.")),otherwise:A.Yj().notRequired()}),tin_skipped:A.ai().oneOf([0,1]).default(0),tax_identification_confirm:A.lc().when(["tax_identification_number","tax_residence","tin_skipped"],{is:(e,t,i)=>e&&t&&!i&&!s,then:A.lc().required().oneOf([!0]),otherwise:A.lc().notRequired()}),tax_identification_number:A.Yj().when(["tin_skipped"],{is:e=>(e=>{let{is_mf:t,is_real:i,tin_skipped:a,is_tin_auto_set:o,is_employment_status_tin_mandatory:s,is_required_for_tax_residence:n}=e;const r=a&&!o;return i?!(!o||s&&n)||r||!(s&&n):!t||r})({is_mf:i,is_real:a,tin_skipped:e,is_tin_auto_set:o,is_employment_status_tin_mandatory:n,is_required_for_tax_residence:Boolean(t?.is_tin_mandatory)}),then:A.Yj().notRequired(),otherwise:A.Yj().required((0,y.localize)("Tax identification number is required."))}).max(25,(0,y.localize)("Tax identification number can't be longer than 25 characters.")).matches(F,{excludeEmptyString:!0,message:(0,y.localize)("Only letters, numbers, space, hyphen, period, and forward slash are allowed.")}).test({name:"validate-tin",test:(e,i)=>{const{tax_residence:a}=i.parent;return e&&!a?i.createError({message:(0,y.localize)("Please fill in tax residence.")}):e&&t?.tin_format?.length&&!t?.tin_format?.some((t=>new RegExp(t).test(e)))?i.createError({message:(0,y.localize)("Tax identification number is not properly formatted.")}):!(e&&t?.invalid_patterns?.length&&t?.invalid_patterns?.some((t=>new RegExp(t).test(e))))||i.createError({message:(0,y.localize)("Tax identification number is not properly formatted.")})}})})},H=(e,t,i,a)=>{if(a&&e.email_consent)return{email_consent:e.email_consent};const o=e;return delete o.is_carriers_available,o.residence&&delete o.residence,o.first_name&&(o.first_name=o.first_name.trim()),o.last_name&&(o.last_name=o.last_name.trim()),o.date_of_birth&&(o.date_of_birth=(0,l.toMoment)(o.date_of_birth).format("YYYY-MM-DD")),o.tax_residence&&(o.tax_residence=(0,l.getLocation)(t,o.tax_residence,"value")),o.tax_identification_number&&(o.tax_identification_number=o.tax_identification_number.trim()),o.citizen&&(o.citizen=(0,l.getLocation)(t,o.citizen,"value")),o.place_of_birth?o.place_of_birth=(0,l.getLocation)(t,o.place_of_birth,"value"):delete o.place_of_birth,o.address_state&&(o.address_state=i.length?(0,l.getLocation)(i,o.address_state,"value"):o.address_state),delete o.tax_identification_confirm,o},G=(e,t,i,a,o,s,n)=>{if(e)return A.Ik();const r=((e,t)=>A.Ik({salutation:A.Yj().when({is:()=>!1,then:A.Yj().required((0,y.localize)("Salutation is required."))}),account_opening_reason:A.Yj().required((0,y.localize)("Account opening reason is required.")),first_name:A.Yj().required((0,y.localize)("First name is required.")).max(50,(0,y.localize)("Enter no more than 50 characters.")).matches(B,(0,y.localize)("Letters, spaces, periods, hyphens, apostrophes only.")),last_name:A.Yj().required((0,y.localize)("Last name is required.")).max(50,(0,y.localize)("Enter no more than 50 characters.")).matches(B,(0,y.localize)("Letters, spaces, periods, hyphens, apostrophes only.")),date_of_birth:A.Yj().required("Date of birth is required.").test({name:"validate_dob",test:e=>P()(e).isValid()&&P()(e).isBefore(P()().subtract(18,"years")),message:(0,y.localize)("You must be 18 years old and above.")}),phone:A.Yj().required((0,y.localize)("Phone is required.")).validatePhoneNumberLength(t?(0,y.localize)("You should enter 5-15 numbers."):(0,y.localize)("You should enter 9-20 numbers."),t).matches(t?$:q,(0,y.localize)("Please enter a valid phone number (e.g. +15417541234).")),...t&&{calling_country_code:A.Yj().required((0,y.localize)("Code required."))},place_of_birth:A.Yj().required((0,y.localize)("Place of birth is required.")),citizen:A.Yj().required((0,y.localize)("Citizenship is required."))}))(0,!!n).pick(["first_name","last_name","phone",...n?["calling_country_code"]:[],"date_of_birth","citizen"]),l=(e=>A.Ik({address_city:A.Yj().required((0,y.localize)("City is required")).max(99,(0,y.localize)("Only 99 characters, please.")).matches(O,(0,y.localize)("Only letters, periods, hyphens, apostrophes, and spaces, please.")),address_line_1:A.Yj().required((0,y.localize)("First line of address is required")).max(70,(0,y.localize)("Only 70 characters, please.")).matches(R,`${(0,y.localize)("Use only the following special characters:")} ${V}`).when({is:()=>e,then:A.Yj().test("po_box",(0,y.localize)("P.O. Box is not accepted in address"),(e=>!Y.test(e??"")))}),address_line_2:A.Yj().max(70,(0,y.localize)("Only 70 characters, please.")).matches(R,`${(0,y.localize)("Use only the following special characters:")} ${V}`).when({is:()=>e,then:A.Yj().test("po_box",(0,y.localize)("P.O. Box is not accepted in address"),(e=>!Y.test(e??"")))}),address_postcode:A.Yj().max(20,(0,y.localize)("Please enter a postal/ZIP code under 20 characters.")).matches(U,(0,y.localize)("Only letters, numbers, space and hyphen are allowed.")),address_state:A.Yj().matches(M,(0,y.localize)("State is not in a proper format"))}))(t??!1),c=W({tin_config:i,is_mf:!t,is_real:!e,is_tin_auto_set:a,is_duplicate_account:o?.includes("tax_identification_number")||o?.includes("tax_residence"),is_employment_status_tin_mandatory:s});return r.concat(l).concat(c)},J=(0,o.observer)((e=>{let{is_verify_button_disabled:t,next_email_otp_request_timer:i,setStatus:n,values:r,residence_list:c,states_list:d}=e;const{client:_,ui:u}=(0,o.useStore)(),{setShouldShowPhoneNumberOTP:f}=u,{setVerificationCode:h,is_authorize:x,is_virtual:g}=_,{is_phone_number_verified:b}=(0,p.useIsPhoneNumberVerified)(),v=(0,a.useHistory)(),{localize:z}=(0,y.useTranslations)(),{refetch:w,mutation:{mutateAsync:S,isLoading:k}}=(0,p.useSettings)(),{sendPhoneNumberVerifyEmail:N,WS:C,is_loading:I,error:T}=(0,p.useVerifyEmail)("phone_number_verification"),L=(0,s.useRef)(null);return(0,s.useEffect)((()=>{x&&w()}),[x,w]),(0,s.useEffect)((()=>{C.isSuccess?v.push(l.routes.phone_verification):T&&n({msg:T.message,code:T.code})}),[C.isSuccess,v,T]),(0,j.jsx)("div",{ref:L,children:(0,j.jsx)(m.Button,{className:"phone-verification-button",is_disabled:b||t||k||I||!!i,onClick:e=>{e.preventDefault(),localStorage.setItem("routes_from_notification_to_pnv",l.routes.personal_details),h("","phone_number_verification"),f(!1);const t=H({...r},c,d,g);S({payload:t}).then((()=>{N()})).catch((e=>{n({msg:e.message,code:e.code})}))},has_effect:!0,green:b,primary:!0,large:!0,children:b?(0,j.jsx)(y.Localize,{i18n_default_text:"Verified"}):(0,j.jsx)(y.Localize,{i18n_default_text:"Verify{{resendCode}}",values:{resendCode:(()=>{let e="";return e=i?i<60?`${z(" in ")}${i}s`:`${z(" in ")}${Math.round(i/60)}m`:"",e})()}})})})})),K=(0,o.observer)((()=>{const{isDesktop:e}=(0,f.Y)(),[t,i]=(0,s.useState)(!1),[n,r]=(0,s.useState)(!1),[y,I]=(0,s.useState)(!1),A=(0,u.useInvalidateQuery)(),D=(0,a.useHistory)(),[P,E]=(0,p.useGrowthbookGetFeatureValue)({featureFlag:"phone_number_verification"}),[F,R]=(0,p.useGrowthbookGetFeatureValue)({featureFlag:"enable_country_code_dropdown"}),{next_email_otp_request_timer:O,is_email_otp_timer_loading:M}=(0,p.usePhoneNumberVerificationSetTimer)(),{tin_validation_config:U,mutate:q}=(0,p.useTinValidations)(),B=(0,s.useCallback)((function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e&&t&&e.scrollTo({top:t.offsetTop-i,behavior:"smooth"})}),[]),{client:Y,ui:V,notifications:$,common:{is_language_changing:W}}=(0,o.useStore)(),{is_phone_number_verified:K}=(0,p.useIsPhoneNumberVerified)(),{account_settings:Q,account_status:Z,authentication_status:X,is_virtual:ee,current_landing_company:te,updateAccountStatus:ie,fetchAccountSettings:ae,residence:oe,is_svg:se,is_mf_account:ne}=Y,{field_ref_to_focus:re,setFieldRefToFocus:le}=V,{data:ce,isLoading:de}=(0,p.useResidenceList)(),{is_global_sms_available:_e,is_global_whatsapp_available:ue,legacy_core_countries_list:me,selected_phone_code:pe,selected_country_list:fe,updatePhoneSettings:he}=(0,p.useGetPhoneNumberList)(),{data:xe,isLoading:ge}=(0,p.useStatesList)(oe),{refreshNotifications:be,showPOAAddressMismatchSuccessNotification:ye,showPOAAddressMismatchFailureNotification:je}=$,ve=Z?.status?.includes("poa_address_mismatch"),[ze,we]=(0,s.useState)({show_form:!0}),Se=(0,s.useRef)(),ke=(0,s.useRef)(null),[Ne,Ce]=(0,s.useState)({is_timeout_started:!1,timeout_callback:()=>null});(0,s.useEffect)((()=>{ae()}),[ae]);const Ie=ge||t||de||!E||!R;(0,s.useEffect)((()=>{W&&(i(!0),(async()=>{try{await l.WS.wait("get_settings"),await A("residence_list"),await A("states_list")}finally{i(!1)}})())}),[A,W]),(0,s.useEffect)((()=>()=>clearTimeout(Se.current)),[]),(0,s.useEffect)((()=>{let e;return Ne.is_timeout_started&&(e=setTimeout((()=>{I(!1),Ce({is_timeout_started:!1,timeout_callback:()=>I(!1)})}),3e3)),()=>{clearTimeout(e)}}),[Ne.is_timeout_started]);const Te=e=>we({show_form:e}),Le=e=>!!Q?.immutable_fields?.includes(e),Ae=(0,s.useMemo)((()=>{const e=["employment_status","tax_identification_number"].filter((e=>(0,N.dS)(e,Q?.immutable_fields)));return Q?.tax_residence||e.push("tax_residence"),e}),[Q?.immutable_fields,Q?.tax_residence]),{api_error:De,show_form:Pe}=ze,Ee=(0,s.useRef)();if((0,s.useLayoutEffect)((()=>(!re||Ie||De||(Ee.current=setTimeout((()=>{const t=e?document.querySelector(".account-form__personal-details .dc-themed-scrollbars"):document.querySelector(".account__scrollbars_container--grid-layout"),i=document.getElementById(re);B(t,i,24)}),0)),()=>{re&&clearTimeout(Ee.current)})),[re,e,Ie,De,B,le]),(0,s.useEffect)((()=>()=>{le(null)}),[le]),De)return(0,j.jsx)(S.A,{error_message:De});if(Ie)return(0,j.jsx)(m.Loading,{is_fullscreen:!1,className:"account__initial-loader"});const Fe=X?.document_status===l.AUTH_STATUS_CODES.VERIFIED,Re=X?.identity_status===l.AUTH_STATUS_CODES.VERIFIED,Oe=Fe&&Re,Me=F?Q.phone?.replace(/\D/g,""):`+${Q.phone?.replace(/\D/g,"")}`,Ue=Boolean(Q?.tin_skipped),qe=Boolean(Z?.status?.includes("mt5_additional_kyc_required")),Be=G(ee,se,U,Ue,Q?.immutable_fields,qe,F),Ye=e=>"PhoneNumberTaken"===e?.code?(0,j.jsx)(m.FormSubmitErrorMessage,{message:(0,j.jsx)(c.Localize,{i18n_default_text:"Number already exists in our system. Enter a new one or contact us via <0></0> for help",components:[(0,j.jsx)(m.OpenLiveChatLink,{text_size:"xxs"},0)]}),text_color:"loss-danger",weight:"none"}):(0,j.jsx)(m.FormSubmitErrorMessage,{message:e?.msg}),Ve=((e,t,i,a,o,s,n)=>{const r={email_consent:e.email_consent??0,residence:e.residence};if(a)return r;const c={...r,address_city:e.address_city,address_line_1:e.address_line_1,address_line_2:e.address_line_2??"",address_postcode:e.address_postcode??"",address_state:"",...n&&{calling_country_code:e.calling_country_code||o},...n&&{is_carriers_available:s},date_of_birth:(0,l.formatDate)(e.date_of_birth,"YYYY-MM-DD"),first_name:e.first_name,last_name:e.last_name,phone:n?e.phone?.replace(/\D/g,""):`+${e.phone?.replace(/\D/g,"")}`,account_opening_reason:e.account_opening_reason,employment_status:e?.employment_status,tax_residence:(e?.tax_residence?t.find((t=>t.value===e?.tax_residence))?.text:e?.residence)||""};return["citizen","place_of_birth","tax_residence"].forEach((i=>{var a;a=i,Object.keys(e).includes(a)&&e[i]&&(c[i]=(0,l.getLocation)(t,e[i],"text"))})),e?.tin_skipped?(c.tin_skipped=e.tin_skipped,c.tax_identification_number=""):c.tax_identification_number=e.tax_identification_number??"",e.address_state&&(c.address_state=i.length?(0,l.getLocation)(i,e.address_state,"text"):e.address_state),e.request_professional_status&&(c.request_professional_status=e.request_professional_status),e.tax_residence&&e.tax_identification_number&&!e.tin_skipped?c.tax_identification_confirm=!0:c.tax_identification_confirm=!1,c})(Q,ce,xe,ee,pe,(()=>{const e=fe?.carriers&&(fe?.carriers).includes("sms")&&_e,t=fe?.carriers&&(fe?.carriers).includes("whatsapp")&&ue;return e||t})(),F);return(0,j.jsx)(_.Formik,{initialValues:Ve,enableReinitialize:!0,onSubmit:async(e,t)=>{let{setStatus:i,setSubmitting:a}=t;i({msg:""});const o=H({...e},ce,xe,ee);r(!0);const s=await l.WS.authorized.setSettings(o);if(s.error)i({msg:s.error.message,code:s.error.code}),r(!1),a(!1);else{Se.current=setTimeout((()=>{s.set_settings.notification?ye():ve&&je()}),2e3);const e=await l.WS.authorized.storage.getSettings();if(e.error)return void we((t=>({...t,api_error:e.error.message})));he(),ie(),be(),r(!1),I(!0),Ce({is_timeout_started:!0,timeout_callback:()=>{a(!1)}});const t=window.location.search,i=new URLSearchParams(t);if(i.get("from")){const e=i.get("from");D.push(l.routes[e])}}},validationSchema:Be,children:t=>{let{values:i,errors:a,setStatus:o,status:r,handleChange:u,handleBlur:p,handleSubmit:f,isSubmitting:S,isValid:N,setFieldValue:I,setFieldTouched:A,dirty:D}=t;return(0,j.jsxs)(s.Fragment,{children:[(0,j.jsx)(w.A,{onDirty:e?void 0:Te}),Pe&&(0,j.jsxs)(_.Form,{noValidate:!0,className:"account-form account-form__personal-details",onSubmit:f,"data-testid":"dt_account_personal_details_section",children:[(0,j.jsxs)(h.A,{scroll_offset:e?"80px":"199px",children:[(0,j.jsx)(g.A,{title:(0,c.localize)("Details")}),!ee&&(0,j.jsxs)(s.Fragment,{children:[e?(0,j.jsxs)(L,{className:"account-form__fieldset--2-cols",children:[(0,j.jsx)(m.Input,{"data-lpignore":"true",type:"text",name:"first_name",label:(0,c.localize)("First name*"),value:i.first_name,onChange:u,onBlur:p,required:!0,disabled:Le("first_name"),error:a.first_name,id:"first_name","data-testid":"dt_first_name"}),(0,j.jsx)(m.Input,{id:"last_name","data-lpignore":"true",type:"text",name:"last_name",label:(0,c.localize)("Last name*"),value:i.last_name,onChange:u,onBlur:p,required:!0,disabled:Le("last_name"),error:a.last_name,"data-testid":"dt_last_name"})]}):(0,j.jsxs)(s.Fragment,{children:[(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(m.Input,{"data-lpignore":"true",type:"text",name:"first_name",id:"first_name_mobile",label:(0,c.localize)("First name*"),value:i.first_name,onChange:u,onBlur:p,required:!0,disabled:Le("first_name"),error:a.first_name,"data-testid":"dt_first_name"})}),(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(m.Input,{"data-lpignore":"true",type:"text",name:"last_name",id:"last_name_mobile",label:(0,c.localize)("Last name*"),value:i.last_name,onChange:u,onBlur:p,required:!0,disabled:Le("last_name"),error:a.last_name,"data-testid":"dt_last_name"})})]}),"place_of_birth"in i&&(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(z,{label:(0,c.localize)("Place of birth"),name:"place_of_birth",list_items:ce,disabled:Le("place_of_birth")})}),(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(b.XU,{name:"date_of_birth",label:(0,c.localize)("Date of birth*"),id:"birth_day",disabled:Le("date_of_birth"),portal_id:"",value:i.date_of_birth})}),(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(z,{label:(0,c.localize)("Citizenship*"),name:"citizen",list_items:ce,disabled:Le("citizen")})})]}),(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(m.Input,{"data-lpignore":"true",type:"text",name:"residence",id:"residence",label:(0,c.localize)("Country of residence*"),value:i.residence,required:!0,disabled:Le("residence"),error:a.residence,onChange:u})}),!ee&&(0,j.jsxs)(s.Fragment,{children:[(0,j.jsxs)("fieldset",{className:"account-form__fieldset",children:[(0,j.jsxs)("div",{className:(0,d.A)("account-form__fieldset--phone_container",{"account-form__fieldset--phone_container--verified":K,"account-form__fieldset--phone_container--with-1-field":!F}),children:[(0,j.jsxs)("div",{className:"account-form__fieldset--phone_input",children:[F&&(0,j.jsx)(z,{label:(0,c.localize)("Code*"),name:"calling_country_code",list_items:me,is_country_code_dropdown:!0,onItemSelection:e=>{I("calling_country_code",e.value,!0);const t=e.carriers&&e.carriers.includes("sms")&&_e,i=e.carriers&&e.carriers.includes("whatsapp")&&ue;I("is_carriers_available",t||i,!0)},disabled:Le("calling_country_code")||!!O||M}),(0,j.jsx)(m.Input,{"data-lpignore":"true",type:"text",inputMode:"numeric",name:"phone",id:"phone",label:(0,c.localize)("Phone number*"),value:i.phone,className:"account-form__fieldset--phone-number-input",onChange:e=>{let t=e.target.value.replace(/\D/g,"");F||(t=0===t.length?"+":`+${t}`),I("phone",t,!0),o("")},onBlur:p,required:!0,error:a.phone,disabled:Le("phone")||!!O||M,"data-testid":"dt_phone"})]}),P&&(0,j.jsx)(J,{is_verify_button_disabled:Le("phone")||!N||!Me||M||F&&!i.is_carriers_available,values:i,residence_list:ce,states_list:xe,next_email_otp_request_timer:O,setStatus:o})]}),K&&(0,j.jsx)("div",{className:"account-form__fieldset--phone_container--verified-hint",children:(0,j.jsx)(m.Text,{as:"p",color:"less-prominent",size:"xxs",children:P?K?(0,j.jsx)(c.Localize,{i18n_default_text:"To change your verified phone number, contact us via <0></0>.",components:[(0,j.jsx)(m.OpenLiveChatLink,{text_size:"xxs",className:"account-form__fieldset--phone-verification-livechat-link"},0)]}):void 0:null})})]}),(0,j.jsx)(v,{account_opening_reason_list:T,setFieldValue:I,disabled:Le("account_opening_reason")||Boolean(Q?.account_opening_reason),required:!0,fieldFocused:!Q.account_opening_reason&&"account-opening-reason"===re})]}),!ee&&(0,j.jsxs)("div",{className:"employment-tin-section",children:[(0,j.jsx)(g.A,{title:(0,c.localize)("Employment and tax information")}),(0,j.jsx)(C,{editable_fields:Ae,parent_ref:ke,handleChange:q,tin_validation_config:U,should_display_long_message:ne,should_focus_fields:"employment-tax-section"===re}),ve&&(0,j.jsx)(k,{}),(0,j.jsx)(g.A,{title:(0,c.localize)("Address")}),(0,j.jsxs)("div",{className:"account-address__details-section",children:[(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(m.Input,{"data-lpignore":"true",autoComplete:"off",type:"text",maxLength:70,name:"address_line_1",id:"address_line_1",label:(0,c.localize)("First line of address*"),value:i.address_line_1,onChange:u,onBlur:p,error:a.address_line_1,required:!0,disabled:Le("address_line_1"),"data-testid":"dt_address_line_1"})}),(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(m.Input,{"data-lpignore":"true",autoComplete:"off",type:"text",maxLength:70,name:"address_line_2",id:"address_line_2",label:(0,c.localize)("Second line of address (optional)"),value:i.address_line_2,error:a.address_line_2,onChange:u,onBlur:p,required:!0,disabled:Le("address_line_2")})}),(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(m.Input,{"data-lpignore":"true",autoComplete:"off",type:"text",name:"address_city",id:"address_city",label:(0,c.localize)("Town/City*"),value:i.address_city,error:a.address_city,onChange:u,onBlur:p,required:!0,disabled:Le("address_city"),"data-testid":"dt_address_city"})}),(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:xe.length?(0,j.jsx)(z,{label:(0,c.localize)("State/Province (optional)"),name:"address_state",list_items:xe,disabled:Le("address_state")}):(0,j.jsx)(m.Input,{"data-lpignore":"true",autoComplete:"off",type:"text",name:"address_state",id:"address_state",label:(0,c.localize)("State/Province (optional)"),value:i.address_state,error:a.address_state,onChange:u,onBlur:p,disabled:Le("address_state")})}),(0,j.jsx)("fieldset",{className:"account-form__fieldset",children:(0,j.jsx)(m.Input,{"data-lpignore":"true",autoComplete:"off",type:"text",name:"address_postcode",id:"address_postcode",label:(0,c.localize)("Postal/ZIP code"),value:i.address_postcode,error:a.address_postcode,onChange:u,onBlur:p,disabled:Le("address_postcode")})})]})]}),!!te?.support_professional_client&&(0,j.jsxs)(s.Fragment,{children:[(0,j.jsx)("div",{className:"account-form__divider"}),(0,j.jsxs)("div",{className:"pro-client",children:[(0,j.jsx)(g.A,{title:(0,c.localize)("Professional Client")}),(0,j.jsxs)("fieldset",{className:"account-form__fieldset",children:[(0,j.jsxs)("div",{children:[(0,j.jsx)(m.Text,{as:"p",size:"xs",children:(0,j.jsx)(c.Localize,{i18n_default_text:"By default, all {{brand_website_name}} clients are retail clients but anyone can request to be treated as a professional client.",values:{brand_website_name:(0,l.getBrandWebsiteName)()}})}),(0,j.jsx)(m.Text,{as:"p",size:"xs",children:(0,j.jsx)(c.Localize,{i18n_default_text:"A professional client receives a lower degree of client protection due to the following."})}),(0,j.jsx)(m.Text,{as:"p",size:"xs",children:(0,j.jsx)(c.Localize,{i18n_default_text:"We presume that you possess the experience, knowledge, and expertise to make your own investment decisions and properly assess the risk involved."})}),(0,j.jsx)(m.Text,{as:"p",size:"xs",className:"last-child",children:(0,j.jsx)(c.Localize,{i18n_default_text:"We’re not obliged to conduct an appropriateness test, nor provide you with any risk warnings."})})]}),Oe?(0,j.jsx)(m.Checkbox,{name:"request_professional_status",value:!!i.request_professional_status,onChange:()=>{I("request_professional_status",i.request_professional_status?0:1),A("request_professional_status",!0,!0)},label:(0,c.localize)("I would like to be treated as a professional client."),id:"request_professional_status",disabled:ee||!!Q.request_professional_status,greyDisabled:!0}):(0,j.jsx)(m.HintBox,{icon:"IcInfoBlue",icon_height:20,icon_width:30,message:(0,j.jsx)(m.Text,{as:"p",size:"xs",children:(0,j.jsx)(c.Localize,{i18n_default_text:"You’ll need to authenticate your account before requesting to become a professional client. <0>Authenticate my account</0>",components:[(0,j.jsx)("a",{className:"link--no-bold",rel:"noopener noreferrer",target:"_blank",href:Re?Fe?void 0:"/account/proof-of-address":"/account/proof-of-identity"},0)]})}),is_info:!0,is_inline:!0})]})]}),(0,j.jsx)("div",{className:"account-form__divider"})]}),(0,j.jsx)(g.A,{title:(0,c.localize)("Email preference")}),(0,j.jsx)(s.Fragment,{children:(0,j.jsx)("fieldset",{className:(0,d.A)("account-form__fieldset","account-form__fieldset--email-consent"),children:(0,j.jsx)(m.Checkbox,{name:"email_consent",value:!!i.email_consent,onChange:()=>{I("email_consent",i.email_consent?0:1),A("email_consent",!0,!0)},label:(0,c.localize)("Get updates about Deriv products, services and events."),id:"email_consent",defaultChecked:!!i.email_consent,disabled:Le("email_consent")&&!ee})})})]}),(0,j.jsxs)(x.A,{children:[r?.msg&&Ye(r),!ee&&!(S||y||r?.msg)&&(0,j.jsx)(m.Text,{className:"account-form__footer-note",size:"xxs",color:"prominent",align:e?"right":"center",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Ensure your information is correct."})}),(0,j.jsx)(m.Button,{className:(0,d.A)("account-form__footer-btn",{"dc-btn--green":y}),type:"submit",is_disabled:S||!D||!N||n||y,has_effect:!0,is_loading:n,is_submit_success:y,text:(0,c.localize)("Save changes"),large:!0,primary:!0})]})]})]})}})})),Q={none:"none",pending:"pending",rejected:"rejected",verified:"verified",expired:"expired",suspected:"suspected"},Z="selecting",X="submitting",ee="complete",te="idv",ie="onfido",ae="manual";var oe=i("./Components/demo-message/index.ts"),se=i("./Components/error-component/index.ts"),ne=i("./Components/icon-message-content/index.ts");const re=e=>{let{handleRequireSubmission:t,is_from_external:i,redirect_button:a}=e;return(0,j.jsxs)(ne.A,{message:(0,c.localize)("New proof of identity document needed"),icon:(0,j.jsx)(m.Icon,{icon:"IcPoiUpload",size:128}),children:[(0,j.jsx)(m.Button,{type:"button",className:"account-management__continue",onClick:t,large:!0,text:(0,c.localize)("Upload Document"),primary:!0}),!i&&a]})};var le=i("@deriv/quill-icons");const ce=e=>{let{handleRequireSubmission:t}=e;const{setSubmissionStatus:i}=n().useContext(l.POIContext);return(0,j.jsxs)("div",{className:"proof-of-identity__container",children:[(0,j.jsx)(le.DerivLightExclamationPoiIcon,{className:"icon"}),(0,j.jsx)(m.Text,{className:"proof-of-identity__text btm-spacer",align:"center",weight:"bold",children:(0,c.localize)("ID verification failed")}),(0,j.jsxs)(m.Text,{className:"proof-of-identity__text btm-spacer",align:"center",size:"xs",children:[(0,c.localize)("We were unable to verify your ID with the details you provided. "),(0,c.localize)("Please upload your identity document.")]}),(0,j.jsx)(m.Button,{type:"button",className:"account-management__continue",onClick:()=>{t(),i(Z)},large:!0,text:(0,c.localize)("Upload identity document"),primary:!0})]})},de=(0,j.jsx)(c.Localize,{i18n_default_text:"Submit proof of address"}),_e=e=>{let{custom_text:t=de,class_name:i}=e;return(0,j.jsx)(m.ButtonLink,{className:(0,d.A)("account-management__button",i),to:l.routes.proof_of_address,children:(0,j.jsx)(m.Text,{className:"dc-btn__text",as:"p",weight:"bold","data-testid":"poa_button_text",children:t})})},ue=_e,me=(0,o.observer)((e=>{let{is_from_external:t,mismatch_status:i,needs_poa:a,redirect_button:s}=e;const{client:r}=(0,o.useStore)(),{is_already_attempted:_}=r,u=i===l.IDV_ERROR_STATUS.NameDobMismatch.code||i===l.IDV_ERROR_STATUS.DobMismatch.code||i===l.IDV_ERROR_STATUS.NameMismatch.code,p=i===l.IDV_ERROR_STATUS.Expired.code||i===l.IDV_ERROR_STATUS.Failed.code,f=!t&&(0,j.jsx)(ue,{custom_text:(0,j.jsx)(c.Localize,{i18n_default_text:"Next"})});return(0,j.jsxs)("div",{className:(0,d.A)("proof-of-identity__container","proof-of-identity__container--status"),children:[(0,j.jsx)(le.DerivLightWaitingPoiIcon,{className:"icon"}),(0,j.jsx)(m.Text,{className:"proof-of-identity__text btm-spacer",align:"center",weight:"bold",children:(()=>{if(_){if(u)return(0,j.jsx)(c.Localize,{i18n_default_text:"Your profile is updated"});if(p)return(0,j.jsx)(c.Localize,{i18n_default_text:"Your document has been submitted"})}return(0,j.jsx)(c.Localize,{i18n_default_text:"Review in progress"})})()}),(0,j.jsx)(m.Text,{className:"proof-of-identity__text text",size:"xs",align:"center",children:_&&(u||p)?(0,j.jsx)(c.Localize,{i18n_default_text:"We'll review your proof of identity again and will give you an update as soon as possible."}):(0,j.jsx)(c.Localize,{i18n_default_text:"Your proof of identity is under review. We’ll get back to you within 5 minutes."})}),a?(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(m.Text,{className:"text",size:"xs",align:"center",children:(0,j.jsx)(c.Localize,{i18n_default_text:"To start trading, you also need to verify your address."})}),f]}):(0,j.jsx)("div",{className:"proof-of-identity__redirection",children:s})]})})),pe=n().memo(me);var fe=i("@deriv/shared/src/utils/routes/routes");const he=e=>{let{className:t}=e;return(0,j.jsx)(m.ButtonLink,{className:(0,d.A)("account-management__button",t),to:fe.routes.trade,children:(0,j.jsx)(m.Text,{className:"dc-btn__text",as:"p",weight:"bold","data-testid":"continue_btn_text",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Continue trading"})})})},xe=e=>{let{needs_poa:t,is_from_external:i,redirect_button:a}=e;const o=t?(0,j.jsx)(c.Localize,{i18n_default_text:"Your ID is verified. You will also need to submit proof of your address."}):(0,j.jsx)(c.Localize,{i18n_default_text:"ID verification passed"}),{isDesktop:s}=(0,f.Y)();return(0,j.jsxs)("div",{className:(0,d.A)("proof-of-identity__container","proof-of-identity__container--status"),"data-testid":"poi_idv_verified_container",children:[(0,j.jsx)(le.DerivLightApprovedPoiIcon,{className:"icon"}),(0,j.jsx)(m.Text,{className:"proof-of-identity__text btm-spacer",align:"center",weight:"bold",children:o}),t?(0,j.jsxs)(n().Fragment,{children:[s&&(0,j.jsx)(m.Text,{className:"text",size:"xs",align:"center",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Next, we'll need your proof of address."})}),!i&&(0,j.jsx)(_e,{custom_text:(0,j.jsx)(c.Localize,{i18n_default_text:"Submit proof of address"})})]}):a||(0,j.jsx)(he,{className:"continue-trade"})]})},ge=e=>{let{handleRequireSubmission:t,idv:i,is_from_external:a,needs_poa:o,redirect_button:s}=e;const{status:n,submissions_left:r,last_rejected:c}=i;switch(n){case Q.pending:return(0,j.jsx)(pe,{is_from_external:a,mismatch_status:(0,l.formatIDVError)(c,n),needs_poa:o,redirect_button:s});case Q.rejected:case Q.suspected:case Q.expired:return Number(r)<1?(0,j.jsx)(ce,{handleRequireSubmission:t}):null;case Q.verified:return(0,j.jsx)(xe,{is_from_external:a,needs_poa:o,redirect_button:s});default:return null}};var be=i("@deriv/utils");const ye=()=>(0,j.jsx)(ne.A,{message:(0,c.localize)("You've reached the limit for uploading your documents."),text:(0,j.jsx)(c.Localize,{i18n_default_text:"Please contact us via <0>live chat</0>.",components:[(0,j.jsx)("span",{className:"link link--orange",onClick:be.Chat.open},0)]}),icon:(0,j.jsx)(m.Icon,{icon:"IcPoiFailed",size:128})}),je=()=>(0,j.jsx)(ne.A,{message:(0,c.localize)("Proof of identity verification not required"),text:(0,c.localize)("Your account does not need identity verification at this time. We will inform you if identity verification is required in the future."),icon:(0,j.jsx)(m.Icon,{icon:"IcPoiVerified",size:128})}),ve=e=>{let{button_label:t,className:i,route:a}=e;return(0,j.jsx)(m.ButtonLink,{className:(0,d.A)("account-management__button",i),to:a,children:(0,j.jsx)(m.Text,{className:"dc-btn__text",as:"p",weight:"bold","data-testid":"route_btn_text",children:t})})};var ze=i("./Components/icon-message-content/icon-message-content.tsx");const we=e=>{let{needs_poa:t,redirect_button:i,is_from_external:a,is_manual_upload:o=!1}=e;const{localize:s}=(0,y.useTranslations)(),r=s("Review in progress"),c=s(o?"Your proof of identity is under review. We’ll get back to you within 1–3 working days.":"Your proof of identity is under review. We’ll get back to you within 5 minutes.");return t?(0,j.jsxs)(ze.A,{message:r,icon:(0,j.jsx)(m.Icon,{icon:"IcPoiVerified",size:128}),children:[(0,j.jsxs)(n().Fragment,{children:[(0,j.jsxs)("div",{className:"account-management__text-container",children:[(0,j.jsx)(m.Text,{align:"center",size:"xs",as:"p",children:c}),(0,j.jsx)(m.Text,{align:"center",size:"xs",as:"p",children:s("To start trading, you also need to verify your address.")})]}),(0,j.jsx)(ue,{custom_text:s("Next")})]}),!a&&i]}):(0,j.jsx)(ze.A,{message:r,text:c,icon:(0,j.jsx)(m.Icon,{icon:"IcPoiVerified",size:128}),children:!a&&(0,j.jsx)(ve,{button_label:s("Return to Trader's Hub"),route:l.routes.traders_hub})})},Se=we,ke=he,Ne=e=>{let{needs_poa:t,redirect_button:i,is_from_external:a,service:o}=e;const s=o===te?(0,c.localize)("ID verification passed"):(0,c.localize)("Your proof of identity is verified");return t?(0,j.jsx)(ne.A,{message:s,icon:(0,j.jsx)(m.Icon,{icon:"IcPoaVerified",size:128}),className:"account-management-dashboard",text:(0,c.localize)("To continue trading, you must also submit a proof of address."),children:!a&&(0,j.jsx)(n().Fragment,{children:(0,j.jsx)(ue,{})})}):(0,j.jsx)(ne.A,{message:s,icon:(0,j.jsx)(m.Icon,{icon:"IcPoaVerified",size:128,data_testid:"dt_IcPoaVerified"}),className:"account-management-dashboard",children:!a&&(i||(0,j.jsx)(ke,{}))})},Ce=e=>{let{text:t,index:i}=e;const{isDesktop:a}=(0,f.Y)(),o=a?"xs":"xxs";return(0,j.jsxs)("div",{className:"account-management__list-text-container",children:[i&&(0,j.jsxs)(m.Text,{size:o,className:"account-management__list-text",children:[(0,j.jsx)(c.Localize,{i18n_default_text:"{{index}}.",values:{index:i}})," "]}),(0,j.jsx)(m.Text,{size:o,className:"account-management__list-text",children:t})]})},Ie=e=>{let{className:t,icon:i,message:a,message_list:o=[],onContinue:s}=e;const{isDesktop:n,isMobile:r}=(0,f.Y)();return(0,j.jsx)(m.ThemedScrollbars,{is_bypassed:r,children:(0,j.jsx)(m.Div100vhContainer,{className:"account-management__message-wrapper",is_disabled:n,height_offset:"110px",children:(0,j.jsxs)("div",{className:(0,d.A)("account-management__message-content",{[`${t}__message-content`]:t}),"data-testid":"dt_icon_message_list",children:[i&&(0,j.jsx)("div",{className:(0,d.A)("account-management__message-icon",{[`${t}__message-icon`]:t}),children:i}),(0,j.jsx)(m.Text,{as:"div",weight:"bold",className:(0,d.A)("account-management__message",{[`${t}__message`]:t}),size:n?"s":"xs",children:a}),o&&(0,j.jsx)("div",{className:"account-management__list-container",children:(0,j.jsxs)("div",{className:"account-management__list-message",children:[(0,j.jsx)("div",{className:"account-management__list-icon",children:(0,j.jsx)(m.Icon,{icon:"IcAlertDanger",color:"red"})}),(0,j.jsx)("section",{children:o.length<2?(0,j.jsx)(Ce,{text:(0,l.getOnfidoError)(o[0])}):o.map(((e,t)=>(0,j.jsx)(Ce,{text:(0,l.getOnfidoError)(o[t]),index:t+1},e)))})]})}),s&&(0,j.jsx)(m.Button,{type:"button",className:"account-management__continue",onClick:s,large:!0,primary:!0,children:(0,j.jsx)(c.Localize,{i18n_default_text:"Verify again"})})]})})})},Te=e=>{let{handleRequireSubmission:t,rejected_reasons:i}=e;return(0,j.jsx)(Ie,{message:(0,c.localize)("Your proof of identity submission failed because:"),icon:(0,j.jsx)(m.Icon,{icon:"IcPoiFailed",size:128}),message_list:i,onContinue:t})},Le=e=>{let{children:t,message:i,error:a}=e;return(0,j.jsx)(ne.A,{message:i??(0,j.jsx)(c.Localize,{i18n_default_text:"Proof of identity documents upload failed"}),text:a,icon:(0,j.jsx)(m.Icon,{icon:"IcPoiFailed",size:128}),className:"account-management-dashboard",children:t})},Ae=Object.freeze({DUPLICATE_ACCOUNT:"DuplicateAccount",CLAIMED_DOCUMENT:"ClaimedDocument",DUPLICATE_DOCUMENT:"DuplicateUpload"});var De=i("../../../node_modules/@binary-com/binary-document-uploader/DocumentUploader.js"),Pe=i.n(De);const Ee=e=>(0,c.localize)("Unable to read file {{name}}",{name:e});var Fe=i("../../../node_modules/react-transition-group/esm/CSSTransition.js");const Re=e=>{let{anchor:t,from:i,text:a}=e;const o=i?`?from=${i}`:"",s=t?`#${t}`:"";return(0,j.jsx)(m.ButtonLink,{to:`/account/personal-details${o}${s}`,children:(0,j.jsx)(m.Text,{className:"dc-btn__text",weight:"bold",as:"p",children:a??(0,c.localize)("Go to personal details")})})},Oe=e=>{let{has_invalid_postal_code:t,from:i}=e;return t?(0,j.jsx)(ne.A,{message:(0,c.localize)("Your postal code is invalid"),text:(0,c.localize)("Please check and update your postal code before submitting proof of identity."),icon:(0,j.jsx)(m.Icon,{icon:"IcAccountMissingDetails",size:128}),children:(0,j.jsx)(Re,{anchor:"address_postcode",from:i,text:(0,c.localize)("Update postal code")})}):(0,j.jsx)(ne.A,{message:(0,c.localize)("Your personal details are missing"),text:(0,c.localize)("Please complete your personal details before you verify your identity."),icon:(0,j.jsx)(m.Icon,{icon:"IcAccountMissingDetails",size:128}),children:(0,j.jsx)(Re,{from:i})})};var Me=i("./Components/form-body-section/index.ts"),Ue=i("./Components/inline-note-with-icon/index.ts");const qe=e=>{const{isDesktop:t}=(0,f.Y)(),{inline_note_text:i,is_virtual:a,is_eu_user:o,is_svg:s,is_rendered_for_idv:u,editable_fields:h=[],has_real_account:x,is_fully_authenticated:y,account_opening_reason_list:z,closeRealAccountSignup:w,salutation_list:S,is_rendered_for_onfido:k,is_qualified_for_poa:C,class_name:I,states_list:T,side_note:L,no_confirmation_needed:A,mismatch_status:D}=e,P=s&&!o,{errors:E,touched:F,values:R,setFieldValue:O,handleChange:M,handleBlur:U}=(0,_.useFormikContext)(),{data:q}=(0,p.useResidenceList)(),B=()=>{const e=s||o||k||u;return{first_name_label:e?(0,c.localize)("First name*"):(0,c.localize)("First name"),last_name_label:e?(0,c.localize)("Last name*"):(0,c.localize)("Last name"),dob_label:e?(0,c.localize)("Date of birth*"):(0,c.localize)("Date of birth")}},Y=u||k,V=e=>P||Y?(0,j.jsx)(c.Localize,{i18n_default_text:"Your {{ field_name }} as in your identity document",values:{field_name:e}}):(0,j.jsx)(c.Localize,{i18n_default_text:"Please enter your {{ field_name }} as in your official identity documents.",values:{field_name:e}}),$=(0,j.jsx)(c.Localize,{i18n_default_text:"Use the same address that appears on your proof of address (utility bill, bank statement, etc.)."}),W=(0,N.RC)(D).some((e=>!R[e]||E[e]));return(0,j.jsxs)(n().Fragment,{children:[(0,j.jsxs)("div",{className:(0,d.A)(I,{"account-form__poi-confirm-example":u}),children:[(P||Y)&&(0,j.jsx)("div",{className:"account-form__poi-inline-message",children:(0,j.jsx)(m.InlineMessage,{message:i,size:"md"})}),C&&(0,j.jsx)(Ue.A,{icon:"IcAlertWarning",message:$,font_size:t?"xs":"xxxs"}),(0,j.jsx)(Me.A,{has_side_note:Y||P,side_note:L,side_note_position:"right",type:"image",children:(0,j.jsxs)("fieldset",{className:"account-form__fieldset",children:["salutation"in R&&!o&&(0,j.jsx)("div",{children:(0,j.jsx)(m.Text,{size:t?"xxs":"xs",align:!t&&"center",children:a?(0,c.localize)("Please remember that it is your responsibility to keep your answers accurate and up to date. You can update your personal details at any time in your account settings."):(0,j.jsx)(c.Localize,{i18n_default_text:"Please remember that it is your responsibility to keep your answers accurate and up to date. You can update your personal details at any time in your <0>account settings</0>.",components:[(0,j.jsx)(r.Link,{to:l.routes.personal_details,className:"link",onClick:w},0)]})})}),o&&!k&&!C&&(0,j.jsx)(g.A,{title:"salutation"in R?(0,c.localize)("Title and name"):(0,c.localize)("Name")}),"salutation"in R&&(0,j.jsx)("span",{onClick:e=>{"radio"===e.target?.type&&O("salutation",e.target?.value)},children:(0,j.jsx)(m.RadioGroup,{className:"dc-radio__input",name:"salutation",selected:R.salutation,onToggle:e=>{e.persist(),O("salutation",e.target.value)},required:!0,children:S.map((e=>(0,j.jsx)(m.RadioGroup.Item,{label:e.label,value:e.value,disabled:!!R.salutation&&(0,N.dS)("salutation",h),has_error:!(!F.salutation||!E.salutation)},e.value)))})}),"first_name"in R&&(0,j.jsx)(b.lp,{name:"first_name",required:s,label:B().first_name_label,hint:V((0,c.localize)("first name")),disabled:(0,N.dS)("first_name",h)||R?.first_name&&x,placeholder:(0,c.localize)("John"),"data-testid":"first_name"}),"last_name"in R&&(0,j.jsx)(b.lp,{name:"last_name",required:s,label:B().last_name_label,hint:V((0,c.localize)("last name")),disabled:(0,N.dS)("last_name",h)||R?.last_name&&x,placeholder:(0,c.localize)("Doe"),"data-testid":"last_name"}),o&&!C&&(0,j.jsx)(g.A,{title:(0,c.localize)("Other details")}),"date_of_birth"in R&&(0,j.jsx)(b.XU,{name:"date_of_birth",required:s,label:B().dob_label,hint:V((0,c.localize)("date of birth")),disabled:(0,N.dS)("date_of_birth",h)||R?.date_of_birth&&x,placeholder:(0,c.localize)("01-07-1999"),portal_id:"modal_root",data_testid:"date_of_birth"}),"address_line_1"in R&&(0,j.jsx)(b.lp,{name:"address_line_1",label:(0,c.localize)("First line of address*"),disabled:(0,N.dS)("address_line_1",h),"data-testid":"address_line_1",autoComplete:"off","data-lpignore":"true",type:"text",maxLength:70,required:!0,onBlur:U,error:F.address_line_1&&E.address_line_1,value:R.address_line_1}),"address_line_2"in R&&(0,j.jsx)(b.lp,{name:"address_line_2",label:(0,c.localize)("Second line of address (optional)"),disabled:(0,N.dS)("address_line_2",h),"data-testid":"address_line_2",autoComplete:"off","data-lpignore":"true",type:"text",maxLength:70,onBlur:U,error:F.address_line_2&&E.address_line_2,value:R.address_line_2}),"address_city"in R&&(0,j.jsx)(b.lp,{name:"address_city",label:(0,c.localize)("Town/City*"),disabled:(0,N.dS)("address_city",h),"data-testid":"address_city",autoComplete:"off","data-lpignore":"true",type:"text",maxLength:70,required:!0,onBlur:U,error:F.address_city&&E.address_city,value:R.address_city}),"address_state"in R&&(T?.length?(0,j.jsx)(n().Fragment,{children:t?(0,j.jsx)(_.Field,{name:"address_state",children:e=>{let{field:t}=e;return(0,j.jsx)(m.Autocomplete,{...t,"data-lpignore":"true",autoComplete:"new-password",type:"text",label:(0,c.localize)("State/Province"),error:F.address_state&&E.address_state,list_items:T,onItemSelection:e=>{let{value:t,text:i}=e;return O("address_state",t?i:"",!0)}})}}):(0,j.jsx)(m.SelectNative,{placeholder:(0,c.localize)("Please select"),label:(0,c.localize)("State/Province"),value:R.address_state,list_items:T,error:F.address_state&&E.address_state,use_text:!0,onChange:e=>O("address_state",e.target.value,!0)})}):(0,j.jsx)(b.lp,{"data-lpignore":"true",autoComplete:"off",type:"text",name:"address_state",label:(0,c.localize)("State/Province"),value:R.address_state,error:F.address_state&&E.address_state,onBlur:U})),"address_postcode"in R&&(0,j.jsx)(b.lp,{name:"address_postcode",label:(0,c.localize)("Postal/ZIP code"),disabled:(0,N.dS)("address_postcode",h),"data-testid":"address_postcode",autoComplete:"off","data-lpignore":"true",type:"text",maxLength:70,onBlur:U,error:F.address_postcode&&E.address_postcode,value:R.address_postcode}),!P&&"place_of_birth"in R&&(0,j.jsx)(Ye,{handleChange:M,setFieldValue:O,disabled:(0,N.dS)("place_of_birth",h),residence_list:q,required:!0}),"citizen"in R&&(0,j.jsx)(_.Field,{name:"citizen",children:e=>{let{field:i}=e;return(0,j.jsx)(n().Fragment,{children:t?(0,j.jsx)(m.Autocomplete,{...i,"data-lpignore":"true",autoComplete:"none",type:"text",label:o?(0,c.localize)("Citizenship*"):(0,c.localize)("Citizenship"),error:F.citizen&&E.citizen,disabled:R?.citizen&&y||(0,N.dS)("citizen",h)||R?.citizen&&x,list_items:q,onItemSelection:e=>{let{value:t,text:i}=e;return O("citizen",t?i:"",!0)},list_portal_id:"modal_root",required:!0,"data-testid":"citizenship"}):(0,j.jsx)(m.SelectNative,{placeholder:(0,c.localize)("Citizenship"),name:i.name,disabled:R?.citizen&&y||(0,N.dS)("citizen",h)||R?.citizen&&x,label:o?(0,c.localize)("Citizenship*"):(0,c.localize)("Citizenship"),list_items:q,value:R.citizen,use_text:!0,error:F.citizen&&E.citizen,onChange:e=>{M(e),O("citizen",e.target.value,!0)},...i,required:!0,should_hide_disabled_options:!1,data_testid:"citizenship_mobile"})})}}),!P&&"phone"in R&&(0,j.jsx)(Be,{value:R.phone,editable_fields:h,has_real_account:x,required:!0}),!P&&"account_opening_reason"in R&&(0,j.jsx)(v,{required:!0,account_opening_reason_list:z,setFieldValue:O,disabled:(0,N.dS)("account_opening_reason",h)||R?.account_opening_reason&&x})]})}),!A&&u&&(0,j.jsx)(m.Checkbox,{name:"confirmation_checkbox",className:"formik__confirmation-checkbox",value:R.confirmation_checkbox,label:(0,j.jsx)(c.Localize,{i18n_default_text:"I confirm that the name and date of birth above match my chosen identity document"}),label_font_size:t?"xs":"xxs",disabled:W,onChange:M,has_error:!(!F.confirmation_checkbox||!E.confirmation_checkbox)})]}),P&&(0,j.jsxs)("div",{className:"account-form__poi-additional-information",children:[(0,j.jsx)(g.A,{title:(0,c.localize)("Additional information")}),"phone"in R&&(0,j.jsx)(Be,{value:R.phone,editable_fields:h,has_real_account:x,required:!0}),(0,j.jsxs)(n().Fragment,{children:["place_of_birth"in R&&(0,j.jsx)(Ye,{handleChange:M,setFieldValue:O,disabled:(0,N.dS)("place_of_birth",h),residence_list:q,required:!0}),"account_opening_reason"in R&&(0,j.jsx)(v,{account_opening_reason_list:z,setFieldValue:O,disabled:(0,N.dS)("account_opening_reason",h)||R?.account_opening_reason&&x,required:!0,is_modal:!0})]})]})]})},Be=e=>{let{value:t,editable_fields:i,has_real_account:a,required:o}=e;return(0,j.jsx)(b.lp,{name:"phone",label:o?(0,c.localize)("Phone number*"):(0,c.localize)("Phone number"),placeholder:o?(0,c.localize)("Phone number*"):(0,c.localize)("Phone number"),disabled:(0,N.dS)("phone",i)||t&&a&&(0,l.validPhone)(t)&&t?.length>=9&&t?.length<=35,maxLength:50,"data-testid":"phone"})},Ye=e=>{let{handleChange:t,setFieldValue:i,disabled:a,residence_list:o,required:s}=e;const{isDesktop:r}=(0,f.Y)();return(0,j.jsx)(_.Field,{name:"place_of_birth",children:e=>{let{field:l,meta:d}=e;return(0,j.jsx)(n().Fragment,{children:r?(0,j.jsx)(m.Autocomplete,{...l,disabled:a,"data-lpignore":"true",autoComplete:"none",type:"text",label:s?(0,c.localize)("Place of birth*"):(0,c.localize)("Place of birth"),error:d.touched&&d.error,list_items:o,onItemSelection:e=>{let{value:t,text:a}=e;return i("place_of_birth",t?a:"",!0)},required:!0,"data-testid":"place_of_birth"}):(0,j.jsx)(m.SelectNative,{placeholder:(0,c.localize)("Place of birth"),name:l.name,disabled:a,label:s?(0,c.localize)("Place of birth*"):(0,c.localize)("Place of birth"),list_items:o,value:l.value,use_text:!0,error:d.touched&&d.error,onChange:e=>{t(e),i("place_of_birth",e.target.value,!0)},...l,list_portal_id:"modal_root",required:!0,should_hide_disabled_options:!1,data_testid:"place_of_birth_mobile"})})}})},Ve=()=>be.Chat.open(),$e=(0,j.jsx)(c.Localize,{i18n_default_text:"Sorry, an internal error occurred. Hit the above checkbox to try again."}),We=(0,j.jsx)(c.Localize,{i18n_default_text:"An account with these details already exists. Please make sure the details you entered are correct as only one real account is allowed per client. If this is a mistake, contact us via <0>live chat</0>.",components:[(0,j.jsx)("span",{className:"link link--orange",onClick:Ve,onKeyDown:Ve},0)]}),He=(0,j.jsx)(c.Localize,{i18n_default_text:"This document number was already submitted for a different account. It seems you have an account with us that doesn't need further verification. Please contact us via <0>live chat</0> if you need help.",components:[(0,j.jsx)("span",{className:"link link--orange",onClick:Ve,onKeyDown:Ve},0)]}),Ge=(e,t,i,a)=>{const o=e?"identity document":(0,N.xy)(t,i);switch(a){case l.IDV_ERROR_STATUS.NameMismatch.code:return{required_fields:["first_name","last_name"],side_note_image:(0,j.jsx)(le.DerivLightNamePoiIcon,{height:"195px",width:"285px"}),inline_note_text:(0,j.jsx)(c.Localize,{i18n_default_text:"To avoid delays, enter your <0>name</0> exactly as it appears on your {{document_name}}.",components:[(0,j.jsx)("strong",{},0)],values:{document_name:o}}),failure_message:l.IDV_ERROR_STATUS.NameMismatch.message};case l.IDV_ERROR_STATUS.DobMismatch.code:return{required_fields:["date_of_birth"],side_note_image:(0,j.jsx)(le.DerivLightDobPoiIcon,{height:"195px",width:"285px"}),inline_note_text:(0,j.jsx)(c.Localize,{i18n_default_text:"To avoid delays, enter your <0>date of birth</0> exactly as it appears on your {{document_name}}.",components:[(0,j.jsx)("strong",{},0)],values:{document_name:o}}),failure_message:l.IDV_ERROR_STATUS.DobMismatch.message};default:return{required_fields:["first_name","last_name","date_of_birth"],side_note_image:(0,j.jsx)(le.DerivLightNameDobPoiIcon,{height:"195px",width:"285px"}),inline_note_text:(0,j.jsx)(c.Localize,{i18n_default_text:"To avoid delays, enter your <0>name</0> and <0>date of birth</0> exactly as they appear on your {{document_name}}.",components:[(0,j.jsx)("strong",{},0)],values:{document_name:o}}),failure_message:(0,l.getIDVError)(a)}}},Je=e=>{let{account_settings:t,getChangeableFields:i,onFormConfirm:a}=e;const{isDesktop:o}=(0,f.Y)(),[s,r]=n().useState(!0),[u,p]=n().useState(!1),[x,g]=n().useState({show_form:!0,form_initial_values:{first_name:"",last_name:"",date_of_birth:""},changeable_fields:[],api_error:""}),b=(0,j.jsx)(le.DerivLightNameDobPoiIcon,{height:"195px",width:"285px"});n().useEffect((()=>{(async()=>{try{await(l.WS?.wait("get_settings"));const e=["first_name","last_name","date_of_birth"],a=(0,l.filterObjProperties)(t,e);a.date_of_birth&&(a.date_of_birth=(0,l.toMoment)(a.date_of_birth).format("YYYY-MM-DD")),g({...x,changeable_fields:i(),form_initial_values:a}),r(!1)}catch(e){console.error(e)}})()}),[t]);const{form_initial_values:{...y},api_error:v}=x;return v?(0,j.jsx)(S.A,{error_message:v}):s?(0,j.jsx)(m.Loading,{is_fullscreen:!1,className:"account__initial-loader"}):(0,j.jsx)(_.Formik,{initialValues:y,enableReinitialize:!0,onSubmit:async(e,t)=>{let{setStatus:i,setSubmitting:o}=t;if(u)return;i({error_msg:""});const s=(0,N.Di)(e,x?.changeable_fields?[...x.changeable_fields]:[]),n=await l.WS.setSettings(s);if(n?.error)i({error_msg:n.error?.code===Ae.DUPLICATE_ACCOUNT?We:$e}),o(!1);else{const e=await l.WS.authorized.storage.getSettings();if(e?.error)return void g({...x,api_error:e.error.message});const{first_name:t,last_name:i,date_of_birth:o}=e?.get_settings??{...x.form_initial_values};g({...x,form_initial_values:{first_name:t,last_name:i,date_of_birth:o}}),p(!0),r(!1),a&&setTimeout((()=>{a()}),500)}},validate:e=>{const t={};return(0,N.tf)(t,e)((e=>e),["first_name","last_name","date_of_birth"],(0,c.localize)("This field is required")),e.first_name&&(t.first_name=(0,N.yS)(e.first_name)),e.last_name&&(t.last_name=(0,N.yS)(e.last_name)),g({...x,errors:!(0,l.isEmptyObject)((0,l.removeEmptyPropertiesFromObject)(t))}),(0,l.removeEmptyPropertiesFromObject)(t)},children:e=>{let{errors:t,handleSubmit:i,isSubmitting:a,status:s}=e;return(0,j.jsx)(_.Form,{className:"account-form__poi-confirm-example",onSubmit:i,children:(0,j.jsxs)(h.A,{children:[(0,j.jsx)(qe,{editable_fields:x.changeable_fields,is_rendered_for_onfido:!0,side_note:b,inline_note_text:(0,j.jsx)(c.Localize,{i18n_default_text:"To avoid delays, enter your <0>name</0> and <0>date of birth</0> exactly as they appear on your identity document.",components:[(0,j.jsx)("strong",{},0)]})}),(0,j.jsx)("button",{type:"submit",className:(0,d.A)("account-form__poi-confirm-example--button",{"account-form__poi-confirm-example--button__disabled":u||!(0,l.isEmptyObject)(t)}),children:(0,j.jsx)(m.Checkbox,{value:u,label:(0,j.jsx)(m.Text,{size:o?"xs":"xxs",children:(0,c.localize)("I confirm that the name and date of birth above match my chosen identity document (see below)")}),disabled:a})}),s?.error_msg&&(0,j.jsx)("div",{className:"account-form__poi-confirm-example--status-message",children:(0,j.jsx)(m.HintBox,{icon:"IcAlertDanger",message:(0,j.jsx)(m.Text,{as:"p",size:"xxxs",children:s?.error_msg}),is_danger:!0,className:"hint-box-layout"})})]})})}})},Ke=e=>{let{is_onfido_disabled:t,is_onfido_container_hidden:i,onfido_element_id:a="onfido",is_confirmed:o,data_testid:s,is_onfido_initialized:r}=e;const[l,_]=n().useState(!1),u=n().useRef(),p=n().useRef();return n().useEffect((()=>{o&&(u.current=setTimeout((()=>{_(!0)}),800),p.current=setTimeout((()=>{_(!1)}),4650))}),[o]),n().useEffect((()=>()=>{clearTimeout(u.current),clearTimeout(p.current)}),[]),(0,j.jsxs)("div",{className:"onfido-container-view_wrapper",children:[(0,j.jsx)("div",{className:(0,d.A)({"onfido-container__status-message_container":!t}),children:(0,j.jsx)(Fe.A,{appear:l,in:l,timeout:{exit:350},classNames:{exit:"onfido-container__status-message--exit"},unmountOnExit:!0,children:(0,j.jsx)(m.HintBox,{className:"onfido-container__status-message",icon:"IcAlertAnnounce",message:(0,j.jsx)(m.Text,{as:"p",size:"xxxs",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Your personal details have been saved successfully."})}),is_info:!0})})}),(0,j.jsxs)("section",{children:[t&&r&&(0,j.jsx)("div",{className:"onfido-container__info-message",children:(0,j.jsx)(m.HintBox,{icon:"IcInfoBlue",message:(0,j.jsx)(m.Text,{as:"p",size:"xxxs",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Hit the checkbox above to choose your document."})}),is_info:!0})}),(0,j.jsx)("div",{"data-testid":s,id:a,className:(0,d.A)({"onfido-container__disabled":t,"onfido-container__hidden":i})})]})]})};var Qe=i("./Constants/onfido.js");const Ze=(0,o.observer)((e=>{let{country_code:t,documents_supported:i,getChangeableFields:a,handleViewComplete:r,height:l,is_default_enabled:c}=e;const[d,_]=n().useState(),[h,x]=n().useState(""),[g,b]=n().useState(!0),[y,v]=n().useState(!1),[z,w]=n().useState(!1),[S,k]=n().useState(!1),{data:C}=(0,u.useSettings)(),{send:I,isSuccess:T}=(0,p.useNotificationEvent)(),{common:L}=(0,o.useStore)(),{current_language:A}=L,{isMobile:D}=(0,f.Y)(),P=(0,N.aZ)(t),E=(0,N.IW)(t),{service_token:F,isSuccess:R,isError:O,error:M,isLoading:U}=(0,p.useServiceToken)({service:"onfido",country:E}),q=n().useRef(),B=Array.isArray(i)?i:Object.keys(i).map((e=>i[e].display_name));let Y;const V=n().useCallback((e=>{q?.current?.tearDown();const t=Object.keys(e).map((t=>e[t]?.id));t?.length&&I({category:"authentication",event:"poi_documents_uploaded",args:{documents:t}})}),[I]),$=n().useCallback((async e=>{if(e)try{q.current=await window.Onfido.init({containerId:"onfido",language:{locale:(0,N.hf)(A),phrases:(0,Qe.e)(),mobilePhrases:(0,Qe.e)()},token:e,useModal:!1,useMemoryHistory:!0,onComplete:V,steps:[{type:"document",options:{documentTypes:{passport:B.some((e=>/Passport/g.test(e))),driving_licence:!!B.some((e=>/Driving Licence/g.test(e)))&&{country:P},national_identity_card:!!B.some((e=>/National Identity Card/g.test(e)))&&{country:P}},hideCountrySelection:!0}},"face"]}),w(!0)}catch(e){_(e?.message??e),b(!0),q.current=void 0}finally{k(!0)}}),[V,B,P,A]),W=n().useCallback((e=>{document.getElementById("onfido_sdk")?.remove(),document.getElementById("onfido_style")?.remove();const t=document.createElement("script"),i=document.createElement("link");t.id="onfido_sdk",t.src="https://assets.onfido.com/web-sdk-releases/13.8.4/onfido.min.js",i.href="https://assets.onfido.com/web-sdk-releases/13.8.4/style.css",i.rel="stylesheet",i.id="onfido_style",document.body.appendChild(t),document.body.appendChild(i),t.addEventListener("load",(()=>{$(e)}))}),[$]),H=(0,s.useCallback)((()=>{v(!0),b(!1)}),[]);return n().useEffect((()=>{R&&F?.onfido?.token&&!S?W(F?.onfido?.token):O&&(e=>{switch(e.code){case"MissingPersonalDetails":x("all");break;case"InvalidPostalCode":x("postal_code");break;default:_(e.message)}})(M)}),[M,O,R,S,W,F?.onfido?.token]),n().useEffect((()=>{c&&b(!1)}),[c]),n().useEffect((()=>{T&&r()}),[r,T]),U||!S?Y=(0,j.jsx)(m.Loading,{is_fullscreen:!1}):h?Y=(0,j.jsx)(Oe,{has_invalid_postal_code:"postal_code"===h,from:"proof_of_identity"}):d&&(Y=(0,j.jsx)(se.A,{message:d})),(0,j.jsx)(m.ThemedScrollbars,{is_bypassed:D,height:l,children:(0,j.jsxs)("div",{className:"onfido-container",children:[Y||(0,j.jsx)(Fe.A,{appear:g,in:g,timeout:{exit:350},classNames:{exit:"account-form__poi-confirm-example_wrapper--exit"},unmountOnExit:!0,children:(0,j.jsx)("div",{className:"account-form__poi-confirm-example_wrapper account-form__poi-confirm-example_container",children:(0,j.jsx)(Je,{account_settings:C,getChangeableFields:a,onFormConfirm:H})})}),(0,j.jsx)(Ke,{is_onfido_disabled:g,is_confirmed:y,is_onfido_container_hidden:!!Y,is_onfido_initialized:z})]})})}));Ze.displayName="OnfidoSdkViewContainer";const Xe=Ze,et="manual-poi-details",tt="national_identity_card",it="nimc_slip",at="driving_licence",ot="front",st="back",nt="photo",rt={document_type:"selfie_with_id",pageType:nt,name:"selfie_with_id",icon:"IcSelfie",info:(0,c.localize)("Upload your selfie.")},lt={name:"expiry_date",label:(0,c.localize)("Expiry date"),type:"date",required:!0},ct=e=>{let{data:t}=e;const i=(0,l.toMoment)().add(6,"months").format("YYYY-MM-DD");switch(t.type){case"text":return(0,j.jsx)(_.Field,{name:t.name,children:e=>{let{field:i,form:{errors:a,touched:o}}=e;return(0,j.jsx)(m.Input,{...i,className:`${et}__field`,type:"text",label:`${t.label}${t.required?"*":""}`,error:o[i.name]&&a[i.name]})}});case"date":return(0,j.jsx)(_.Field,{name:t.name,children:e=>{let{field:a,form:{errors:o,touched:s}}=e;return(0,j.jsx)(m.DatePicker,{...a,className:`${et}__field`,date_format:"YYYY-MM-DD",display_format:"DD-MM-YYYY",start_date:i,min_date:i,name:t.name,label:`${t.label}${t.required?"*":""}`,error:s[a.name]&&o[a.name],readOnly:!0})}});default:return null}},dt={"file-too-large":(0,c.localize)("File size should be 8MB or less"),"file-invalid-type":(0,c.localize)("File uploaded is not supported"),"too-many-files":(0,c.localize)("Please select one file only"),GENERAL:(0,c.localize)("Sorry, an error occured. Please select another file.")},_t=e=>{let{data:t,open:i}=e;const{isDesktop:a}=(0,f.Y)();return(0,j.jsxs)("div",{className:`${et}__uploader-details`,children:[(0,j.jsx)(m.Icon,{className:`${et}__uploader-icon`,icon:t?.icon,size:236}),(0,j.jsx)(m.Text,{as:"p",size:"xs",color:"general",align:"center",children:t?.info}),(0,j.jsx)(m.Button,{medium:!0,secondary:!0,text:a?(0,c.localize)("Drop file or click here to upload"):(0,c.localize)("Tap here to upload"),onClick:i})]})},ut=e=>{let{data:t,setFieldValue:i,value:a,has_frame:o,handleChange:s}=e;const[r,l]=n().useState("");return n().useEffect((()=>{l(a?.file?URL.createObjectURL(a?.file):"")}),[a]),(0,j.jsxs)("div",{className:`${et}__uploader-details ${et}__uploader-details--preview`,children:[(0,j.jsxs)("div",{className:(0,d.A)(`${et}__uploader-image`,{[`${et}__uploader-image--has-frame`]:o}),style:{backgroundImage:`url(${r})`},children:[o&&(0,j.jsx)(m.Icon,{icon:"IcPoiFrame",className:`${et}__uploader-frame`}),(!r||-1!==a?.file.type.indexOf("pdf"))&&(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(m.Icon,{icon:"IcCloudUpload",size:50}),(0,j.jsx)(m.Text,{as:"p",size:"xs",color:"general",align:"center",children:a?.file.name})]}),(0,j.jsx)(m.Icon,{icon:"IcCloseCircle",className:`${et}__uploader-remove`,onClick:()=>{s?.(null,i)},size:16})]}),(0,j.jsx)(m.Text,{as:"p",size:"xs",color:"general",align:"center",children:t?.info})]})},mt=e=>{let{data:t,value:i,is_full:a,onChange:o,has_frame:s}=e;const{isDesktop:r}=(0,f.Y)(),[u,p]=n().useState();n().useEffect((()=>{p(i)}),[i]);const h=(e,i)=>{o?.(e),i?.(t?.name,e)},x=e=>(0,j.jsxs)("div",{className:`${et}__uploader-details`,children:[u?.errors?.map(((e,t)=>(0,j.jsx)(m.Text,{as:"p",size:"xs",color:"secondary",align:"center",children:e},t))),(0,j.jsx)(m.Button,{medium:!0,secondary:!0,text:r?(0,c.localize)("Drop file or click here to upload"):(0,c.localize)("Tap here to upload"),onClick:e})]});return(0,j.jsx)(_.Field,{name:t?.name,children:e=>{let{form:{setFieldValue:o}}=e;return(0,j.jsx)("div",{className:(0,d.A)(`${et}__uploader`,{[`${et}__uploader--full`]:a}),children:(0,j.jsx)(m.FileDropzone,{accept:l.supported_filetypes,error_message:(0,c.localize)("Please upload supported file type."),filename_limit:32,hover_message:(0,c.localize)("Drop files here.."),max_size:l.max_document_size,message:e=>(0,j.jsx)(_t,{open:e,data:t}),preview_single:u&&(0,j.jsx)(ut,{data:t,value:u,has_frame:s,setFieldValue:o,handleChange:h}),multiple:!1,onDropAccepted:e=>((e,i)=>{const a={file:e[0],errors:[],...t};h(a,i)})(e,o),onDropRejected:e=>((e,i)=>{const a=e[0].errors?.map((e=>dt[e.code]?dt[e.code]:dt.GENERAL)),o={...e[0],errors:a,...t};h(o,i)})(e,o),validation_error_message:i?.errors?.length?x:void 0,noClick:!0,value:u?[u]:[]})})}})},pt=e=>{const t={};return e.forEach((e=>{t[e.name]=""})),t},ft=e=>"string"==typeof e?!e.trim():!e,ht=function(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const i={};return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).forEach((t=>{const{name:a,label:o,type:s}=t,n=e[a];t.required&&ft(n)?i[a]=(0,c.localize)("{{label}} is required.",{label:o}):"text"===s&&n.length>30?i[a]=(0,c.localize)("{{label}} must be less than 30 characters.",{label:o}):"text"!==s||/^[\w\s-]{0,30}$/g.test(n)||(i[a]=(0,c.localize)("Only letters, numbers, space, underscore, and hyphen are allowed for {{label}}.",{label:o}))})),t.forEach((t=>{const{name:a}=t,o=e[a];ft(o)?i[a]=(0,c.localize)("{{name}} is required.",{name:a}):o.errors?.length&&(i[a]=o.errors[0])})),i},xt=[{icon:"IcPoiClearPhoto",text:(0,c.localize)("A clear colour photo or scanned image")},{icon:"IcPoiFileFormat",text:(0,c.localize)("JPEG, JPG, PNG, PDF, or GIF")},{icon:"IcPoiFileSize",text:(0,c.localize)("Less than 8MB")},{icon:"IcPoiDocExpiry",text:(0,c.localize)("Must be valid for at least 6 months")}],gt=e=>{let{data:t}=e;return(0,j.jsxs)("div",{className:`${et}__icons-item`,children:[(0,j.jsx)(m.Icon,{icon:t.icon,size:24}),(0,j.jsx)(m.Text,{as:"p",size:"xxxs",align:"center",children:t.text})]})},bt=e=>{let{initial_values:t,is_from_external:i,data:a,goToCards:o,onSubmit:s}=e;const{isDesktop:n}=(0,f.Y)(),{fields:r,documents_title:l,documents:u}=a,p=r.some((e=>e.name===lt.name)),g=p?(0,j.jsx)(c.Localize,{i18n_default_text:"First, enter your {{label}} and the expiry date.",values:{label:r?.[0].label}}):(0,j.jsx)(c.Localize,{i18n_default_text:"First, enter your {{label}}.",values:{label:r?.[0].label}});return(0,j.jsx)("div",{className:(0,d.A)(et,{[`${et}--mobile`]:!n}),children:(0,j.jsx)(_.Formik,{initialValues:t||pt([...r||[],...u||[]]),validate:e=>ht(e,r,u),onSubmit:s,children:e=>{let{values:t,isValid:a,touched:s}=e;const d=Object.keys(s).length>0,f=Object.values(t).some(((e,t)=>(null===e||""===e)&&r?.[t]?.required));return(0,j.jsxs)(_.Form,{className:`${et}__form`,children:[(0,j.jsx)(h.A,{className:"form-body",scroll_offset:n?"80px":"180px",children:(0,j.jsxs)("div",{className:`${et}__fields-content`,children:[(0,j.jsx)(m.Text,{as:"h3",size:"s",color:"prominent",children:g}),(0,j.jsx)("div",{className:`${et}__fields-wrap`,children:r?.map((e=>(0,j.jsx)(ct,{data:e},e.name)))}),(0,j.jsx)("div",{className:`${et}__divider`}),(0,j.jsx)(m.Text,{as:"h3",size:"s",color:"prominent",children:l}),(0,j.jsx)("div",{className:`${et}__uploaders-wrap`,children:u?.map((e=>(0,j.jsx)(mt,{data:e,value:t[e.name],is_full:1===u.length||i},e.name)))}),(0,j.jsx)("div",{className:`${et}__icons`,children:xt.map((e=>"IcPoiDocExpiry"!==e.icon||p?(0,j.jsx)(gt,{data:e},e.icon):null))})]})}),(0,j.jsx)(x.A,{children:(0,j.jsxs)("div",{className:`${et}__btns`,children:[(0,j.jsx)(m.Button,{onClick:o,secondary:!0,large:!0,text:(0,c.localize)("Back")}),(0,j.jsx)(m.Button,{type:"submit",primary:!0,large:!0,is_disabled:!a||!d&&f,text:(0,c.localize)("Next")})]})})]})}})})},yt=e=>{let{initial_values:t,goBack:i,onConfirm:a,onFileDrop:o}=e;const{isDesktop:s}=(0,f.Y)();return(0,j.jsx)("div",{className:(0,d.A)(et,{[`${et}--mobile`]:!s}),children:(0,j.jsx)(_.Formik,{initialValues:t||pt([rt]),validate:e=>ht(e,void 0,[rt]),onSubmit:a,children:e=>{let t,a,{values:n,isValid:r,isSubmitting:l,touched:d}=e;return d&&(t=Object.keys(d).length>0),n&&(a=Object.values(n).some((e=>null===e||""===e))),(0,j.jsxs)(_.Form,{className:`${et}__form`,children:[(0,j.jsx)(h.A,{className:"form-body",scroll_offset:s?"8rem":"18rem",children:(0,j.jsxs)("div",{className:`${et}__fields-content`,children:[(0,j.jsx)(m.Text,{as:"h3",size:"s",weight:"bold",color:"prominent",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Upload your selfie"})}),(0,j.jsx)("div",{className:`${et}__uploaders-wrap`,children:(0,j.jsx)(mt,{data:rt,value:n?n[rt.name]:"",is_full:!0,onChange:o,has_frame:!0})}),(0,j.jsx)("div",{className:`${et}__notice`,children:(0,j.jsx)(m.Text,{as:"p",size:"xs",color:"general",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Before uploading, please ensure that you’re facing forward in the selfie, your face is within the frame, and your eyes are clearly visible even if you’re wearing glasses."})})})]})}),(0,j.jsx)(x.A,{children:(0,j.jsxs)("div",{className:`${et}__btns`,children:[(0,j.jsx)(m.Button,{onClick:i,secondary:!0,large:!0,text:(0,c.localize)("Back")}),(0,j.jsx)(m.Button,{type:"submit",primary:!0,large:!0,is_disabled:!r||l||!t&&a,text:(0,c.localize)("Confirm and upload")})]})})]})}})})},jt=e=>{let{data:t,goToCards:i,onComplete:a,is_from_external:o}=e;const[s,r]=n().useState(),[l,c]=n().useState(),[d,_]=n().useState(!1);return(0,j.jsx)(n().Fragment,{children:d?(0,j.jsx)(yt,{initial_values:l,goBack:()=>_(!1),onConfirm:e=>{a({...s,...e})},onFileDrop:e=>c({[rt.name]:e})}):(0,j.jsx)(bt,{initial_values:s,is_from_external:o,data:t,goToCards:i,onSubmit:e=>{r(e),_(!0)}})})},vt={IS_UPLOADING:"IS_UPLOADING",IS_COMPLETED:"IS_COMPLETED",IS_FAILED:"IS_FAILED"},zt=e=>{let{document:t,onClickBack:i,root_class:a,country_code_key:o,height:s,handleComplete:r,is_onfido_supported:d,is_from_external:_,is_for_mt5:u,handlePOIforMT5Complete:p,needs_poa:f,...h}=e;const[x,g]=n().useState(""),[b,y]=n().useState("");let v=!1;const z=e=>{var i;g(vt.IS_UPLOADING),(i=e,new Promise(((e,a)=>{const s=t.details.documents.map((e=>e.name)),n=Object.values(i).filter((e=>[...s,rt.name].includes(e.name))),r=n.length;let d=0;const _=[],u=()=>{const t=n[d],{file:s,document_type:m,pageType:p,lifetime_valid:f}=t,h="function"==typeof i.expiry_date?.format?i.expiry_date.format("YYYY-MM-DD"):void 0;((e,t,i)=>new Promise(((a,o)=>{e||o();const s=new(Pe())({connection:t()});let n=!1;(0,l.compressImageFiles)([e]).then((e=>{(0,l.readFiles)(e,Ee,i).then((e=>{e.forEach((e=>{e.message&&(n=!0,o(e))}));const t=e.length;!n&&t&&s.upload(e[0]).then(a).catch(o)})).catch((e=>console.error("error: ",e)))})).catch((e=>console.error("error: ",e)))})))(s,l.WS.getSocket,{document_type:m,page_type:p,expiration_date:h,document_id:i.document_id||"",lifetime_valid:+(f&&!h),document_issuing_country:o}).then((t=>{d+=1,t?.warning===Ae.DUPLICATE_DOCUMENT?g(vt.IS_DUPLICATE_UPLOAD):t?.warning||t.error?(v=!0,g(vt.IS_FAILED),y(t.message||(t.error?t.error.message:(0,c.localize)("Failed"))),d<r&&u()):d<r?(_.push(t),u()):e(_)})).catch((e=>{a(e)}))};u()}))).then((()=>{v||(u?p?.():g(vt.IS_COMPLETED))})).catch((e=>{g(vt.IS_FAILED),y(e.message)}))};switch(x){case vt.IS_UPLOADING:return(0,j.jsx)(m.Loading,{is_fullscreen:!1,is_slow_loading:!0,status:[(0,c.localize)("Uploading documents")]});case vt.IS_COMPLETED:return(0,j.jsx)(we,{is_from_external:!0,needs_poa:f,is_manual_upload:!0});case vt.IS_FAILED:return(0,j.jsx)(Le,{error:b});case vt.IS_DUPLICATE_UPLOAD:return(0,j.jsx)(Le,{error:(0,j.jsx)(c.Localize,{i18n_default_text:"It seems you’ve submitted this document before. Upload a new document."}),children:(0,j.jsx)(m.Button,{onClick:i,large:!0,primary:!0,className:"upload_error_btn",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Try Again"})})});default:return(0,j.jsx)(n().Fragment,{children:d?(0,j.jsxs)(n().Fragment,{children:[(0,j.jsxs)("div",{className:`${a}__detail-header`,onClick:i,children:[(0,j.jsx)(m.Icon,{icon:"IcArrowLeftBold"}),(0,j.jsx)(m.Text,{as:"p",size:"xs",weight:"bold",color:"prominent",className:`${a}__back-title`,children:(0,c.localize)("Back")})]}),(0,j.jsx)(Xe,{country_code:o,documents_supported:[t.onfido_name],height:s??null,handleComplete:u?p:r,is_default_enabled:!0,handleViewComplete:u?p:r,...h})]}):(0,j.jsx)(jt,{data:t.details,onComplete:z,goToCards:i,is_from_external:_})})}},wt=e=>{let{onClick:t,title:i,description:a,icon:o}=e;const{isDesktop:s}=(0,f.Y)();return(0,j.jsxs)("div",{className:"manual-poi__card",onClick:t,children:[(0,j.jsx)(m.Icon,{className:"manual-poi__card-icon",icon:o,size:64}),(0,j.jsxs)("div",{className:"manual-poi__card-content",children:[(0,j.jsx)(m.Text,{as:"p",size:"xs",weight:"bold",color:"prominent",children:i}),(0,j.jsx)(m.Text,{as:"p",size:s?"xxs":"xxxs",children:a})]}),(0,j.jsx)(m.Icon,{icon:"IcChevronRight",size:s?31:23})]})},St=e=>{let{toggleDetail:t,documents:i}=e;return(0,j.jsx)(n().Fragment,{children:i.map(((e,i)=>(0,j.jsx)(m.Card,{renderContent:()=>(0,j.jsx)(wt,{onClick:()=>t(i),...e.card})},e.card?.icon)))})},kt=e=>{let{country_code:t,handlePOIforMT5Complete:i,manual:a,redirect_button:o,needs_poa:s,handleBack:r,handleRequireSubmission:l,allow_poi_resubmission:d,handleViewComplete:_,onfido:u,is_for_mt5:p,is_resubmission:f,...h}=e;const[g,b]=n().useState(null),y=(e=>{let{country_code:t}=e;return[{onfido_name:"Passport",card:{title:(0,c.localize)("Passport"),description:(0,c.localize)("Upload the page that contains your photo."),icon:"IcPoiPassport"},details:{fields:[{name:"document_id",label:(0,c.localize)("Passport number"),type:"text",required:!0},{...lt}],documents_title:(0,c.localize)("Next, upload the page of your passport that contains your photo."),documents:[{document_type:"passport",pageType:ot,name:"passport",icon:"IcPassport",info:(0,c.localize)("Upload the page of your passport that contains your photo.")}]}},{onfido_name:"Driving Licence",card:{title:(0,c.localize)("Driving licence"),description:(0,c.localize)("Upload the front and back of your driving licence."),icon:"IcPoiDrivingLicence"},details:{fields_title:(0,c.localize)("First, enter your driving licence number and the expiry date."),fields:[{name:"document_id",label:(0,c.localize)("Driving licence number"),type:"text",required:!0},{...lt}],documents_title:(0,c.localize)("Next, upload the front and back of your driving licence."),documents:[{document_type:at,pageType:ot,name:"driving_licence_front",icon:"IcDrivingLicenceFront",info:(0,c.localize)("Upload the front of your driving licence.")},{document_type:at,pageType:st,name:"driving_licence_back",icon:"IcIdCardBack",info:(0,c.localize)("Upload the back of your driving licence.")}]}},{onfido_name:"National Identity Card",card:{title:(0,c.localize)("Identity card"),description:(0,c.localize)("Upload the front and back of your identity card."),icon:"IcPoiIdentityCard"},details:{fields_title:(0,c.localize)("First, enter your identity card number and the expiry date."),fields:[{name:"document_id",label:(0,c.localize)("Identity card number"),type:"text",required:!0},{...lt}],documents_title:(0,c.localize)("Next, upload the front and back of your identity card."),documents:[{document_type:tt,pageType:ot,name:"identity_card_front",icon:"IcIdCardFront",info:(0,c.localize)("Upload the front of your identity card.")},{document_type:tt,pageType:st,name:"identity_card_back",icon:"IcIdCardBack",info:(0,c.localize)("Upload the back of your identity card.")}]}},..."ng"===t?[{card:{title:(0,c.localize)("NIMC slip and proof of age"),description:(0,c.localize)("Upload both of these documents to prove your identity."),icon:"IcPoiNimcSlip"},details:{fields:[{name:"document_id",label:(0,c.localize)("NIMC slip number"),type:"text",required:!0}],documents_title:(0,c.localize)("Next, upload both of the following documents."),documents:[{document_type:it,lifetime_valid:!0,pageType:ot,name:"nimc_slip",icon:"IcPoiNimcSlipHorizontal",info:(0,c.localize)("Upload your NIMC slip.")},{document_type:"birth_certificate",pageType:nt,name:"birth_certificate_front",icon:"IcDop",info:(0,c.localize)("Upload your proof of age: birth certificate or age declaration document.")}]}}]:[]]})({country_code:t});if(a){if(a.status===Q.pending)return(0,j.jsx)(Se,{is_manual_upload:!0,needs_poa:s,redirect_button:o});if([Q.rejected,Q.suspected].some((e=>e===a.status))){if(!d)return(0,j.jsx)(ye,{})}else{if(a.status===Q.verified)return(0,j.jsx)(Ne,{needs_poa:s,redirect_button:o});if(a.status===Q.expired)return(0,j.jsx)(re,{redirect_button:o,handleRequireSubmission:l})}}if(null!==g){const e="ng"===t&&!(e=>{let t=!1;return e.forEach((e=>{e.document_type===it&&(t=!0)})),t})(y[g??0].details.documents)&&u&&u.submissions_left>0;return(0,j.jsx)(zt,{is_onfido_supported:e,country_code_key:t,document:y[g],root_class:"manual-poi",onClickBack:()=>b(null),handlePOIforMT5Complete:i,handleComplete:_,is_for_mt5:p,needs_poa:s,...h})}return(0,j.jsxs)("div",{className:"manual-poi",children:[(0,j.jsx)(m.Text,{as:"h2",color:"prominent",size:"xs",className:"manual-poi__title",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Please upload one of the following documents:"})}),(0,j.jsx)(St,{documents:y,toggleDetail:e=>b(e)}),!p&&!f&&(0,j.jsx)(x.A,{className:"proof-of-identity__footer",children:(0,j.jsx)(m.Button,{className:"back-btn",onClick:r,type:"button",has_effect:!0,large:!0,secondary:!0,children:(0,j.jsx)(c.Localize,{i18n_default_text:"Back"})})})]})},Nt=e=>{let{handleRequireSubmission:t,is_from_external:i,needs_poa:a,onfido:o,redirect_button:s,manual:n,country_code:r,handleViewComplete:c}=e;const{status:d,submissions_left:_,last_rejected:u}=o;switch(d){case Q.pending:return(0,j.jsx)(Se,{is_from_external:i,needs_poa:a,redirect_button:s});case Q.rejected:case Q.suspected:case Q.expired:{const e=(0,l.formatOnfidoError)(d,u);return Number(_)<1?(0,j.jsx)(kt,{manual:n,is_from_external:i,country_code:r,handleViewComplete:c,onfido:o}):(0,j.jsx)(Te,{rejected_reasons:e,handleRequireSubmission:t})}case Q.verified:return(0,j.jsx)(Ne,{is_from_external:i,needs_poa:a,redirect_button:s,service:ie});default:return null}},Ct=e=>{let{handleSelectionNext:t,is_from_external:i,mismatch_status:a}=e;const{setSelectedCountry:o}=n().useContext(l.POIContext),{data:s,isLoading:r}=(0,u.useResidenceList)(),{isDesktop:p}=(0,f.Y)(),h=e=>{const t=s?.find((t=>t.text===e));t&&o?.(t)},g=a?l.IDV_ERROR_STATUS[a]?.message??null:null;return(0,j.jsx)(_.Formik,{initialValues:{country_input:""},validate:e=>{const t={},{country_input:i}=e;return i?s.find((e=>e.text===i))||(t.country_input=(0,c.localize)("Please select a valid country of document issuance.")):t.country_input=(0,c.localize)("Please select the country of document issuance."),t},onSubmit:(e,i)=>{let{setSubmitting:a}=i;h(e.country_input),a(!1),t?.()},children:e=>{let{dirty:t,errors:a,handleBlur:o,handleChange:l,handleSubmit:u,isSubmitting:f,isValid:b,setFieldValue:y,touched:v,values:z}=e;return(0,j.jsxs)(n().Fragment,{children:[(0,j.jsxs)("div",{className:(0,d.A)("proof-of-identity__container proof-of-identity__country-container",{"min-height":!i}),children:[g?(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(m.Text,{align:"center",weight:"bold",size:p?"s":"xs",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Your identity verification failed because:"})}),(0,j.jsx)(m.HintBox,{className:(0,d.A)("proof-of-identity__failed-message","hint-box-layout"),icon:"IcAlertDanger",message:(0,j.jsx)(m.Text,{as:"p",size:p?"xs":"xxs",children:g}),is_danger:!0})]}):(0,j.jsx)(m.Text,{className:"proof-of-identity__header",align:"center",weight:"bold",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Proof of identity"})}),(0,j.jsx)(m.Text,{className:"proof-of-identity__country-text ",size:"xs",children:(0,j.jsx)(c.Localize,{i18n_default_text:"In which country was your document issued?"})}),(0,j.jsx)("fieldset",{className:"proof-of-identity__fieldset",children:(0,j.jsx)(_.Field,{name:"country_input",children:e=>{let{field:t}=e;return(0,j.jsx)(n().Fragment,{children:p?(0,j.jsx)(m.Autocomplete,{className:(0,d.A)({"external-dropdown":i}),...t,data_testid:"dt_external_dropdown",name:"country_input","data-lpignore":"true",error:v.country_input&&a.country_input,autoComplete:"off",type:"text",label:(0,c.localize)("Country"),list_items:s,value:z.country_input,onBlur:e=>{o(e);const t=e.target.value;s.find((e=>e.text===t))||(y("country_input","",!0),h(""))},onChange:l,onItemSelection:e=>{let{text:t}=e;y("country_input","No results found"!==t&&t?t:"",!0),h(t)},required:!0}):(0,j.jsx)("div",{className:"proof-of-identity__dropdown-container",children:(0,j.jsx)(m.SelectNative,{...t,name:"country_input",error:v.country_input&&a.country_input,label:(0,c.localize)("Country"),placeholder:(0,c.localize)("Please select"),list_items:s,value:z.country_input,onChange:e=>{l(e),h(e.target.value)},use_text:!0,required:!0})})})}})})]}),(0,j.jsx)(x.A,{className:(0,d.A)("proof-of-identity__footer",{"external-footer":i}),children:(0,j.jsx)(m.Button,{className:"proof-of-identity__submit-button",type:"submit",onClick:()=>u(),has_effect:!0,is_disabled:!t||f||!b||r,is_loading:!1,text:(0,c.localize)("Next"),large:!0,primary:!0})})]})}})},It=e=>{let{class_name:t,selected_country:i,hide_hint:a,is_for_real_account_signup_modal:o=!1,is_for_mt5:s=!1}=e;const[r,u]=n().useState([]),[p,h]=n().useState(""),{isDesktop:x}=(0,f.Y)(),{documents_supported:g}=i?.identity?.services?.idv??{},{errors:b,touched:y,values:v,handleBlur:z,handleChange:w,setFieldValue:S}=(0,_.useFormikContext)(),k={id:"",text:"",value:"",example_format:""},C=n().useMemo((()=>(0,l.getIDVNotApplicableOption)(o)),[o]);n().useEffect((()=>{if(g&&i&&i.value){const e=Object.keys(g);if(0===e.length)return;const t=e.map((e=>{const{display_name:t,format:a}=g[e],{new_display_name:o,example_format:s,additional_document_example_format:n}=(0,N.UC)(i.value??"",e);return g[e].additional?{id:e,text:t??o,additional:{display_name:g[e].additional?.display_name,format:g[e].additional?.format,example_format:n},value:a,example_format:s}:{id:e,text:t??o,value:a,example_format:s}}));u([...t,C])}}),[g,i,C,s]);const I=()=>{S("document_type",k,!0)},T=e=>r.find((t=>t.text===e))??k,L=(e,t)=>{const i="document_number"===t?v?.document_type?.example_format:v?.document_type?.additional?.example_format;let a=null;a=i?.includes("-")?(0,l.formatInput)(i,a??e.target.value,"-"):e.target.value,S(t,a,!0)},A=e=>{S("document_type",e,!0),h(e?.id),e?.id===C.id&&(S("document_number","",!1),S("document_additional","",!1))};return(0,j.jsx)("section",{className:(0,d.A)("idv-form",t),children:(0,j.jsx)("div",{className:"details-form",children:(0,j.jsx)("div",{className:"poi-form-on-signup__fields",children:(0,j.jsx)("div",{className:(0,d.A)("proof-of-identity__container",{"proof-of-identity__container--idv":a}),children:(0,j.jsx)("div",{className:(0,d.A)("proof-of-identity__inner-container"),children:(0,j.jsxs)("div",{className:"proof-of-identity__fieldset-container",children:[(0,j.jsx)("fieldset",{className:(0,d.A)({"proof-of-identity__fieldset":!a}),children:(0,j.jsx)(_.Field,{name:"document_type",children:e=>{let{field:t}=e;return(0,j.jsx)(n().Fragment,{children:x?(0,j.jsx)(m.Autocomplete,{...t,"data-lpignore":"true",error:y.document_type&&b.document_type,autoComplete:"off",type:"text",label:(0,c.localize)("Choose the document type"),list_items:r,value:v.document_type.text,onBlur:e=>{z(e),T(e.target.value)||I()},onChange:w,onItemSelection:e=>{"No results found"!==e.text&&e.text?A(e):(h(""),I())},required:!0}):(0,j.jsx)(m.SelectNative,{...t,name:"document_type",error:y.document_type&&b.document_type,label:(0,c.localize)("Choose the document type"),placeholder:(0,c.localize)("Please select"),list_items:r,value:v.document_type.text,onChange:e=>{w(e);const t=T(e.target.value);A(t)},use_text:!0,required:!0})})}})}),v?.document_type?.id!==C.id&&(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)("fieldset",{className:(0,d.A)("additional-field",{"proof-of-identity__fieldset-input":!a}),children:(0,j.jsx)(_.Field,{name:"document_number",children:e=>{let{field:t}=e;return(0,j.jsx)(m.Input,{...t,name:"document_number",bottom_label:v.document_type&&(0,N.mQ)(v.document_type.example_format??""),disabled:!v.document_type.id,error:v.document_type.id&&y.document_number&&b.document_number||b.error_message,autoComplete:"off",placeholder:(0,N._c)(p),value:v.document_number,onPaste:N.bu,onBlur:z,onChange:w,onKeyUp:e=>L(e,"document_number"),required:!0,label:v.document_type.id&&(0,N._c)(p)})}})}),v.document_type.additional?.display_name&&(0,j.jsx)("fieldset",{className:"additional-field",children:(0,j.jsx)(_.Field,{name:"document_additional",children:e=>{let{field:t}=e;const i=(0,c.localize)("Enter your {{document_name}}",{document_name:v.document_type?.additional?.display_name?.toLowerCase()??(0,c.localize)("additional document number")});return(0,j.jsx)(m.Input,{...t,name:"document_additional",bottom_label:v.document_type.additional&&(0,N.mQ)(v.document_type.additional?.example_format),disabled:!v.document_type.id,error:y.document_additional&&b.document_additional||b.error_message,autoComplete:"off",placeholder:i,value:v.document_additional,onPaste:N.bu,onBlur:z,onChange:w,onKeyUp:e=>L(e,"document_additional"),required:!0})}})})]})]})})})})})})},Tt=(0,o.observer)((e=>{let{handleBack:t,handleViewComplete:i,handleSelectionNext:a,selected_country:s}=e;const{client:r}=(0,o.useStore)(),{account_settings:u,getChangeableFields:p}=r,{isDesktop:b}=(0,f.Y)(),y=n().useMemo((()=>(0,l.getIDVNotApplicableOption)()),[]),v=e=>e===y.id,z=(0,j.jsx)(le.DerivLightNameDobPoiIcon,{height:"195px",width:"285px"}),w=(0,l.filterObjProperties)(u,["first_name","last_name","date_of_birth"]);w.date_of_birth&&(w.date_of_birth=(0,l.toMoment)(w.date_of_birth).format("YYYY-MM-DD"));const S=p(),k={document_type:{id:"",text:"",value:"",example_format:""},document_number:"",...w,confirmation_checkbox:!1};return(0,j.jsx)(_.Formik,{initialValues:{...k},validate:e=>{const t={},{document_type:i,document_number:a,document_additional:o}=e;if(v(i.id))return t;const s=!!i.additional;return t.document_type=(0,N.k4)(i),(0,N.DY)(i?.id)||(s&&(t.document_additional=(0,N.dC)(i,o)),t.document_number=(0,N.Zy)(a,i)),(0,N.tf)(t,e)((e=>e),["first_name","last_name","date_of_birth"],(0,c.localize)("This field is required")),e.first_name&&(t.first_name=(0,N.yS)(e.first_name)),e.last_name&&(t.last_name=(0,N.yS)(e.last_name)),e.confirmation_checkbox||(t.confirmation_checkbox="error"),(0,l.removeEmptyPropertiesFromObject)(t)},onSubmit:async(e,t)=>{let{setSubmitting:o,setStatus:n}=t;if(v(e?.document_type?.id))return void a?.(!0);o(!0);const r=(0,N.Di)(e,S),c=await l.WS.setSettings(r);if(c?.error)return n({error_message:c.error?.code===Ae.DUPLICATE_ACCOUNT?We:$e}),void o(!1);const d=await l.WS.authorized.storage.getSettings();if(d?.error)return n({error_message:d?.error?.message??$e}),void o(!1);const _={identity_verification_document_add:1,...(0,l.formatIDVFormValues)(e,s.value)},u=await l.WS.send(_);if(u?.error)return n({error_message:u.error?.code===Ae.CLAIMED_DOCUMENT?He:u.error?.message??$e}),void o(!1);o(!1),i()},enableReinitialize:!0,children:e=>{let{dirty:i,isSubmitting:a,isValid:o,values:r,status:l}=e;const u=v(r?.document_type?.id),p=!u&&(!i||a||!o);return(0,j.jsxs)(_.Form,{className:(0,d.A)("proof-of-identity__container proof-of-identity__container--reset",{"min-height":v(r?.document_type?.id)}),children:[l?.error_message&&(0,j.jsx)("div",{className:"account-form__poi-confirm-example--generic-error-msg",children:(0,j.jsx)(m.HintBox,{icon:"IcAlertDanger",message:(0,j.jsx)(m.Text,{as:"p",size:"xxxs",children:l.error_message}),is_danger:!0,className:"hint-box-layout"})}),(0,j.jsxs)(h.A,{className:"form-body",scroll_offset:b?"80px":"180px",children:[(0,j.jsx)(g.A,{title:(0,c.localize)("Identity verification")}),(0,j.jsx)(It,{selected_country:s,class_name:"idv-layout"}),!v(r?.document_type?.id)&&(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(g.A,{title:(0,c.localize)("Details")}),(0,j.jsx)(qe,{class_name:"account-form__poi-confirm-example_container",is_rendered_for_idv:!0,editable_fields:r.confirmation_checkbox?[]:S,side_note:z,inline_note_text:(0,j.jsx)(c.Localize,{i18n_default_text:"To avoid delays, enter your <0>name</0> and <0>date of birth</0> exactly as they appear on your identity document.",components:[(0,j.jsx)("strong",{},0)]})})]})]}),(0,j.jsxs)(x.A,{className:"proof-of-identity__footer ",children:[b&&(0,j.jsx)(m.Button,{className:"back-btn",onClick:t,type:"button",has_effect:!0,large:!0,secondary:!0,children:(0,j.jsx)(c.Localize,{i18n_default_text:"Back"})}),(0,j.jsx)(m.Button,{className:"proof-of-identity__submit-button",type:"submit",has_effect:!0,is_disabled:p,large:!0,primary:!0,children:u?(0,j.jsx)(c.Localize,{i18n_default_text:"Next"}):(0,j.jsx)(c.Localize,{i18n_default_text:"Verify"})})]})]})}})})),Lt=e=>{let{getChangeableFields:t,is_from_external:i,residence_list:a,account_settings:s,handleSubmit:r,mismatch_status:u=l.IDV_ERROR_STATUS.Failed.code,latest_status:p,selected_country:b,handleSelectionNext:y}=e;const{client:v}=(0,o.useStore)(),{setIsAlreadyAttempted:z}=v,{isMobile:w,isDesktop:k}=(0,f.Y)(),[C,I]=n().useState({required_fields:[],side_note_image:(0,j.jsx)(le.DerivLightNameDobPoiIcon,{height:"195px",width:"285px"}),failure_message:null,inline_note_text:null}),[T,L]=n().useState(!0),[A,D]=n().useState({api_error:"",errors:!1,form_initial_values:{},changeable_fields:[]}),P=n().useMemo((()=>![l.IDV_ERROR_STATUS.DobMismatch.code,l.IDV_ERROR_STATUS.NameMismatch.code,l.IDV_ERROR_STATUS.NameDobMismatch.code].includes(u)),[u]),E=n().useMemo((()=>P&&!i?b??{}:a.find((e=>e.value===p?.country_code))??{}),[b,P,p?.country_code,a,i]),F=n().useMemo((()=>(0,l.getIDVNotApplicableOption)()),[]),R=e=>e===F.id;return n().useEffect((()=>{z(!0);const e=Ge(P,p,E,u);I(e),(async e=>{await(l.WS?.wait("get_settings"));const i=(0,l.filterObjProperties)(s,e);i.date_of_birth&&(i.date_of_birth=(0,l.toMoment)(i.date_of_birth).format("YYYY-MM-DD")),i.confirmation_checkbox=!1;let a=i;P&&(a={document_type:{id:"",text:"",value:"",example_format:"",sample_image:""},document_number:"",...a}),D({form_initial_values:{...a},changeable_fields:[...t()],api_error:""}),L(!1)})(e?.required_fields??[]).catch((e=>{D({form_initial_values:{},changeable_fields:[],api_error:e?.error?.message})}))}),[u,s,P,t,Ge,z]),A?.api_error?(0,j.jsx)(S.A,{error_message:A.api_error}):T&&0===Object.keys(A?.form_initial_values??{}).length?(0,j.jsx)(m.Loading,{is_fullscreen:!1,className:"account__initial-loader"}):(0,j.jsx)(_.Formik,{initialValues:A?.form_initial_values??{},onSubmit:async(e,t)=>{let{setStatus:i,setSubmitting:a}=t;if(R(e?.document_type?.id))return void y?.(!0);delete e.confirmation_checkbox,a(!0),i({error_msg:null});const{document_number:o,document_type:s}=e,n=(0,N.Di)(e,A?.changeable_fields?[...A.changeable_fields]:[]),c=await l.WS.setSettings(n);if(c.error)i({error_msg:c.error?.code===Ae.DUPLICATE_ACCOUNT?We:$e}),a(!1);else{const e=await l.WS.authorized.storage.getSettings();if(e.error)return D((t=>({...t,api_error:e.error.message}))),void a(!1);const t={identity_verification_document_add:1,document_number:o,document_type:s?.id,issuing_country:E.value};if(!t.document_type||R(t.document_type))return a(!1),void r();const n=await l.WS.send(t);if(n?.error)return i({error_msg:n.error?.code===Ae.CLAIMED_DOCUMENT?He:n?.error?.message??$e}),void a(!1);a(!1),r()}},validate:e=>{const t={};if(P){const{document_type:i,document_number:a,document_additional:o}=e;if(R(i?.id))return t;const s=!!i?.additional;t.document_type=(0,N.k4)(i),(0,N.DY)(i?.id)||(s&&(t.document_additional=(0,N.dC)(i,o)),t.document_number=(0,N.Zy)(a??"",i))}return(0,N.tf)(t,e)((e=>e),C?.required_fields??[],(0,c.localize)("This field is required")),e.first_name&&(t.first_name=(0,N.yS)(e.first_name)),e.last_name&&(t.last_name=(0,N.yS)(e.last_name)),e.confirmation_checkbox||(t.confirmation_checkbox="error"),D((e=>({...e,errors:!(0,l.isEmptyObject)((0,l.removeEmptyPropertiesFromObject)(t))}))),(0,l.removeEmptyPropertiesFromObject)(t)},className:"proof-of-identity__container",children:e=>{let{isSubmitting:t,isValid:a,dirty:o,status:s,values:n}=e;return(0,j.jsxs)(_.Form,{className:(0,d.A)("proof-of-identity__mismatch-container",{"upload-layout":P,"min-height":R(n?.document_type?.id)}),children:[(0,j.jsxs)(h.A,{className:"form-body",scroll_offset:k?"80px":i?"140px":"180px",children:[(0,j.jsx)(m.Text,{size:w?"xs":"s",weight:"bold",align:"center",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Your identity verification failed because:"})}),(s?.error_msg||C?.failure_message)&&(0,j.jsx)(m.HintBox,{className:(0,d.A)("proof-of-identity__failed-message","hint-box-layout"),icon:"IcAlertDanger",message:(0,j.jsx)(m.Text,{as:"p",size:w?"xxs":"xs","data-testid":u,children:s?.error_msg??C?.failure_message}),is_danger:!0}),P&&(0,j.jsxs)("div",{children:[(0,j.jsx)(m.Text,{size:"xs",align:w?"left":"center",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Let’s try again. Choose another document and enter the corresponding details."})}),(0,j.jsx)(g.A,{title:(0,c.localize)("Identity verification")}),(0,j.jsx)(It,{selected_country:E,class_name:"idv-layout idv-resubmit"}),!R(n?.document_type?.id)&&(0,j.jsx)(g.A,{title:(0,c.localize)("Details")})]}),!R(n?.document_type?.id)&&(0,j.jsx)(qe,{class_name:"account-form__poi-confirm-example_container",editable_fields:n.confirmation_checkbox?[]:A?.changeable_fields,is_rendered_for_idv:!0,side_note:C?.side_note_image,inline_note_text:C?.inline_note_text,mismatch_status:u})]}),(0,j.jsx)(x.A,{className:"proof-of-identity__footer",children:(0,j.jsx)(m.Button,{className:"proof-of-identity__submit-button",type:"submit",has_effect:!0,is_disabled:!o||t||!a,text:(r=R(n?.document_type?.id),r?(0,c.localize)("Next"):P?(0,c.localize)("Verify"):(0,c.localize)("Update profile")),large:!0,primary:!0})})]});var r}})},At=(0,o.observer)((e=>{let{allow_poi_resubmission:t,has_require_submission:i,height:a,identity_last_attempt:s,idv:r,is_from_external:c,is_idv_disallowed:d,needs_poa:_,onfido:u,onStateChange:m,redirect_button:p,residence_list:f,should_show_mismatch_form:h}=e;const{submission_service:x,setSubmissionService:g,submission_status:b,setSubmissionStatus:y,selected_country:v,setSelectedCountry:z}=n().useContext(l.POIContext),{client:w,notifications:S}=(0,o.useStore)(),{account_settings:k,getChangeableFields:N,account_status:C}=w,{refreshNotifications:I}=S,T="high"===C.risk_classification,L=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(Object.keys(v).length){const{submissions_left:t}=r,{submissions_left:i}=u,a=v.identity.services.idv.is_country_supported,o=v.identity.services.onfido.is_country_supported&&"ng"!==v.value;!e&&a&&Number(t)>0&&!d?g(te):!e&&Number(i)>0&&o?g(ie):g(ae),y(X)}},A=()=>{m&&"function"==typeof m&&m(Q.pending),y(ee),l.WS.authorized.getAccountStatus().then((()=>{I()}))},D=()=>y(Z),P=n().useCallback((e=>f.find((t=>t.value===e))),[f]),E=i||t,F=(0,l.isIDVReportNotAvailable)(r),R=(0,l.formatIDVError)(r.last_rejected,r.status,T,F),O=n().useCallback((e=>{const{service:t,country_code:i}=e;switch(z(P(i)),t){case te:case ie:Number(r.submissions_left)>0||Number(u.submissions_left)>0?y(Z):(g(ae),y(X));break;case ae:g(ae),y(X)}}),[P,r.submissions_left,u.submissions_left,z,g,y,d]);switch(n().useEffect((()=>{b==Z&&(E&&s?O(s):R&&[l.IDV_ERROR_STATUS.DobMismatch.code,l.IDV_ERROR_STATUS.NameMismatch.code,l.IDV_ERROR_STATUS.NameDobMismatch.code].includes(R)&&r.submissions_left>0?(g(te),y(X)):y(Z))}),[t,s,E,O,b,r,R,g,y]),b){case Z:return(0,j.jsx)(Ct,{handleSelectionNext:L,is_from_external:c,mismatch_status:R});case X:switch(x){case te:return h?(0,j.jsx)(Lt,{account_settings:k,getChangeableFields:N,mismatch_status:R,residence_list:f,handleSubmit:A,latest_status:s,selected_country:v,handleSelectionNext:L,report_available:!!r?.report_available}):(0,j.jsx)(Tt,{handleSelectionNext:L,handleViewComplete:A,handleBack:D,selected_country:v});case ie:{const e=v.value,t=v.identity.services.onfido.documents_supported,i=Object.keys(t).map((e=>t[e].display_name));return(0,j.jsx)(Xe,{country_code:e,documents_supported:i,getChangeableFields:N,handleViewComplete:A,height:a})}case ae:return(0,j.jsx)(kt,{country_code:v.value,is_from_external:c,allow_poi_resubmission:t,handleViewComplete:A,onfido:u,handleBack:D,is_resubmission:E});default:return null}case ee:switch(x){case te:return(0,j.jsx)(pe,{is_from_external:c,mismatch_status:R,needs_poa:_,redirect_button:p});case ae:return(0,j.jsx)(Se,{is_from_external:c,needs_poa:_,redirect_button:p,is_manual_upload:!0});case ie:return(0,j.jsx)(Se,{is_from_external:c,needs_poa:_,redirect_button:p});default:return null}default:return null}})),Dt=At,Pt=e=>{if(!e||!e.authentication)return{};const{attempts:t,document:i,identity:a,income:o,needs_verification:s}=e.authentication,n=a.status,r=i.status,l=o.status,c=e.status.some((e=>"allow_document_upload"===e)),d=e.status.some((e=>"allow_poi_resubmission"===e)),_=e.status.some((e=>"allow_poa_resubmission"===e)),u=e.status.some((e=>"allow_poinc_resubmission"===e)),m=e.status.some((e=>"age_verification"===e)),p=e.status.some((e=>"authenticated"===e)),f=e.status.some((e=>"idv_disallowed"===e)),h=e.status.some((e=>"poa_address_mismatch"===e)),x=e.status.some((e=>"poi_expiring_soon"===e)),g=e.status.some((e=>"poa_authenticated_with_idv"===e)),b=e.status.some((e=>"poa_authenticated_with_idv_photo"===e)),y=e.status.some((e=>"poa_expiring_soon"===e)),j=["pending","verified"].includes(n),v=!(i&&"none"===i.status),z=!(a&&"none"===a.status),w=!(o&&"none"===o.status),S="pending"===r&&!_,k=!(S||"verified"===r)||s.length&&s.includes("document"),N=!j||Boolean(s.length)&&s.includes("identity"),C=s.length&&s.includes("income"),{idv:I,onfido:T,manual:L}=a.services,A=t.latest;return{allow_document_upload:c,allow_poa_resubmission:_,allow_poi_resubmission:d,allow_poinc_resubmission:u,has_attempted_idv:Boolean(t.history.length&&t.history.find((e=>"idv"===e.service))),has_poa:v,has_poi:z,has_poinc:w,has_submitted_poa:S,identity_last_attempt:A,identity_status:n,document_status:r,income_status:l,idv:I,is_age_verified:m,is_fully_authenticated:p,is_idv_disallowed:f,manual:L,needs_poa:k,needs_poi:N,needs_poinc:C,needs_verification:s,onfido:T,poa_address_mismatch:h,poa_authenticated_with_idv:g,poa_authenticated_with_idv_photo:b,poi_expiring_soon:x,poa_expiring_soon:y}},Et=(0,o.observer)((e=>{let{height:t,is_from_external:i,onStateChange:s,getChangeableFields:r,updateAccountStatus:d}=e;const _=(0,a.useHistory)(),[u,p]=n().useState(),[f,h]=n().useState(!1),[x,g]=n().useState([]),[b,y]=n().useState(!0),{client:v,common:z,notifications:w}=(0,o.useStore)(),{account_settings:S,account_status:k,fetchResidenceList:N,is_switching:C,is_high_risk:I,is_withdrawal_lock:T,should_allow_authentication:L,is_virtual:A}=v,{app_routing_history:D,routeBackInApp:P,is_language_changing:E}=z,{refreshNotifications:F}=w,R=(0,l.getPlatformRedirect)(D),O=Object.keys(l.platforms).includes(R?.ref),M=()=>h(!0),U=S?.citizen||S?.country_code,q=()=>{l.WS.authorized.getAccountStatus().then((()=>{F()}))},B=n().useCallback((()=>{N().then((e=>{e.error?p(e.error):g(e.residence_list)}))}),[N]);if(n().useEffect((()=>{E&&B()}),[E,B]),n().useEffect((()=>{C||(p(null),l.WS.authorized.getAccountStatus().then((e=>{if(e.error)return p(e.error),void y(!1);B(),y(!1)})))}),[B,C]),u)return(0,j.jsx)(se.A,{error_message:u?.message||u});if(b||C||(0,l.isEmptyObject)(k)||0===x.length)return(0,j.jsx)(m.Loading,{is_fullscreen:!1});if(A)return(0,j.jsx)(oe.A,{});const Y=Pt(k),{identity:V,idv:$,allow_poi_resubmission:W,identity_last_attempt:H,identity_status:G,is_age_verified:J,is_idv_disallowed:K,manual:Z,needs_poa:X,onfido:ee,poi_expiring_soon:ne}=Y,le=I&&T;if(!L&&!J&&!ne)return(0,j.jsx)(je,{});const ce=O&&(0,j.jsx)(m.Button,{primary:!0,className:"proof-of-identity__redirect",onClick:()=>{const e=l.platforms[R.ref],{is_hard_redirect:t=!1,url:i=""}=e??{};var a;t?(window.location.href=i,window.sessionStorage.removeItem("config.platform")):(a=R.route,P(_,[a]))},children:(0,j.jsx)(c.Localize,{i18n_default_text:"Back to {{platform_name}}",values:{platform_name:R.name}})}),de=G!=Q.verified&&$.submissions_left>0&&[Q.rejected,Q.suspected,Q.expired].includes($.status);if(G===Q.none||f||W||de||ne)return(0,j.jsx)(Dt,{account_settings:S,allow_poi_resubmission:W,has_require_submission:f,height:t??null,getChangeableFields:r,identity_last_attempt:H,idv:$,is_from_external:!!i,is_idv_disallowed:K||le,manual:Z,needs_poa:X,onfido:ee,onStateChange:s,redirect_button:ce,refreshNotifications:F,residence_list:x,updateAccountStatus:d,should_show_mismatch_form:de});if(!H||G===Q.verified&&G!==V?.services[H?.service].status)switch(G){case Q.pending:return(0,j.jsx)(Se,{is_from_external:!!i,needs_poa:X,redirect_button:ce,is_manual_upload:"pending"===Z?.status});case Q.verified:return(0,j.jsx)(Ne,{is_from_external:!!i,needs_poa:X,redirect_button:ce,service:H?.service});case Q.expired:return(0,j.jsx)(re,{is_from_external:!!i,redirect_button:ce,handleRequireSubmission:M});case Q.rejected:case Q.suspected:return(0,j.jsx)(ye,{handleRequireSubmission:M})}switch(H.service){case te:return(0,j.jsx)(ge,{account_settings:S,handleRequireSubmission:M,getChangeableFields:r,idv:$,is_from_external:!!i,needs_poa:X,redirect_button:ce,residence_list:x});case ie:return(0,j.jsx)(Nt,{handleRequireSubmission:M,is_from_external:!!i,needs_poa:X,onfido:ee,manual:Z,redirect_button:ce,country_code:U,handleViewComplete:q});case ae:return(0,j.jsx)(kt,{manual:Z,country_code:U,is_from_external:i,needs_poa:X,redirect_button:ce,handleRequireSubmission:M,handleViewComplete:q,onfido:ee});default:return null}})),Ft=Et,Rt=(0,r.withRouter)((e=>{let{is_from_external:t,onStateChange:i}=e;return(0,j.jsx)(m.AutoHeightWrapper,{children:e=>{let{setRef:a,height:o}=e;return(0,j.jsx)("div",{ref:a,className:"proof-of-identity",children:(0,j.jsx)("div",{className:"proof-of-identity__main-container",children:(0,j.jsx)(Ft,{height:o,is_from_external:t,onStateChange:i})})})}})})),Ot=(0,o.observer)((()=>{const{client:{getToken:e,residence:t},common:{is_from_tradershub_os:i}}=(0,o.useStore)(),{kyc_auth_status:a}=I({country:t}),[s,n]=(0,p.useGrowthbookGetFeatureValue)({featureFlag:"redirect_to_poi_in_accounts_os"});if(n){if(!s||!a)return(0,j.jsx)(Rt,{});{const{identity:t}=a,o="none"===t.status||"required"===t.status?l.ACCOUNTS_OS_POI_URL:l.ACCOUNTS_OS_POI_STATUS_URL;window.location.href=(t=>{const a=new URL(t),o={platform:new URLSearchParams(location.search).get("platform")??(i?"tradershub_os":"deriv_app"),appid:(0,l.getAppId)(),lang:"en",server:(0,l.getSocketURL)(),token:e()};return Object.entries(o).forEach((e=>{let[t,i]=e;a.searchParams.append(t,i)})),a.toString()})(o)}}return(0,j.jsx)(m.Loading,{is_fullscreen:!1,className:"account__initial-loader"})})),Mt=e=>{let{onClick:t}=e;return(0,j.jsx)("div",{className:"account-management__container",children:(0,j.jsx)(ne.A,{message:(0,j.jsx)(c.Localize,{i18n_default_text:"New proof of address is needed"}),text:(0,j.jsx)(c.Localize,{i18n_default_text:"Your document for proof of address is expired. <0/>Please submit again.",components:[(0,j.jsx)("br",{},0)]}),icon:(0,j.jsx)(m.Icon,{icon:"IcPoaUpload",size:128}),children:(0,j.jsx)(m.Button,{onClick:t,has_effect:!0,primary:!0,children:(0,j.jsx)(m.Text,{className:"dc-btn__text",size:"xs",weight:"bold",as:"p",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Resubmit"})})})})})},Ut=()=>(0,j.jsx)(ne.A,{message:(0,c.localize)("Proof of address verification not required"),text:(0,c.localize)("Your account does not need address verification at this time. We will inform you if address verification is required in the future."),icon:(0,j.jsx)(m.Icon,{icon:"IcPoaVerified",size:128})}),qt=()=>{const{isDesktop:e,isMobile:t}=(0,f.Y)();return(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(m.Icon,{icon:"IcUpload",className:"dc-file-dropzone__message-icon",size:30}),(0,j.jsxs)("div",{className:"dc-file-dropzone__message-subtitle",children:[(0,j.jsx)(m.Text,{size:"xxs",align:"center",weight:"bold",color:"less-prominent",children:e?(0,j.jsx)(c.Localize,{i18n_default_text:"Drag and drop a file or click to browse your files."}):(0,j.jsx)(c.Localize,{i18n_default_text:"Click here to browse your files."})}),(0,j.jsx)(m.Text,{size:t?"xxxxs":"xxxs",align:"center",color:"less-prominent",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Remember, selfies, pictures of houses, or non-related images will be rejected."})})]})]})},Bt=e=>{let{onFileDrop:t,onError:i}=e;const[a,o]=n().useState([]),[s,r]=n().useState(null);return n().useEffect((()=>{a&&(t(a),i?.(""))}),[a,t,i]),(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(m.FileDropzone,{accept:l.supported_filetypes,error_message:(0,c.localize)("Please upload supported file type."),filename_limit:26,hover_message:(0,c.localize)("Drop files here.."),max_size:l.max_document_size,message:(0,j.jsx)(qt,{}),multiple:!1,onDropAccepted:e=>{e.length>0&&(o(e),r(null),i?.(""))},onDropRejected:e=>{const t=e.length>0&&e[0].file.size>l.max_document_size,a=e.filter((e=>(0,l.getSupportedFiles)(e.file.name))),s=t&&a.length>0?(0,c.localize)("File size should be 8MB or less"):(0,c.localize)("File uploaded is not supported");o([]),i?.(s),r(s)},validation_error_message:s,value:a}),(a&&a?.length>0||s)&&(0,j.jsx)("div",{className:"file-uploader__remove-btn-container",children:(0,j.jsx)(m.Icon,{icon:"IcCloseCircle",className:(0,d.A)("file-uploader__remove-btn",{"file-uploader__remove-btn--error":s}),onClick:()=>{o([]),r(null),i?.("")},color:"secondary",data_testid:"dt_remove_file_icon"})})]})},Yt=(e,t)=>{const i={title:(0,j.jsx)(y.Localize,{i18n_default_text:"The document must be recent and include your name and address:"}),descriptions:[{id:"signed_document",value:(0,j.jsx)(y.Localize,{i18n_default_text:"The document must be up-to-date and signed by the issuance authority."})},{id:"contains_letterhead",value:(0,j.jsx)(y.Localize,{i18n_default_text:"The document must contain a letterhead."})},{id:"invalid_rejected",value:(0,j.jsx)(y.Localize,{i18n_default_text:"Invalid or incomplete documents shall be rejected."})}]},a={title:(0,j.jsx)(y.Localize,{i18n_default_text:"Upload an original (unaltered) document that clearly shows your name and address, issued within the past {{expiry_in_months}} months. We accept:",values:{expiry_in_months:t?6:12}}),descriptions:[{id:"utility_bill",value:(0,j.jsx)(y.Localize,{i18n_default_text:"<0>Utility bill:</0> Electricity, water, gas, or landline phone bill.",components:[(0,j.jsx)("strong",{},0)]})},{id:"financial_legal_government_document",value:(0,j.jsx)(y.Localize,{i18n_default_text:"<0>Financial, legal, or government document:</0> Recent bank statement, affidavit, or government-issued letter.",components:[(0,j.jsx)("strong",{},0)]})},{id:"tenancy_agreement",value:(0,j.jsx)(y.Localize,{i18n_default_text:"<0>Tenancy agreement:</0> Valid and current agreement.",components:[(0,j.jsx)("strong",{},0)]})}]};return"poinc"===e?i:"poa"===e?a:{title:"",descriptions:[]}},Vt=()=>[{value:"utility_bill",text:(0,y.localize)("Utility bill (electricity, water, gas)")},{value:"phone_bill",text:(0,y.localize)("Landline phone bill")},{value:"bank_statement",text:(0,y.localize)("Bank statement")},{value:"affidavit",text:(0,y.localize)("Official residence declaration or affidavit")},{value:"official_letter",text:(0,y.localize)("Official letter issued by the government or solicitor")},{value:"rental_agreement",text:(0,y.localize)("Rental/tenancy agreement")},{text:(0,y.localize)("Others"),value:"poa_others"}],$t=e=>{let{examples:t,files_description:i,country_of_residence:a,onFileDrop:o,onError:s,placeholder:r}=e;const{isMobile:l}=(0,f.Y)(),{localize:c}=(0,y.useTranslations)(),{kyc_auth_status:d,isLoading:u}=I({country:a}),[p,h]=n().useState([]);return n().useEffect((()=>{if(d){const{address:e}=d,{supported_documents:t}=e,i=Vt().filter((e=>t?.includes(e.value)));h(i)}}),[d]),u?(0,j.jsx)(m.Loading,{is_fullscreen:!1}):(0,j.jsxs)("div",{className:"file-uploader__container","data-testid":"dt_file_uploader_container",children:[i,t,a&&(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(m.Text,{size:l?"xxs":"xs",as:"div",className:"file-uploader__file-title",weight:"bold",children:(0,j.jsx)(y.Localize,{i18n_default_text:"Select the type of document:"})}),(0,j.jsx)(_.Field,{name:"document_type",children:e=>{let{field:t,form:{setFieldValue:i}}=e;return(0,j.jsx)(m.Autocomplete,{...t,"data-lpignore":"true",autoComplete:"off",list_items:p,type:"text",value:t.value,label:r,placeholder:r??c("Select a document"),onItemSelection:e=>{i("document_type",e.text,!0)},required:!0})}})]}),(0,j.jsx)(m.Text,{size:l?"xxs":"xs",as:"div",className:"file-uploader__file-title",weight:"bold",children:(0,j.jsx)(y.Localize,{i18n_default_text:"Upload file"})}),(0,j.jsx)("div",{className:"file-uploader__file-dropzone-wrapper",children:(0,j.jsx)(Bt,{onError:s,onFileDrop:o})}),(0,j.jsxs)("div",{className:"file-uploader__file-supported-formats",children:[(0,j.jsx)(m.Text,{size:l?"xxxs":"xxs",children:(0,j.jsx)(y.Localize,{i18n_default_text:"Supported formats: JPEG, JPG, PNG, PDF, and GIF only"})}),(0,j.jsx)(m.Text,{size:l?"xxxs":"xxs",children:(0,j.jsx)(y.Localize,{i18n_default_text:"Maximum size: 8MB"})})]})]})},Wt=e=>{let{descriptions:t,title:i}=e;const{isMobile:a}=(0,f.Y)();return(0,j.jsxs)("div",{className:"files-description",children:[(0,j.jsx)(m.Text,{size:a?"xxs":"xs",as:"div",className:"files-description__title",weight:"bold",children:i}),(0,j.jsx)("ul",{children:t.map((e=>(0,j.jsx)("li",{children:(0,j.jsx)(m.Text,{size:a?"xxs":"xs",line_height:a?"l":"xl",children:e.value})},e.id)))})]})},Ht=e=>{let{description:t,image:i}=e;return(0,j.jsxs)("div",{className:"common-mistake-examples__content-layout",children:[i,(0,j.jsxs)("div",{className:"common-mistake-examples__content-description",children:[(0,j.jsx)(le.LegacyLossIcon,{iconSize:"xs"}),(0,j.jsx)(m.Text,{size:"xxxs",line_height:"s",role:"document",children:t})]})]})},Gt=()=>{const{isDesktop:e}=(0,f.Y)(),{client:t}=(0,o.useStore)(),{is_eu:i}=t,a=(e=>[{image:le.DerivLightIcDocumentNameMismatchIcon,description:(0,j.jsx)(c.Localize,{i18n_default_text:"Name in document doesn’t match your Deriv profile."}),ref:"name_mismatch"},{image:le.DerivLightIcDocumentAddressMismatchIcon,description:(0,j.jsx)(c.Localize,{i18n_default_text:"Address in document doesn’t match address you entered above."}),ref:"address_mismatch"},{...e?{image:le.DerivLightIcOldIssuedDocumentMoreThan6Icon,description:(0,j.jsx)(c.Localize,{i18n_default_text:"Document issued more than 6-months ago."}),ref:"old_6_month_issued_document"}:{image:le.DerivLightIcOldIssuedDocumentMoreThan12Icon,description:(0,j.jsx)(c.Localize,{i18n_default_text:"Document issued more than 12-months ago."}),ref:"old_12_month_issued_document"}},{image:le.DerivLightIcBlurryDocumentIcon,description:(0,j.jsx)(c.Localize,{i18n_default_text:"Blurry document. All information must be clear and visible."}),ref:"blurry_document"},{image:le.DerivLightIcCroppedDocumentIcon,description:(0,j.jsx)(c.Localize,{i18n_default_text:"Cropped document. All information must be clear and visible."}),ref:"cropped_document"},{image:le.DerivLightIcEnvelopeIcon,description:(0,j.jsx)(c.Localize,{i18n_default_text:"An envelope with your name and address."}),ref:"envelope"}])(i);return(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(m.Text,{as:"div",weight:"bold",size:e?"xs":"xxs",className:"common-mistake-examples__title",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Common mistakes"})}),(0,j.jsx)("div",{className:"common-mistake-examples__content",children:a.map((e=>(0,j.jsx)(Ht,{description:e.description,image:(0,j.jsx)(e.image,{})},e.ref)))})]})},Jt=(0,o.observer)((e=>{let{className:t,setOffset:i,is_for_cfd_modal:a,is_resubmit:s,setDocumentFiles:r,document_files:l,form_state:c}=e;const{status:d,handleSubmit:u,isSubmitting:p,isValid:b}=(0,_.useFormikContext)(),{isDesktop:v}=(0,f.Y)(),{client:z}=(0,o.useStore)(),[w,S]=n().useState(null),{localize:k}=(0,y.useTranslations)(),{states_list:N,account_settings:C,is_eu:I,getChangeableFields:T}=z,L=T(),A=n().useMemo((()=>Yt("poa",I)),[]);return(0,j.jsxs)(_.Form,{noValidate:!0,className:"account-form account-form_poa",onSubmit:u,children:[(0,j.jsx)(m.ThemedScrollbars,{height:"572px",is_bypassed:!a||!v,className:t,children:(0,j.jsxs)(h.A,{scroll_offset:i(d),isFullHeight:!v,children:[(d?.msg||s)&&(0,j.jsx)(m.InlineMessage,{type:"error",message:(0,j.jsxs)(m.Text,{as:"p",size:"xs",children:[!d?.msg&&s&&(0,j.jsx)(y.Localize,{i18n_default_text:"We were unable to verify your address with the details you provided. Please check and resubmit or choose a different document type."}),d?.msg]}),id:"dt_poa_submit-error"}),(0,j.jsx)(g.A,{title:k("Enter your address"),title_text_size:"s"}),(0,j.jsx)(qe,{is_qualified_for_poa:!0,editable_fields:L,states_list:N}),(0,j.jsx)(g.A,{title:k("Submit your document"),title_text_size:"s"}),(0,j.jsx)(Me.A,{children:(0,j.jsx)($t,{onFileDrop:e=>{r(e)},onError:S,files_description:(0,j.jsx)(Wt,{title:A.title,descriptions:A.descriptions}),examples:(0,j.jsx)(Gt,{}),country_of_residence:C?.country_code,placeholder:k("Type of document")})})]})}),a?(0,j.jsx)(m.Modal.Footer,{has_separator:!0,children:(0,j.jsx)(m.FormSubmitButton,{is_disabled:p||!b||l&&l.length<1||!!w,label:k("Continue"),is_loading:p})}):(0,j.jsx)(x.A,{className:"account-form__footer-poa",children:(0,j.jsx)(m.Button,{className:"account-form__footer-btn",type:"submit",is_disabled:p||!b||l&&l.length<1||!!w,has_effect:!0,is_loading:c.is_btn_loading,is_submit_success:c.is_submit_success,text:k("Save and submit"),primary:!0})})]})})),Kt=e=>{let{is_active:t}=e;return(0,j.jsx)("div",{className:"progress-container",children:(0,j.jsx)("div",{className:(0,d.A)("progress-bar",{"progress-bar--animate":t})})})},Qt=(0,o.observer)((e=>{let{setOffset:t,is_resubmit:i,form_state:a,document_files:s,setDocumentFiles:r,is_for_cfd_modal:l}=e;const{localize:c}=(0,y.useTranslations)(),{status:u,handleSubmit:p,isSubmitting:f,isValid:g,values:b,errors:v}=(0,_.useFormikContext)(),{client:z}=(0,o.useStore)(),[w,S]=n().useState(null),[k,N]=n().useState({id:1,text:c("Enter your address")}),{states_list:C,account_settings:I,is_eu:T,getChangeableFields:L}=z,A=L(),D=n().useMemo((()=>Yt("poa",T)),[T]),P=n().useMemo((()=>2!==k.id&&!(b.address_line_1&&!v.address_line_1&&!v.address_line_2&&b.address_city&&!v.address_city&&!v.address_state&&!v.address_postcode)),[b,v,k.id]);return(0,j.jsxs)("div",{className:"poa-mobile-layout",children:[(0,j.jsxs)("div",{className:(0,d.A)("poa-header",{"poa-header--non-modal":!l}),children:[(0,j.jsxs)("div",{className:"timeline",children:[2===k.id&&(0,j.jsx)(le.LabelPairedArrowLeftMdBoldIcon,{onClick:()=>N({id:1,text:c("Enter your address")})}),(0,j.jsx)(m.Text,{as:"p",size:"xxs",children:(0,j.jsx)(y.Localize,{i18n_default_text:"<0>Step {{step}}/2: </0> {{title}}",values:{step:k.id,title:k.text},components:[(0,j.jsx)("strong",{},0)]})})]}),(0,j.jsxs)("div",{className:"timeline-item",children:[(0,j.jsx)(Kt,{is_active:k.id<=2}),(0,j.jsx)(Kt,{is_active:2===k.id})]})]}),(0,j.jsx)(_.Form,{noValidate:!0,className:"account-form account-form_poa",onSubmit:p,children:(0,j.jsxs)(h.A,{scroll_offset:t(u),children:[(u?.msg||i)&&(0,j.jsx)(m.InlineMessage,{type:"error",message:(0,j.jsxs)(m.Text,{as:"p",size:"xxxs",children:[!u?.msg&&i&&(0,j.jsx)(y.Localize,{i18n_default_text:"We were unable to verify your address with the details you provided. Please check and resubmit or choose a different document type."}),u?.msg]}),className:"poa-error-banner",id:"dt_poa_submit-error"}),1===k.id&&(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(qe,{is_qualified_for_poa:!0,editable_fields:A,states_list:C}),(0,j.jsx)(x.A,{className:"account-form__footer-poa",children:(0,j.jsx)(m.Button,{className:"account-form__footer-btn",type:"button",has_effect:!0,text:c("Next"),primary:!0,is_disabled:P,onClick:()=>N((e=>({...e,id:2,text:c(" Document submission")})))})})]}),2===k.id&&(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)($t,{onFileDrop:e=>{r(e)},onError:S,files_description:(0,j.jsx)(Wt,{title:D.title,descriptions:D.descriptions}),examples:(0,j.jsx)(Gt,{}),country_of_residence:I?.country_code,placeholder:c("Type of document")}),(0,j.jsx)(x.A,{className:"account-form__footer-poa",children:(0,j.jsx)(m.Button,{className:"account-form__footer-btn",type:"submit",has_effect:!0,text:c("Submit"),primary:!0,is_disabled:f||!g||s&&s.length<1||!!w,is_loading:a.is_btn_loading,is_submit_success:a.is_submit_success})})]})]})})]})})),Zt=(0,o.observer)((e=>{let{is_resubmit:t,is_for_cfd_modal:i,onSubmit:a,onSubmitForCFDModal:s,className:r}=e;const{isMobile:c,isDesktop:d}=(0,f.Y)(),{client:u,notifications:h}=(0,o.useStore)(),{account_settings:x,fetchResidenceList:g,fetchStatesList:b,states_list:v}=u,{addNotificationMessageByKey:z,removeNotificationMessage:k,removeNotificationByKey:C}=h,[I,T]=n().useState([]),[L,A]=n().useState(!0),[D,P]=n().useState({address_line_1:"",address_line_2:"",address_city:"",address_state:"",address_postcode:""}),[E,F]=n().useState(null),[R,O]=n().useState({is_btn_loading:!1,is_submit_success:!1,should_allow_submit:!0,should_show_form:!0}),[M,U]=n().useState(!1),{upload:q}=(0,p.useFileUploader)(),{localize:B}=(0,y.useTranslations)();n().useEffect((()=>{g?.().then((async()=>{Promise.all([b(),l.WS.wait("get_settings")]).then((()=>{P({address_line_1:x.address_line_1??"",address_line_2:x.address_line_2??"",address_city:x.address_city??"",address_state:x.address_state??"",address_postcode:x.address_postcode??""}),A(!1)}))}))}),[x,g,b]),n().useEffect((()=>{if(M){const e=document.querySelector("#dt_poa_submit-error"),t=e?.parentElement??e;"function"==typeof t?.scrollIntoView&&t?.scrollIntoView({behavior:"smooth",block:"start"}),U(!1)}}),[M]);const Y=e=>{O({...R,should_show_form:e})},{address_line_1:V,address_line_2:$,address_city:W,address_state:H,address_postcode:G}=D,J={address_line_1:V,address_line_2:$,address_city:W,address_state:H,address_postcode:G,document_type:""};if(E)return(0,j.jsx)(S.A,{error_message:E});if(L)return(0,j.jsx)(m.Loading,{is_fullscreen:!1,className:"account__initial-loader"});if(J.address_state){const e=(0,l.getLocation)(v,J.address_state,"text");J.address_state=v.length&&e?e:J.address_state}else J.address_state="";const K=e=>d||i?"94px":e?.msg?"200px":"166px";return(0,j.jsx)(_.Formik,{initialValues:J,onSubmit:async(e,t)=>{let{setStatus:o,setSubmitting:n}=t;o({msg:""}),O({...R,is_btn_loading:!0});const r={...e};e.address_state&&v.length&&(r.address_state=(0,l.getLocation)(v,e.address_state,"value")||""),delete r?.document_type;const c=await l.WS.setSettings(r);if(c.error)return o({msg:c.error.message}),O({...R,is_btn_loading:!1}),n(!1),void U(!0);const d=await l.WS.authorized.storage.getSettings();if(d.error)return F(d.error.message),void n(!1);const _=d.get_settings,{address_line_1:u,address_line_2:m,address_city:p,address_state:f,address_postcode:h}=_;P({address_line_1:u,address_line_2:m,address_city:p,address_state:f,address_postcode:h});try{const t=Vt().find((t=>t.text===e.document_type)),r=await q(I,{document_type:t?.value});if(r?.warning)return O({...R,is_btn_loading:!1}),void(r.warning===Ae.DUPLICATE_DOCUMENT?i?s?.(e,!0):a?.(!1,!0):(o({msg:r?.message}),U(!0)));const c=await l.WS.authorized.getAccountStatus();if(!c||c.error)return F(c.error.message),void n(!1);const d=c.get_account_status;O({...R,is_submit_success:!0,is_btn_loading:!1});const{needs_verification:_}=d.authentication,u=Boolean(_.length)&&_.includes("identity");a?.(u),["authenticate","needs_poa","poa_expired"].forEach((e=>{k({key:e}),C({key:e})})),u&&z("needs_poi")}catch(e){(0,N.GQ)(e)&&(o({msg:e.message}),n(!1),O({...R,is_btn_loading:!1}),U(!0))}i&&s?.(e)},validate:e=>{O({...R,should_allow_submit:!1});const t={};(0,N.tf)(t,e)((e=>e),["address_line_1","address_city"],B("This field is required"));const i=(0,l.validAddress)(e.address_line_1,{is_required:!0});i.is_ok||(t.address_line_1=i.message);const a=(0,l.validAddress)(e.address_line_2);a.is_ok||(t.address_line_2=a.message);const o=B("Only letters, space, hyphen, period, and apostrophe are allowed.");return e.address_city&&!(0,l.validLetterSymbol)(e.address_city)&&(t.address_city=o),e.address_state&&!(0,l.validLetterSymbol)(e.address_state)&&v?.length<1&&(t.address_state=o),e.address_postcode&&((0,l.validLength)(e.address_postcode,{min:0,max:20})?(0,l.validPostCode)(e.address_postcode)||(t.address_postcode=B("Only letters, numbers, space, and hyphen are allowed.")):t.address_postcode=B("Please enter a {{field_name}} under {{max_number}} characters.",{field_name:B("Postal/ZIP code"),max_number:20,interpolation:{escapeValue:!1}})),e.document_type||(t.document_type=B("Document type is required.")),t},enableReinitialize:!0,validateOnMount:!0,children:()=>(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(w.A,{onDirty:d?void 0:Y}),R.should_show_form&&(c?(0,j.jsx)(Qt,{setOffset:K,is_for_cfd_modal:i,is_resubmit:t,setDocumentFiles:T,document_files:I,form_state:R}):(0,j.jsx)(Jt,{className:r,setOffset:K,is_for_cfd_modal:i,is_resubmit:t,setDocumentFiles:T,document_files:I,form_state:R}))]})})})),Xt=e=>{let{needs_poi:t,redirect_button:i}=e;const a=(0,c.localize)("Review in progress"),o=(0,l.isNavigationFromP2P)()||(0,l.isNavigationFromDerivGO)();return t?(0,j.jsx)("div",{className:"account-management__container",children:(0,j.jsxs)(ne.A,{message:a,icon:(0,j.jsx)(m.Icon,{icon:"IcPoaVerified",size:128}),children:[(0,j.jsxs)("div",{className:"account-management__text-container",children:[(0,j.jsx)(m.Text,{align:"center",size:"xs",as:"p",children:(0,c.localize)("Your proof of address is under review. We’ll get back to you in 1–3 working days.")}),(0,j.jsx)(m.Text,{align:"center",size:"xs",as:"p",children:(0,c.localize)("To start trading, you also need to verify your identity.")})]}),(0,j.jsx)(ve,{button_label:(0,c.localize)("Next"),route:l.routes.proof_of_identity})]})}):(0,j.jsx)("div",{className:"account-management__container",children:(0,j.jsx)(ne.A,{message:a,text:(0,c.localize)("Your proof of address is under review. We’ll get back to you in 1–3 working days."),icon:(0,j.jsx)(m.Icon,{icon:"IcPoaVerified",size:128}),children:i||!o&&(0,j.jsx)(ve,{button_label:(0,c.localize)("Return to Trader's Hub"),route:l.routes.traders_hub})})})},ei=e=>{let{title:t,description:i,button_text:a,onClick:o}=e;return(0,j.jsx)(ne.A,{message:t??(0,c.localize)("We could not verify your proof of address"),text:i??(0,c.localize)("Please check your email for details."),icon:(0,j.jsx)(m.Icon,{icon:"IcPoaError",size:128}),children:(0,j.jsx)(m.Button,{onClick:o,has_effect:!0,primary:!0,children:(0,j.jsx)(m.Text,{className:"dc-btn__text",size:"xs",weight:"bold",as:"p",children:a??(0,c.localize)("Resubmit")})})})},ti=()=>(0,j.jsx)(m.ButtonLink,{className:"account-management__button",to:"/account/proof-of-identity",children:(0,j.jsx)(m.Text,{className:"dc-btn__text",weight:"bold",as:"p",children:(0,c.localize)("Proof of identity")})}),ii=e=>{let{needs_poi:t,redirect_button:i}=e;const a=(0,c.localize)("Your proof of address is verified"),o=(0,l.isNavigationFromP2P)()||(0,l.isNavigationFromDerivGO)();return t?(0,j.jsx)("div",{className:"account-management__container",children:(0,j.jsx)(ne.A,{message:a,text:(0,c.localize)("To continue trading, you must also submit a proof of identity."),icon:(0,j.jsx)(m.Icon,{icon:"IcPoaVerified",size:128}),children:(0,j.jsx)(ti,{})})}):(0,j.jsx)("div",{className:"account-management__container",children:(0,j.jsx)(ne.A,{message:a,icon:(0,j.jsx)(m.Icon,{icon:"IcPoaVerified",size:128}),children:i||!o&&(0,j.jsx)(he,{})})})},ai=(0,o.observer)((e=>{let{onSubmit:t}=e;const[i,a]=n().useState(!0),[s,r]=n().useState({allow_document_upload:!1,allow_poi_resubmission:!1,allow_poa_resubmission:!1,needs_poi:!1,needs_poa:!1,has_poi:!1,resubmit_poa:!1,has_submitted_poa:!1,document_status:void 0,is_age_verified:!1,poa_address_mismatch:!1,poa_expiring_soon:!1,poa_authenticated_with_idv:!1,poa_authenticated_with_idv_photo:!1,has_submitted_duplicate_poa:!1}),{client:d,notifications:_,common:u,ui:p}=(0,o.useStore)(),{app_routing_history:f}=u,{has_restricted_mt5_account:h,is_switching:x}=d,{is_verification_modal_visible:g}=p,{refreshNotifications:b}=_,y=localStorage.getItem("mt5_poa_status");n().useEffect((()=>{x||l.WS.authorized.getAccountStatus().then((e=>{const{get_account_status:t}=e;if(t){const{allow_document_upload:e,allow_poa_resubmission:i,document_status:o,has_submitted_poa:s,is_age_verified:n,needs_poa:l,needs_poi:c,poa_address_mismatch:d,poa_authenticated_with_idv:_,poa_authenticated_with_idv_photo:u,poa_expiring_soon:m}=Pt(t);r((t=>({...t,allow_document_upload:e,allow_poa_resubmission:i,document_status:o,has_submitted_poa:s,is_age_verified:n,needs_poa:l,needs_poi:c,poa_address_mismatch:d,poa_authenticated_with_idv:_,poa_authenticated_with_idv_photo:u,poa_expiring_soon:m}))),a(!1),b()}}))}),[x,b]),n().useEffect((()=>()=>{localStorage.removeItem("mt5_poa_status")}),[]);const v=()=>{r((e=>({...e,resubmit_poa:!0})))},z=(e,i)=>{r((t=>({...t,has_submitted_poa:!0,needs_poi:e,poa_expiring_soon:!1,has_submitted_duplicate_poa:i??!1}))),g&&t?.()},{allow_document_upload:w,allow_poa_resubmission:S,document_status:k,needs_poi:N,resubmit_poa:C,has_submitted_poa:I,poa_address_mismatch:T,poa_expiring_soon:L,poa_authenticated_with_idv:A,poa_authenticated_with_idv_photo:D,has_submitted_duplicate_poa:P}=s,E=(0,l.getPlatformRedirect)(f),F=Object.keys(l.platforms).includes(E?.ref??""),R=C||S||h&&k&&["expired","rejected","suspected"].includes(k)||T||L||(A||D)&&E?.route===l.routes.cashier_p2p,O=F&&(0,j.jsx)(m.Button,{primary:!0,className:"proof-of-identity__redirect",onClick:()=>{const e=l.platforms[E.ref]?.url;e&&(window.location.href=e,window.sessionStorage.removeItem("config.platform"))},children:(0,j.jsx)(c.Localize,{i18n_default_text:"Back to {{platform_name}}",values:{platform_name:E.name}})});if(i)return(0,j.jsx)(m.Loading,{is_fullscreen:!1,className:"account__initial-loader"});if(!w)return(0,j.jsx)(Ut,{});if(P)return(0,j.jsx)(ei,{title:(0,j.jsx)(c.Localize,{i18n_default_text:"Proof of address documents upload failed"}),description:(0,j.jsx)(c.Localize,{i18n_default_text:"It seems you’ve submitted this document before. Upload a new document."}),button_text:(0,j.jsx)(c.Localize,{i18n_default_text:"Try again"}),onClick:()=>{r((e=>({...e,resubmit_poa:!0,has_submitted_duplicate_poa:!1,has_submitted_poa:!1})))}});if(I&&!T)return(0,j.jsx)(Xt,{needs_poi:N,redirect_button:O});if(R)return(0,j.jsx)(Zt,{is_resubmit:!L,onSubmit:z});const M=e=>{switch(e){case l.AUTH_STATUS_CODES.NONE:return(0,j.jsx)(Zt,{onSubmit:z});case l.AUTH_STATUS_CODES.PENDING:return(0,j.jsx)(Xt,{needs_poi:N,redirect_button:O});case l.AUTH_STATUS_CODES.VERIFIED:return(0,j.jsx)(ii,{needs_poi:N,redirect_button:O});case l.AUTH_STATUS_CODES.EXPIRED:return(0,j.jsx)(Mt,{onClick:v});case l.AUTH_STATUS_CODES.REJECTED:case l.AUTH_STATUS_CODES.SUSPECTED:return(0,j.jsx)(ei,{onClick:v});default:return null}};return y?M(y):k?M(k):null})),oi=(0,o.observer)((()=>{const{client:e}=(0,o.useStore)(),{is_virtual:t}=e;return t?(0,j.jsx)(oe.A,{has_button:!0}):(0,j.jsx)(ai,{})})),si=Object.freeze({ACCOUNT_ID:"account_id",ACCOUNT_NUMBER:"account_number",BANK_ACCOUNT_NUMBER:"bank_account_number",CARD_NUMBER:"card_number",EMAIL_ADDRESS:"email_address",MOBILE_NUMBER:"mobile_number",USER_ID:"user_id"}),ni=e=>{let{class_name:t,name:i,sub_index:a,payment_id:o}=e;const{values:s,setFieldValue:r,errors:u,setFieldError:p}=(0,_.useFormikContext)(),[f,h]=n().useState(!s[i]?.[o]?.files?.[a]?.name),x=n().useRef(null);return(0,j.jsxs)("div",{className:(0,d.A)("poo-file-uploader",t),children:[(0,j.jsx)("input",{type:"file",accept:"image/png, image/jpeg, image/jpg, application/pdf",ref:x,onChange:async e=>{if(e.nativeEvent.preventDefault(),e.nativeEvent.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),!e.target.files||0===e.target.files.length)return;const t=await(0,l.compressImageFiles)([e.target.files[0]]),n=[...s[i]?.[o]?.files??[]];n[a]=t[0];const c=s?.[i];c&&(c[o]={...c[o],files:n??[]},await r(i,{...c}),h(!t[0]))},className:"hidden-input",name:i}),(0,j.jsx)(m.Input,{name:"cardImgName",required:!0,label:(0,c.localize)("Choose a photo"),maxLength:255,hint:(0,c.localize)("Accepted formats: pdf, jpeg, jpg, and png. Max file size: 8MB"),value:s[i]?.[o]?.files?.[a]?.name??"",readOnly:!0,color:"less-prominent",type:"text",tabIndex:-1,error:u?.[i]?.[o]?.files?.[a],trailing_icon:(0,j.jsx)(m.Icon,{onClick:async e=>{e.nativeEvent.preventDefault(),e.nativeEvent.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),x.current&&"value"in x.current&&(x.current.value="");const t=(s[i]?.[o]?.files??[]).filter(((e,t)=>t!==a)),n=s?.[i];n&&(n[o]={...n[o],files:t??[]},await r(i,{...n}),h((e=>!e)),(()=>{const e={...u?.[i]??{}},t=e?.[o]?.files??{};delete t?.[a],e[o]={...e[o]??{},files:t},p(i,{...e})})())},icon:"IcCross",height:"100%",size:20,className:(0,d.A)("stack-top ",{"remove-element":f})})}),(0,j.jsx)(m.Button,{className:(0,d.A)("proof-of-ownership__card-open-inputs-photo-btn ",{"remove-element":!f}),text:(0,c.localize)("Browse"),onClick:e=>{e.nativeEvent.preventDefault(),e.nativeEvent.stopPropagation(),e.nativeEvent.stopImmediatePropagation(),x?.current?.click()},primary:!0})]})},ri=e=>{let{is_open:t,onClose:i}=e;return(0,j.jsx)(m.Modal,{className:"sample-credit-card-modal",is_open:t,should_header_stick_body:!0,title:(0,j.jsx)(c.Localize,{i18n_default_text:"How to mask your card?"}),toggleModal:i,children:(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(m.Text,{className:"sample-credit-card-modal-text",size:"xs",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Black out digits 7 to 12 of the card number that’s shown on the front of your debit/credit card.⁤"})}),(0,j.jsx)("img",{src:(0,l.getUrlBase)("/public/images/common/sample-credit-card.png"),alt:"creditcardsample",className:"sample-credit-card-modal-img"})]})})},li=()=>{const[e,t]=n().useState(!1);return(0,j.jsxs)(n().Fragment,{children:[(0,j.jsx)(m.Text,{className:"proof-of-ownership__card-open-desc-link",onClick:()=>t(!0),children:(0,j.jsx)(c.Localize,{i18n_default_text:"See example"})}),(0,j.jsx)(ri,{is_open:e,onClose:()=>{t(!1)}})]})},ci=e=>{let{card_details:t}=e;const{values:i,setFieldValue:a,errors:o}=(0,_.useFormikContext)(),s=t.payment_method.toLowerCase(),r=(e,t,i)=>{c(u(e,t),i)},c=(e,t)=>{const o=i[s];o[t]={...o[t],payment_method_identifier:e},a(s,{...o})},u=(e,t)=>{let i=e?.replace(/\s/g,"")||"";if(t===si.CARD_NUMBER){if(16!==i.length||16===i.length&&(0,l.hasInvalidCharacters)(i))return i;i=`${i.substring(0,6)}XXXXXX${i.substring(12)}`}else if([si.EMAIL_ADDRESS,si.USER_ID].some((e=>e===t)))return i;return i.replace(/(\w{4})/g,"$1 ").trim()};return(0,j.jsxs)("div",{children:[t?.instructions?.map((e=>(0,j.jsxs)(m.Text,{className:"proof-of-ownership__card-open-desc",as:"p",color:"general",size:"xs",children:[e," ",t?.identifier_type===si.CARD_NUMBER&&(0,j.jsx)(li,{})]},"string"!=typeof e?e.key:e))),(0,j.jsx)("fieldset",{children:t?.items&&t?.items.map((e=>{const a=[...Array(e?.documents_required).keys()],l=e.id;return(0,j.jsxs)("div",{className:"proof-of-ownership__card-open-inputs",children:[t?.input_label&&(0,N.tb)(t?.icon)&&(0,j.jsx)("div",{className:"proof-of-ownership__card-open-inputs-field",children:(0,j.jsx)(m.Input,{label:t?.input_label,"data-lpignore":"true",className:(0,d.A)("proof-of-ownership__card-open-inputs-cardnumber",{"proof-of-ownership-valid-identifier":i?.[s]?.[l]?.payment_method_identifier&&!o?.[s]?.[l]?.payment_method_identifier}),type:"text",onChange:e=>{c(e.target.value,l)},value:i?.[s]?.[l]?.payment_method_identifier,onBlur:e=>{r(e.target.value.trim(),t?.identifier_type,l)},"data-testid":"dt_payment_method_identifier",error:o?.[s]?.[l]?.payment_method_identifier})}),a.map((a=>(0,j.jsxs)(n().Fragment,{children:[t?.input_label&&!(0,N.tb)(t?.icon)&&(0,j.jsx)("div",{className:"proof-of-ownership__card-open-inputs-field",children:(0,j.jsx)(m.Input,{label:t?.input_label,"data-lpignore":"true",className:(0,d.A)("proof-of-ownership__card-open-inputs-cardnumber",{"proof-of-ownership-valid-identifier":i?.[s]?.[l]?.payment_method_identifier&&!o?.[s]?.[l]?.payment_method_identifier}),type:"text",onChange:e=>{c(e.target.value.trim(),l)},value:i?.[s]?.[l]?.payment_method_identifier??"",onBlur:e=>{r(e.target.value.trim(),t?.identifier_type,l)},"data-testid":"dt_payment_method_identifier",error:o?.[s]?.[l]?.payment_method_identifier??""})}),(0,j.jsx)("div",{className:(0,d.A)("proof-of-ownership__card-open-inputs-upload",{expand:!t?.input_label,organise:null!==t?.input_label}),children:(0,j.jsx)(ni,{class_name:"proof-of-ownership__card-open-inputs-photo",sub_index:a,name:s,payment_id:l})})]},`${e?.id}-${a}`)))]},`${e.payment_method}-${e.id}`)}))})]})},di=e=>{let{is_open:t}=e;return(0,j.jsx)(m.Icon,{icon:"IcChevronUpBold",className:(0,d.A)("proof-of-ownership__card-item-icon",{"proof-of-ownership__card-item-icon--invert":!t})})},_i=e=>{let{details:t}=e;const[i,a]=n().useState(!1),o=()=>{a(!i)};return(0,j.jsxs)("div",{className:(0,d.A)("proof-of-ownership__card",{"proof-of-ownership__card-open":i}),"data-testid":t?.payment_method,children:[(0,j.jsxs)("div",{className:"proof-of-ownership__card-item",onClick:o,onKeyDown:o,children:[t?.icon&&(0,j.jsx)(m.Icon,{icon:t?.icon,className:"proof-of-ownership__card-item-logo",width:68,height:58}),(0,j.jsx)(m.Text,{className:"proof-of-ownership__card-item-text",as:"p",color:"general",size:"s",weight:"bold",children:t?.payment_method}),(0,j.jsx)(m.Button,{id:"proof-of-ownership",icon:(0,j.jsx)(di,{is_open:i}),className:"proof-of-ownership__card-item-icon",onClick:o,transparent:!0,"data-testid":"dt_proof_of_ownership_button",type:"button"})]}),i&&(0,j.jsx)(ci,{card_details:t})]})},ui=(0,o.observer)((e=>{let{grouped_payment_method_data:t}=e;const{client:i,notifications:a}=(0,o.useStore)(),{refreshNotifications:s}=a,{email:r,updateAccountStatus:d}=i,{isDesktop:u}=(0,f.Y)(),p=Object.keys(t),b=e=>(0,c.localize)("Unable to read file {{name}}",{name:e}),y=n().useCallback((function(){return u?(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)<=2?"0rem":"8rem":"20rem"}),[u]),v=n().useMemo((()=>{if(!p?.length)return{};const e={documents_required:0,id:0,identifier_type:"",is_generic_pm:!1,payment_method_identifier:"",files:[]};return p.reduce(((i,a)=>{const o=t[a]?.documents_required,s=t[a]?.is_generic_pm,n=t[a]?.items,r=t[a]?.identifier_type;return i[a]={},n?.forEach((t=>{i[a][t.id]={...e,id:t.id,documents_required:o??0,is_generic_pm:s??!1,identifier_type:r??""}})),i}),{})}),[p,t]);return(0,j.jsx)(_.Formik,{initialValues:v,validate:e=>{let t={};return Object.keys(e).forEach((i=>{const a=e[i];Object.keys(a)?.forEach((e=>{const o=a[e],s=o?.is_generic_pm||!!o?.payment_method_identifier.trim()?.length,n=o?.files?.filter((e=>e?.name)).length===o?.documents_required;if(n&&!s?(t={...t,[i]:{...t[i]??{}}},t[i]={...t[i],[e]:{...t[i]?.[e]??{},payment_method_identifier:(0,c.localize)("Please complete this field.")}}):delete t[i]?.[e]?.payment_method_identifier,s){const a=((e,t)=>{const i=(0,c.localize)("Enter your full card number");return t===si.CARD_NUMBER?e.length<16?i:16===e.length?(0,l.hasInvalidCharacters)(e)?i:null:16!==e.length||e.length>19?(0,l.isFormattedCardNumber)(e)?null:i:null:null})(o.payment_method_identifier.trim(),o.identifier_type);a?(t={...t,[i]:{...t[i]??{}}},t[i]={...t[i],[e]:{...t[i]?.[e]??{},payment_method_identifier:a}}):delete t[i]?.[e]?.payment_method_identifier,n||(t={...t,[i]:{...t[i]??{}}},t[i]={...t[i],[e]:{...t[i]?.[e]??{},files:{}}})}o?.files?.forEach(((a,o)=>{if(!a?.name)return;const s=(e=>(0,l.validFile)(e)?e?.size/1024>8e3?(0,c.localize)("That file is too big (only up to 8MB allowed). Please upload another file."):null:(0,c.localize)("That file format isn't supported. Please upload .pdf, .png, .jpg, or .jpeg files only."))(a);s?(t={...t,[i]:{...t[i]??{}}},t[i]={...t[i],[e]:{...t[i]?.[e]??{},files:{...t[i]?.[e]?.files,[o]:s}}}):delete t?.[i]?.[e]?.files?.[o]}))}))})),t},onSubmit:async(e,t)=>{const{setFieldError:i,setSubmitting:a}=t;try{const t=new(Pe())({connection:l.WS.getSocket()});a(!0),await Object.keys(e).reduce((async(a,o)=>{await a;const n=e[o];await(Object.keys(n)?.reduce((async(e,a)=>{await e;const c=n[a];if(c?.files?.length){const e=await(0,l.readFiles)(c.files,b,{document_type:l.UPLOAD_FILE_TYPE.proof_of_ownership,proof_of_ownership:{details:{email:r,payment_identifier:c.payment_method_identifier},id:c.id}});await e.reduce((async(e,n,r)=>{await e;const l=await t.upload(n),c=[];l?.warning?l?.warning?.trim()===Ae.DUPLICATE_DOCUMENT&&l?.message&&(c[r]=l?.message,i(o,{[a]:{files:c}})):(d(),s())}),Promise.resolve())}}),Promise.resolve()))}),Promise.resolve())}catch(e){console.warn(e)}finally{a(!1)}},children:e=>{let{isValid:i,dirty:a,isSubmitting:o}=e;return(0,j.jsxs)(_.Form,{"data-testid":"dt_poo_form",className:"proof-of-ownership",children:[(0,j.jsxs)(h.A,{scroll_offset:y(p.length),children:[(0,j.jsx)(g.A,{title:(0,c.localize)("Please upload the following document(s).")}),(0,j.jsx)(Me.A,{children:(0,j.jsx)("fieldset",{children:p?.map(((e,i)=>(0,j.jsxs)("div",{className:"proof-of-ownership__form-content",children:[p.length>1&&(0,j.jsxs)("div",{className:"proof-of-ownership__progress",children:[(0,j.jsx)("div",{className:"proof-of-ownership__progress-number",children:i+1}),i!==p.length-1&&(0,j.jsx)("div",{className:"proof-of-ownership__progress-bar"})]}),(0,j.jsx)(_i,{details:t[e]})]},e)))})})]}),(0,j.jsx)(x.A,{children:(0,j.jsx)(m.Button,{type:"submit",className:"account-form__footer-btn",is_disabled:!a||!i,has_effect:!0,large:!0,primary:!0,is_loading:o,children:(0,j.jsx)(c.Localize,{i18n_default_text:"Submit"})})})]})}})}));ui.displayName="ProofOfOwnershipForm";const mi=ui,pi=()=>(0,j.jsx)("div",{className:"proof-of-ownership__container",children:(0,j.jsx)(ne.A,{icon:(0,j.jsx)(m.Icon,{icon:"IcPooVerified",size:128}),message:(0,j.jsx)(c.Localize,{i18n_default_text:"Your proof of ownership isn't required."}),text:(0,j.jsx)(c.Localize,{i18n_default_text:"You are not required to submit proof of ownership at this time. We will inform you if proof of ownership is required in the future."})})}),fi=()=>(0,j.jsx)("div",{className:"proof-of-ownership__container",children:(0,j.jsx)(ne.A,{message:(0,j.jsx)(c.Localize,{i18n_default_text:"Proof of ownership verification passed."}),icon:(0,j.jsx)(m.Icon,{icon:"IcPooVerified",size:128})})}),hi=e=>{let{onTryAgain:t}=e;return(0,j.jsx)("div",{className:"proof-of-ownership__container",children:(0,j.jsxs)("div",{className:"proof-of-ownership__container--content",children:[(0,j.jsx)(ne.A,{icon:(0,j.jsx)(m.Icon,{icon:"IcPooRejected",size:128}),is_disabled_for_mobile:!0,message:(0,j.jsx)(c.Localize,{i18n_default_text:"Proof of ownership verification failed"}),text:(0,j.jsx)(c.Localize,{i18n_default_text:"We were unable to verify your proof of ownership."})}),(0,j.jsx)(m.Button,{className:"proof-of-ownership__try-again-button","data-testid":"dt_try-again-button",large:!0,onClick:t,primary:!0,type:"button",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Try again"})})]})})},xi=()=>(0,j.jsx)("div",{className:"proof-of-ownership__container",children:(0,j.jsx)(ne.A,{icon:(0,j.jsx)(m.Icon,{icon:"IcPooSubmitted",size:128}),message:(0,j.jsx)(c.Localize,{i18n_default_text:"We’ve received your proof of ownership."}),text:(0,j.jsx)(c.Localize,{i18n_default_text:"We’ll review your documents and notify you of its status within 3 days."})})}),gi=()=>({advcash:{icon_light:"IcAdvcashLight",icon_dark:"IcAdvcashDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a screenshot of your name and email address from the personal information section."},0)],input_label:(0,c.localize)("Email address"),identifier_type:"email_address"},astropay:{icon_light:"IcAstroPayLight",icon_dark:"IcAstroPayDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload 2 separate screenshots from the personal details page and the account page via <0>https://app.astropay.com/profile</0>",components:[(0,j.jsx)("a",{className:"link  proof-of-ownership-link",target:"_blank",rel:"noreferrer",href:"https://app.astropay.com/profile","aria-label":"Read more on AstroPay"},0)]},0)],input_label:(0,c.localize)("Account number"),identifier_type:"account_number"},beyonic:{icon_light:"IcBeyonic",icon_dark:"IcBeyonic",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload your mobile bill statement showing your name and phone number."},0)],input_label:(0,c.localize)("Mobile number"),identifier_type:"mobile_number"},"boleto (d24 voucher)":{icon_light:"IcBoletoD24VoucherLight",icon_dark:"IcBoletoD24VoucherDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload your bank statement showing your name and account details."},0)],input_label:(0,c.localize)("Bank account number"),identifier_type:"bank_account_number"},visa:{icon_light:"IcVisaLight",icon_dark:"IcVisaDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a photo showing your name and the first six and last four digits of your card number. If the card does not display your name, upload the bank statement showing your name and card number in the transaction history."},0)],input_label:(0,c.localize)("Card number"),identifier_type:"card_number"},mastercard:{icon_light:"IcMasterCardLight",icon_dark:"IcMasterCardDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a photo showing your name and the first six and last four digits of your card number. If the card does not display your name, upload the bank statement showing your name and card number in the transaction history."},0)],input_label:(0,c.localize)("Card number"),identifier_type:"card_number"},pix:{icon_light:"IcPixLight",icon_dark:"IcPixDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a screenshot of either of the following to process the transaction:"},0),(0,j.jsx)(c.Localize,{i18n_default_text:"- your account profile section on the website"},1),(0,j.jsx)(c.Localize,{i18n_default_text:"- the Account Information page on the app"},2),(0,j.jsx)(c.Localize,{i18n_default_text:"- your account details of the bank linked to your account"},3)],input_label:(0,c.localize)("User ID"),identifier_type:"user_id"},skrill:{icon_light:"IcSkrillLight",icon_dark:"IcSkrillDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a screenshot of your name, account number, and email address from the personal details section of the app or profile section of your account on the website."},0)],input_label:(0,c.localize)("Email address"),identifier_type:"email_address"},neteller:{icon_light:"IcNetellerLight",icon_dark:"IcNetellerDark",instructions:[(0,c.localize)("Upload a screenshot of your name, account number, and email address from the personal details section of the app or profile section of your account on the website.")],input_label:(0,c.localize)("Email address"),identifier_type:"email_address"},onlinenaira:{icon_light:"IcOnlineNaira",icon_dark:"IcOnlineNaira",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a screenshot of your username on the General Information page at <0>https://onlinenaira.com/members/index.htm</0>",components:[(0,j.jsx)("a",{className:"link proof-of-ownership-link",target:"_blank",rel:"noreferrer",href:"https://onlinenaira.com/members/index.htm","aria-label":"Read more on OnlineNaira"},0)]},0),(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a screenshot of your account number and phone number on the Bank Account/Mobile wallet page at <0>https://onlinenaira.com/members/bank.htm</0>",components:[(0,j.jsx)("a",{className:"link  proof-of-ownership-link",target:"_blank",rel:"noreferrer",href:"https://onlinenaira.com/members/bank.htm","aria-label":"Read more on OnlineNaira"},0)]},1)],input_label:(0,c.localize)("Account ID"),identifier_type:"account_id"},webmoney:{icon_light:"IcWebMoneyLight",icon_dark:"IcWebMoneyDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a screenshot of your account and personal details page with your name, account number, phone number, and email address."},0)],input_label:(0,c.localize)("Account number"),identifier_type:"account_number"},zingpay:{icon_light:"IcZingpay",icon_dark:"IcZingpay",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload your bank statement showing your name, account number, and transaction history."},0)],input_label:(0,c.localize)("Bank account number"),identifier_type:"bank_account_number"},sticpay:{icon_light:"IcSticpayLight",icon_dark:"IcSticpayDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a screenshot of your name and email address from the personal details section."},0)],input_label:(0,c.localize)("Email address"),identifier_type:"email_address"},jeton:{icon_light:"IcJetonLight",icon_dark:"IcJetonDark",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a screenshot of your name and account number from the personal details section."},0)],input_label:(0,c.localize)("Account number"),identifier_type:"account_number"},other:{icon_light:"IcOtherPaymentMethod",icon_dark:"IcOtherPaymentMethod",instructions:[(0,j.jsx)(c.Localize,{i18n_default_text:"Upload a document showing your name and bank account number or account details."},0)],input_label:null,identifier_type:"none"}}),bi=(0,o.observer)((()=>{const{client:e,ui:t}=(0,o.useStore)(),{account_status:i}=e,{is_dark_mode_on:a}=t,r=i?.authentication?.ownership?.requests,[c,d]=(0,s.useState)(),[_,u]=(0,s.useState)(!1),p=n().useMemo((()=>{const e={},t=gi();return r?.forEach((i=>{const o=i?.payment_method?.toLowerCase(),s=t[o]||t.other;e[o]?e[o]?.items?.push(i):e[o]={documents_required:i?.documents_required,icon:a?s?.icon_dark:s?.icon_light,payment_method:i?.payment_method,items:[i],instructions:s.instructions,input_label:s?.input_label,identifier_type:s.identifier_type,is_generic_pm:!s?.input_label}})),{groups:e}}),[r,a]);return(0,s.useEffect)((()=>{d(i?.authentication?.ownership?.status?.toLowerCase())}),[i]),r?.length&&(c!==l.AUTH_STATUS_CODES.REJECTED||_)?(0,j.jsx)(mi,{grouped_payment_method_data:p.groups}):c===l.AUTH_STATUS_CODES.VERIFIED?(0,j.jsx)(fi,{}):c===l.AUTH_STATUS_CODES.PENDING?(0,j.jsx)(xi,{}):c===l.AUTH_STATUS_CODES.NONE?(0,j.jsx)(pi,{}):c===l.AUTH_STATUS_CODES.REJECTED?(0,j.jsx)(hi,{onTryAgain:()=>{u(!0)}}):(0,j.jsx)(m.Loading,{is_fullscreen:!1,className:"account__initial-loader"})}));bi.displayName="ProofOfOwnership";const yi=(0,r.withRouter)(bi),ji={NONE:"none",PENDING:"pending",REJECTED:"rejected",VERIFIED:"verified",LOCKED:"locked"},vi=(0,o.observer)((e=>{let{onSubmit:t}=e;const[i,a]=n().useState([]),[s,r]=n().useState(null),{localize:d}=(0,y.useTranslations)(),{notifications:u}=(0,o.useStore)(),{addNotificationMessageByKey:b,removeNotificationMessage:v,removeNotificationByKey:z}=u,{isMobile:w,isDesktop:S}=(0,f.Y)(),{upload:k}=(0,p.useFileUploader)(),C=n().useMemo((()=>[{text:(0,c.localize)("Tax return"),value:"tax_return"},{text:(0,c.localize)("Employment contract"),value:"employment_contract"},{text:(0,c.localize)("Payslip"),value:"payslip"},{text:(0,c.localize)("Certificate of incorporation"),value:"coi"},{text:(0,c.localize)("Business proof of address"),value:"business_poa"},{text:(0,c.localize)("Article of association"),value:"article_of_association"},{text:(0,c.localize)("Memorandum"),value:"memorandum"},{text:(0,c.localize)("Authorization letter"),value:"authorisation_letter"},{text:(0,c.localize)("Declarations"),value:"declarations"}]),[]),I=n().useMemo((()=>Yt("poinc")),[]);return(0,j.jsx)(_.Formik,{initialValues:{document_type:""},onSubmit:async(e,a)=>{let{setStatus:o,setSubmitting:s}=a;const n=C.find((t=>t.text===e.document_type))?.value??"";if(n){s(!0);try{const e=await k(i,{document_type:n});if(e.warning)o({msg:e.message});else{const e=await l.WS.authorized.getAccountStatus(),{income:i,needs_verification:a}=e?.get_account_status?.authentication||{},o=a.includes("income")&&[ji.REJECTED,ji.NONE].some((e=>e===i?.status));v({key:"needs_poinc"}),z({key:"needs_poinc"}),v({key:"poinc_upload_limited"}),z({key:"poinc_upload_limited"}),t(i?.status),o&&b("needs_poinc")}}catch(e){(0,N.GQ)(e)&&o({msg:e.message})}finally{s(!1)}}},validate:e=>{const t={},{document_type:i}=e,a=Boolean(C.find((e=>e.text===i)));return i&&a||(t.document_type=d("This field is required.")),t},children:e=>{let{errors:t,handleChange:o,handleSubmit:c,isSubmitting:u,isValid:p,setFieldValue:f,setStatus:b,status:v,touched:z,values:k}=e;return(0,j.jsxs)(_.Form,{noValidate:!0,className:"proof-of-income__form",onSubmit:c,children:[(0,j.jsxs)(h.A,{scroll_offset:S?"0":"20rem",children:[(0,j.jsxs)("fieldset",{className:"proof-of-income__form-field",children:[(0,j.jsx)(g.A,{title:d("Select document"),title_text_size:w?"xs":"s"}),(0,j.jsx)(_.Field,{name:"document_type",children:e=>{let{field:i}=e;return(0,j.jsx)(n().Fragment,{children:S?(0,j.jsx)(m.Autocomplete,{...i,name:"document_type","data-lpignore":"true",autoComplete:"off",type:"text",list_height:"36rem",placeholder:d("Select your document*"),error:z.document_type&&t.document_type,list_items:C,value:k.document_type,onChange:o,onItemSelection:e=>{let{value:t,text:i}=e;f("document_type",t?i:"",!0),b({msg:""})},required:!0}):(0,j.jsx)(m.SelectNative,{name:"document_type",placeholder:d("Select your document*"),label:d("Select your document*"),value:k.document_type,list_items:C,error:z.document_type?t.document_type:void 0,use_text:!0,onChange:e=>{f("document_type",e.target.value,!0),b({msg:""})},required:!0,hide_top_placeholder:!0})})}})]}),(0,j.jsxs)("div",{className:"proof-of-income__form-field",children:[(0,j.jsx)(g.A,{title:d("Document submission"),title_text_size:w?"xs":"s"}),(0,j.jsx)($t,{onFileDrop:e=>{a((t=>((0,l.isEqualArray)(t,e)||b({msg:""}),e)))},onError:r,files_description:(0,j.jsx)(Wt,{descriptions:I.descriptions,title:I.title})})]})]}),(0,j.jsxs)(x.A,{children:[v?.msg&&(0,j.jsx)(m.FormSubmitErrorMessage,{message:v.msg}),(0,j.jsx)(m.Button,{className:"account-form__footer-btn",type:"submit",is_disabled:!k.document_type||u||!p||!i.length||!!s||!!v.msg,is_loading:u,has_effect:!0,primary:!0,children:(0,j.jsx)(y.Localize,{i18n_default_text:"Save and submit"})})]})]})}})})),zi=e=>{let{onReSubmit:t}=e;return(0,j.jsx)(ne.A,{message:(0,j.jsx)(c.Localize,{i18n_default_text:"Income verification failed"}),text:(0,j.jsx)(c.Localize,{i18n_default_text:"We were unable to verify your income. <0 /> Please check the email we've sent you for further information.",components:[(0,j.jsx)("br",{},0)]}),icon:(0,j.jsx)(m.Icon,{icon:"IcPoincFailed",size:128}),children:(0,j.jsx)(m.Button,{type:"button",className:"account-management__continue",onClick:()=>t(ji.NONE),large:!0,primary:!0,children:(0,j.jsx)(c.Localize,{i18n_default_text:"Try Again"})})})},wi=()=>(0,j.jsx)(ne.A,{message:(0,j.jsx)(c.Localize,{i18n_default_text:"We've received your proof of income"}),text:(0,j.jsx)(c.Localize,{i18n_default_text:"We'll review your documents and notify you of its status within 7 working days."}),icon:(0,j.jsx)(m.Icon,{icon:"IcPoincReceived",size:128})}),Si=()=>(0,j.jsx)(ne.A,{message:(0,j.jsx)(c.Localize,{i18n_default_text:"Limit reached"}),text:(0,j.jsx)(c.Localize,{i18n_default_text:"You have reached the maximum number of allowed attempts for submitting proof of income. <0 /> Please check the email we've sent you for further information.",components:[(0,j.jsx)("br",{},0)]}),icon:(0,j.jsx)(m.Icon,{icon:"IcPoincLimited",size:128})}),ki=()=>(0,j.jsx)(ne.A,{message:(0,j.jsx)(c.Localize,{i18n_default_text:"Proof of income verification passed"}),icon:(0,j.jsx)(m.Icon,{icon:"IcPoincVerified",size:128})}),Ni=e=>{let{is_switching:t,refreshNotifications:i}=e;const[a,o]=n().useState(!0),[s,c]=n().useState({allow_document_upload:!1,allow_poinc_resubmission:!1,needs_poinc:!1,income_status:ji.NONE,is_age_verified:!1,is_fully_authenticated:!1});n().useEffect((()=>{t||l.WS.authorized.getAccountStatus().then((e=>{const{get_account_status:t}=e,{allow_document_upload:a,allow_poinc_resubmission:n,income_status:r,needs_poinc:l,is_age_verified:d,is_fully_authenticated:_}=Pt(t);c({...s,allow_document_upload:a,allow_poinc_resubmission:n,needs_poinc:l,income_status:r,is_age_verified:d,is_fully_authenticated:_}),o(!1),i()}))}),[t]);const d=e=>{c({...s,income_status:e})},{allow_document_upload:_,allow_poinc_resubmission:u,income_status:p,needs_poinc:f,is_age_verified:h,is_fully_authenticated:x}=s,g=_&&f&&h&&(u&&p===ji.LOCKED||p===ji.NONE);return a?(0,j.jsx)(m.Loading,{is_fullscreen:!1,className:"account__initial-loader"}):f&&x?g?(0,j.jsx)(vi,{onSubmit:d}):p===ji.PENDING?(0,j.jsx)(wi,{}):p===ji.VERIFIED?(0,j.jsx)(ki,{}):p===ji.REJECTED?(0,j.jsx)(zi,{onReSubmit:d}):p===ji.LOCKED?(0,j.jsx)(Si,{}):null:(0,j.jsx)(r.Redirect,{to:l.routes.account})},Ci=(0,o.observer)((()=>{const{client:e,notifications:t}=(0,o.useStore)(),{is_switching:i,is_virtual:a}=e,{refreshNotifications:s}=t;return a?(0,j.jsx)(oe.A,{has_button:!0}):(0,j.jsx)("div",{className:"proof-of-income",children:(0,j.jsx)(Ni,{is_switching:i,refreshNotifications:s})})}));var Ii=i("@deriv-com/analytics");const Ti=e=>{let{handleOnLogout:t}=e;const{oAuthLogout:i}=(0,p.useOauth2)({handleLogout:t});return(0,j.jsx)("div",{className:"dc-vertical-tab__header-account__logout-tab",onClick:i,"data-testid":"dt_logout_tab",onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||i()},role:"button",tabIndex:0,children:(0,j.jsxs)("div",{className:"dc-vertical-tab__header-account__logout",children:[(0,j.jsx)(m.Icon,{icon:"IcLogout",className:"dc-vertical-tab__header-account__logout--icon"}),(0,j.jsx)(m.Text,{size:"xs",weight:"bold",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Log out"})})]})})},Li=(0,o.observer)((e=>{let{routes:t,subroutes:i}=e;const a=(0,r.useHistory)(),{client:s,common:d,ui:_}=(0,o.useStore)(),{logout:u}=s,{is_from_derivgo:p,is_from_tradershub_os:h}=d,{setIsForcedToExitPnv:x}=_,{isDesktop:g}=(0,f.Y)(),b=n().useCallback((()=>{Ii.Analytics.trackEvent("ce_passkey_account_settings_form",{action:"close",form_name:"ce_passkey_account_settings_form",operating_system:(0,l.getOSNameWithUAParser)()})}),[]),y=t.map((e=>({icon:e.icon,label:e?.getTitle?.(),subitems:e?.subroutes?.length?e.subroutes.map((e=>i.indexOf(e))):[]}))),v=n().useCallback((()=>{location.pathname===l.routes.passkeys&&b(),a.push(l.routes.traders_hub)}),[a]),z=(0,l.getSelectedRoute)({routes:i,pathname:location.pathname});if(!g&&z){const e=z.component;return(0,j.jsx)(m.PageOverlay,{header:z?.getTitle?.(),onClickClose:v,is_from_app:p,is_from_tradershub_os:h,children:(0,j.jsx)(e,{component_icon:z.icon_component})})}return(0,j.jsx)(m.PageOverlay,{header:(0,j.jsx)(c.Localize,{i18n_default_text:"Settings"}),onClickClose:v,is_from_app:p,is_from_tradershub_os:h,children:(0,j.jsx)(m.VerticalTab,{is_floating:!0,current_path:location.pathname,is_routed:!0,is_full_width:!0,list:i,list_groups:y,extra_content:(0,j.jsx)(Ti,{handleOnLogout:async()=>{window.location.pathname.startsWith(l.routes.phone_verification)&&(x(!0),await new Promise((e=>setTimeout(e,0)))),a.push(l.routes.traders_hub),await u()}}),is_sidebar_enabled:g})})}));Li.displayName="PageOverlayWrapper";const Ai=Li,Di=(0,o.observer)((e=>{let{history:t,location:i,routes:a}=e;const{client:s,ui:r}=(0,o.useStore)(),{is_virtual:c,is_logged_in:d,is_logging_in:_,is_proof_of_ownership_enabled:u,landing_company_shortcode:p,should_allow_authentication:h,should_allow_poinc_authentication:x,is_passkey_supported:g}=s,{toggleAccountSettings:b,is_account_settings_visible:y}=r,{isMobile:v}=(0,f.Y)(),z=(0,l.flatten)(a.map((e=>e.subroutes))),w=z.find((e=>(0,l.matchRoute)(e,i.pathname))),S=!v||v&&!g;return n().useEffect((()=>{b(!0)}),[b]),a.forEach((e=>{e?.subroutes?.length&&e.subroutes.forEach((e=>{e.path===l.routes.financial_assessment&&(e.is_disabled=c),e.path===l.routes.trading_assessment&&(e.is_disabled=c||"maltainvest"!==p),e.path!==l.routes.proof_of_identity&&e.path!==l.routes.proof_of_address||(e.is_disabled=!h),e.path===l.routes.proof_of_ownership&&(e.is_disabled=c||!u),e.path===l.routes.proof_of_income&&(e.is_disabled=!x),e.path===l.routes.passkeys&&(e.is_hidden=S)}))})),w||t.push(l.routes.personal_details),!d&&_?(0,j.jsx)(m.Loading,{is_fullscreen:!0,className:"account__initial-loader"}):(0,j.jsx)(m.FadeWrapper,{is_visible:y,className:"account-page-wrapper",keyname:"account-page-wrapper",children:(0,j.jsx)("div",{className:"account",children:(0,j.jsx)(Ai,{routes:a,subroutes:z})})})}));Di.displayName="Account";const Pi=(0,r.withRouter)(Di);var Ei=i("./Components/forms/scroll-to-field-with-error.tsx");(0,o.observer)((e=>{let{disabled_items:t,value:i,getCurrentStep:a,onSave:n,onCancel:r,onSubmit:l,goToPreviousStep:c,goToNextStep:u,real_account_signup_target:h}=e;const{isMobile:x,isDesktop:g}=(0,f.Y)(),b=(0,s.useRef)(null),{tin_validation_config:v,mutate:z}=(0,p.useTinValidations)(),{client:w}=(0,o.useStore)(),S=(0,s.useMemo)((()=>["employment_status","tax_residence","tax_identification_number"].filter((e=>!t.includes(e)))||[]),[t]),k="maltainvest"===h,N=W({tin_config:v,is_mf:k,is_real:!w.is_virtual,is_duplicate_account:w.account_settings.immutable_fields?.includes("tax_identification_number")||w.account_settings.immutable_fields?.includes("tax_residence"),is_employment_status_tin_mandatory:!0});return(0,j.jsx)(_.Formik,{initialValues:{...i},validationSchema:N,validateOnMount:!0,onSubmit:(e,t)=>{const i=a()-1;n(i,e),l(i,e,t.setSubmitting,u)},children:e=>{let{handleSubmit:t,isSubmitting:i,values:o}=e;return(0,j.jsxs)(_.Form,{onSubmit:t,noValidate:!0,className:"employment-tax-info__layout",children:[(0,j.jsx)(Ei.A,{}),(0,j.jsx)(m.Div100vhContainer,{height_offset:"110px",is_disabled:!x,className:(0,d.A)("details-form"),children:(0,j.jsx)(m.ThemedScrollbars,{refSetter:b,className:(0,d.A)("details-form__elements","employment-tax-info__form"),children:(0,j.jsx)(C,{editable_fields:S,parent_ref:b,should_display_long_message:k,handleChange:z,tin_validation_config:v})})}),(0,j.jsx)(m.Modal.Footer,{has_separator:!0,is_bypassed:!g,children:(0,j.jsx)(m.FormSubmitButton,{is_disabled:i,label:(0,y.localize)("Next"),is_absolute:!g,has_cancel:!0,cancel_label:(0,y.localize)("Previous"),onCancel:()=>(e=>{const t=(a?.()||1)-1;n(t,e),r(t,c)})(o)})})]})}})}));const Fi=()=>(0,j.jsx)(r.Redirect,{to:l.routes.closing_account}),Ri=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("404").then(i.bind(i,"./Modules/Page404/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Oi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_Passwords_index_ts").then(i.bind(i,"./Sections/Security/Passwords/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Mi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Profile_PhoneVerification_index_ts").then(i.bind(i,"./Sections/Profile/PhoneVerification/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Ui=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_Passkeys_index_ts").then(i.bind(i,"./Sections/Security/Passkeys/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),qi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_AccountLimits_index_ts").then(i.bind(i,"./Sections/Security/AccountLimits/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Bi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_AccountClosed_index_ts").then(i.bind(i,"./Sections/Security/AccountClosed/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Yi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Profile_LanguageSettings_index_ts").then(i.bind(i,"./Sections/Profile/LanguageSettings/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Vi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_LoginHistory_index_ts").then(i.bind(i,"./Sections/Security/LoginHistory/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),$i=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_ConnectedApps_index_ts").then(i.bind(i,"./Sections/Security/ConnectedApps/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Wi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Assessment_FinancialAssessment_index_ts").then(i.bind(i,"./Sections/Assessment/FinancialAssessment/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Hi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Assessment_TradingAssessment_index_js").then(i.bind(i,"./Sections/Assessment/TradingAssessment/index.js"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Gi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_ApiToken_index_ts").then(i.bind(i,"./Sections/Security/ApiToken/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Ji=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_TwoFactorAuthentication_index_ts").then(i.bind(i,"./Sections/Security/TwoFactorAuthentication/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Ki=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_SelfExclusion_index_ts").then(i.bind(i,"./Sections/Security/SelfExclusion/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))(),Qi=(0,l.makeLazyLoader)((()=>(0,l.moduleLoader)((()=>i.e("Sections_Security_ClosingAccount_index_ts").then(i.bind(i,"./Sections/Security/ClosingAccount/index.ts"))))),(()=>(0,j.jsx)(m.Loading,{})))();let Zi;const Xi={component:Ri,getTitle:()=>(0,c.localize)("Error 404")},ea=e=>(0,j.jsx)(r.Route,{exact:e.exact,path:e.path,render:t=>{let i=null;if(e.component===r.Redirect){let a=e.to;if(e.path===l.routes.index){const{location:i}=t;a=i.pathname.toLowerCase().replace(e.path,"")}i=(0,j.jsx)(r.Redirect,{to:a})}else if(!e.is_authenticated||e.is_logged_in||e.is_logging_in){const a=(e.routes??[]).reduce(((e,t)=>({...e,...t.subroutes?.find((e=>e.default))})),{}),o=!(0,l.isEmptyObject)(a),s=(0,l.removeBranchName)(location.pathname),c=e.component;i=(0,j.jsxs)(n().Fragment,{children:[o&&s===e.path&&(0,j.jsx)(r.Redirect,{to:a?.path}),(0,j.jsx)(c,{...t,routes:e.routes})]})}else(0,l.redirectToLogin)(e.is_logged_in,(0,c.getLanguage)());const a=e.getTitle?.()??"";return document.title=`${a} | ${l.default_title}`,i}}),ta=(0,o.observer)((e=>{const{common:t}=(0,o.useStore)(),{current_language:i}=t;return(0,j.jsx)(n().Suspense,{fallback:(0,j.jsx)("div",{children:(0,j.jsx)(c.Localize,{i18n_default_text:"Loading..."})}),children:(0,j.jsx)(r.Switch,{children:(Zi||(Zi=[{path:l.routes.account_closed,component:Bi,is_authenticated:!1,getTitle:()=>(0,c.localize)("Account closed")},{path:l.routes.deactivate_account,component:Fi},{path:l.routes.account,component:Pi,is_authenticated:!0,getTitle:()=>(0,c.localize)("Account Settings"),icon_component:"IcUserOutline",routes:[{getTitle:()=>(0,c.localize)("Profile"),icon:"IcUserOutline",subroutes:[{path:l.routes.phone_verification,component:Mi,getTitle:()=>(0,c.localize)("Phone number verification"),is_hidden:!0},{path:l.routes.personal_details,component:K,getTitle:()=>(0,c.localize)("Personal details"),default:!0},{path:l.routes.languages,component:Yi,getTitle:()=>(0,c.localize)("Languages")}]},{getTitle:()=>(0,c.localize)("Assessments"),icon:"IcAssessment",subroutes:[{path:l.routes.trading_assessment,component:Hi,getTitle:()=>(0,c.localize)("Trading assessment")},{path:l.routes.financial_assessment,component:Wi,getTitle:()=>(0,c.localize)("Financial assessment")}]},{getTitle:()=>(0,c.localize)("Verification"),icon:"IcVerification",subroutes:[{path:l.routes.proof_of_identity,component:Ot,getTitle:()=>(0,c.localize)("Proof of identity")},{path:l.routes.proof_of_address,component:oi,getTitle:()=>(0,c.localize)("Proof of address")},{path:l.routes.proof_of_ownership,component:yi,getTitle:()=>(0,c.localize)("Proof of ownership")},{path:l.routes.proof_of_income,component:Ci,getTitle:()=>(0,c.localize)("Proof of income")}]},{getTitle:()=>(0,c.localize)("Security and safety"),icon:"IcSecurity",id:"security_routes",subroutes:[{path:l.routes.passwords,component:Oi,getTitle:()=>(0,c.localize)("Email and passwords")},{path:l.routes.passkeys,component:Ui,getTitle:()=>(0,c.localize)("Passkeys")},{path:l.routes.self_exclusion,component:Ki,getTitle:()=>(0,c.localize)("Self exclusion")},{path:l.routes.account_limits,component:qi,getTitle:()=>(0,c.localize)("Account limits")},{path:l.routes.login_history,component:Vi,getTitle:()=>(0,c.localize)("Login history")},{path:l.routes.api_token,component:Gi,getTitle:()=>(0,c.localize)("API token")},{path:l.routes.connected_apps,component:$i,getTitle:()=>(0,c.localize)("Connected apps")},{path:l.routes.two_factor_authentication,component:Ji,getTitle:()=>(0,c.localize)("Two-factor authentication")},{path:l.routes.closing_account,component:Qi,getTitle:()=>(0,c.localize)("Close your account")}]}]}],Zi.push(Xi)),Zi).map(((t,a)=>(0,j.jsx)(ea,{...t,...e},`${a}_${i}`)))})})}));var ia=i("../../../node_modules/@deriv-com/quill-ui/dist/providers/theme/themeProvider.js");const aa=(0,o.observer)((()=>{const{client:e,common:t,ui:i}=(0,o.useStore)(),{is_logged_in:a,is_logging_in:s}=e,{error:n,has_error:r}=t,{is_dark_mode_on:l}=i;return r?(0,j.jsx)(se.A,{...n}):(0,j.jsx)(ia.N,{theme:l?"dark":"light",children:(0,j.jsx)(ta,{is_logged_in:a,is_logging_in:s})})})),oa=(0,a.withRouter)(aa),sa=e=>{let{setDialogTitleFunc:t,toggleResetTradingPasswordModal:i,verification_code:a,platform:o}=e;return(0,j.jsx)("div",{className:"reset-trading-password",children:(0,j.jsx)(_.Formik,{initialValues:{password:""},initialStatus:{reset_complete:!1,error_msg:"",error_code:""},validate:e=>{const t={},i=o===l.CFD_PLATFORMS.MT5?16:25;return(0,l.validLength)(e.password,{min:8,max:i})?(0,l.validPassword)(e.password)?o!==l.CFD_PLATFORMS.MT5||(0,l.validMT5Password)(e.password)||(t.password=(0,c.localize)("Please include at least 1 special character such as ( _ @ ? ! / # ) in your password.")):t.password=(0,l.getErrorMessages)().password():t.password=(0,c.localize)("You should enter {{min_number}}-{{max_number}} characters.",{min_number:8,max_number:i}),t},onSubmit:(e,i)=>{i.setSubmitting(!0);const s={new_password:e.password,verification_code:a,platform:o};l.WS.tradingPlatformPasswordReset(s).then((async e=>{e.error?(i.setStatus({error_msg:e.error.message,error_code:e.error.code}),t?.(!0)):(i.resetForm({password:""}),i.setStatus({reset_complete:!0}),l.WS.getAccountStatus()),i.setSubmitting(!1)}))},children:e=>{let{handleBlur:t,errors:a,values:s,resetForm:r,touched:d,isSubmitting:u,setFieldTouched:p,handleChange:f,status:h}=e;return(0,j.jsx)(_.Form,{children:(0,j.jsxs)(n().Fragment,{children:[h.error_msg&&(0,j.jsxs)("div",{className:"reset-trading-password__error",children:[(0,j.jsx)(m.Icon,{icon:"IcMt5Expired",size:128}),(0,j.jsx)(m.Text,{as:"p",size:"xs",weight:"bold",align:"center",className:"reset-trading-password__lead",children:h.error_msg}),"InvalidToken"===h.error_code&&(0,j.jsx)(m.Text,{as:"p",color:"prominent",size:"xs",align:"center",className:"reset-trading-password__description--is-centered",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Please request a new password and check your email for the new token."})}),(0,j.jsx)(m.Button,{className:"reset-trading-password__confirm-button",primary:!0,large:!0,onClick:()=>{r(),i(!1)},children:(0,j.jsx)(c.Localize,{i18n_default_text:"Ok"})})]}),h.reset_complete&&(0,j.jsxs)("div",{className:"reset-trading-password__password-success",children:[(0,j.jsx)(m.Icon,{className:"reset-trading-password__icon",icon:"IcSuccessResetTradingPassword",size:128}),(0,j.jsx)(m.Text,{as:"p",weight:"bold",className:"reset-trading-password__heading",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Success"})}),(0,j.jsx)(m.Text,{align:"center",as:"p",size:"xs",className:"reset-trading-password__subtext",children:(0,c.localize)("You have a new {{platform}} password to log in to your {{platform}} accounts on the web and mobile apps.",{platform:(0,l.getCFDPlatformLabel)(o)})}),(0,j.jsx)(m.Button,{type:"button",onClick:()=>{r(),i(!1)},primary:!0,large:!0,children:(0,j.jsx)(c.Localize,{i18n_default_text:"Done"})})]}),!h.error_msg&&!h.reset_complete&&(0,j.jsxs)("div",{className:"reset-trading-password__set-password",children:[(0,j.jsx)(m.Text,{as:"p",weight:"bold",className:"reset-trading-password__heading",children:(0,j.jsx)(c.Localize,{i18n_default_text:"Create a new {{platform}} password",values:{platform:(0,l.getCFDPlatformLabel)(o)}})}),(0,j.jsx)(m.Text,{as:"p",size:"xs",className:"reset-trading-password__details",children:(0,j.jsx)(c.Localize,{i18n_default_text:"You can use this password for all your {{platform}} accounts.",values:{platform:(0,l.getCFDPlatformLabel)(o)}})}),(0,j.jsx)("fieldset",{className:"reset-trading-password__input-field",children:(0,j.jsx)(m.PasswordMeter,{input:s.password,has_error:!(!d.password||!a.password),custom_feedback_messages:(0,l.getErrorMessages)().password_warnings,children:(0,j.jsx)(m.PasswordInput,{autoComplete:"new-password",className:"reset-trading-password__password-field",name:"password",label:(0,c.localize)("{{platform}} password",{platform:(0,l.getCFDPlatformLabel)(o)}),onChange:e=>{p("password",!0),f(e)},onBlur:t,error:d.password?a.password:"",value:s.password,"data-lpignore":"true",required:!0})})}),(0,j.jsx)(m.Text,{as:"p",size:"xs",className:"reset-trading-password__hint",children:o===l.CFD_PLATFORMS.MT5?(0,j.jsx)(c.Localize,{i18n_default_text:"Your password must contain between 8-16 characters that include uppercase and lowercase letters, and at least one number and special character such as ( _ @ ? ! / # )."}):(0,j.jsx)(c.Localize,{i18n_default_text:"Strong passwords contain at least 8 characters, combine uppercase and lowercase letters, numbers, and symbols."})}),(0,j.jsx)(m.FormSubmitButton,{is_disabled:!s.password||!!a.password||u,has_cancel:!0,cancel_label:(0,c.localize)("Cancel"),onCancel:()=>i(!1),is_loading:u,label:(0,c.localize)("Create")})]})]})})}})})},na=e=>{let{disableApp:t,enableApp:i,is_loading:a,is_visible:o,toggleResetTradingPasswordModal:s,verification_code:d,platform:_}=e;const[u,p]=n().useState(""),f=(0,r.useHistory)();return n().useEffect((()=>{o&&""!==f.location.search&&f.replace({search:"",hash:location.hash})}),[f,o]),(0,j.jsx)(m.Dialog,{className:"reset-trading-password__dialog",disableApp:t,enableApp:i,has_close_icon:!!u,is_loading:a,is_visible:o,onConfirm:()=>s(!1),title:u,children:(0,j.jsx)(sa,{toggleResetTradingPasswordModal:s,verification_code:d,setDialogTitleFunc:e=>{p(e?(0,c.localize)("Reset {{platform}} password",{platform:(0,l.getCFDPlatformLabel)(_)}):"")},platform:_})})},ra=(0,o.observer)((()=>{const{ui:e,client:t}=(0,o.useStore)(),{enableApp:i,disableApp:a,is_loading:n,setCFDPasswordResetModal:c,is_cfd_reset_password_modal_enabled:d}=e,_=(0,r.useLocation)(),u=(0,s.useRef)(""),m=new URLSearchParams(_.search),p=/^trading_platform_(.*)_password_reset$/.exec(m.get("action")??"")?.[1];p&&(u.current=p);const f=u.current===l.CFD_PLATFORMS.MT5?t.verification_code.trading_platform_mt5_password_reset:t.verification_code.trading_platform_dxtrade_password_reset;return(0,j.jsx)(na,{platform:u.current,enableApp:i,disableApp:a,toggleResetTradingPasswordModal:c,is_visible:d,is_loading:n,verification_code:f})}));ra.displayName="ResetTradingPassword";const la=ra;var ca=i("react-dom"),da=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Snackbar/snackbar.js");const _a=e=>{let{status:t,portal_id:i,message:a}=e;const[o,n]=(0,s.useState)(!1),{isMobile:r}=(0,f.Y)(),l=document.getElementById(i);return(0,s.useEffect)((()=>{l&&a&&r&&(o||"online"===t?o&&"online"===t&&setTimeout((()=>{n(!1)}),1500):n(!0))}),[r,o,a,l,t]),l&&a&&r?(0,ca.createPortal)((0,j.jsx)("div",{className:"network-status__container",children:(0,j.jsx)(da.q,{hasCloseButton:!1,message:a,isVisible:o})}),l):null},ua=(0,o.observer)((()=>{const{common:{network_status:e}}=(0,o.useStore)();return(0,j.jsx)(_a,{portal_id:"popup_root",message:e.tooltip,status:e.class})}));var ma=i("../../../node_modules/@deriv-com/quill-ui/dist/providers/breakpoint/breakpointProvider.js");const pa=e=>{let{passthrough:t}=e;const{root_store:i}=t,{notification_messages_ui:a}=i.ui;return(0,j.jsxs)(o.StoreProvider,{store:i,children:[(0,j.jsx)(u.APIProvider,{children:(0,j.jsx)(l.POIProvider,{children:(0,j.jsxs)(ma.p,{children:[a&&(0,j.jsx)(a,{}),(0,j.jsx)(oa,{}),(0,j.jsx)(la,{})]})})}),(0,j.jsx)(ua,{})]})}},"./Components/demo-message/index.ts":(e,t,i)=>{i.d(t,{A:()=>d});var a=i("@deriv-com/translations"),o=(i("react"),i("@deriv/components")),s=i("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),n=i("@deriv/stores"),r=i("@deriv/translations"),l=i("../../../node_modules/react/jsx-runtime.js");const c=(0,n.observer)((e=>{let{has_button:t,icon:i,message:a}=e;const{client:c,ui:d}=(0,n.useStore)(),{isDesktop:_}=(0,s.Y)(),{has_any_real_account:u}=c,{toggleAccountsDialog:m,toggleShouldShowRealAccountsList:p}=d;return(0,l.jsxs)("div",{className:"da-icon-with-message",children:[(0,l.jsx)(o.Icon,{icon:i,size:128}),(0,l.jsx)(o.Text,{className:"da-icon-with-message__text",as:"p",color:"general",size:_?"s":"xs",line_height:"m",weight:"bold",children:a}),t&&(0,l.jsx)(o.Button,{primary:!0,onClick:()=>{p(!0),m()},className:"account__demo-message-button","data-testid":"icon-with-message-button",children:u?(0,r.localize)("Switch to real account"):(0,r.localize)("Add a real account")})]})})),d=e=>{let{has_button:t}=e;const{localize:i}=(0,a.useTranslations)();return(0,l.jsx)(c,{icon:"IcPoaLock",message:i("This feature is not available for demo accounts."),has_button:t})}},"./Components/error-component/index.ts":(e,t,i)=>{i.d(t,{A:()=>r});var a=i("@deriv/components"),o=i("@deriv-com/translations"),s=i("@deriv/shared"),n=i("../../../node_modules/react/jsx-runtime.js");const r=e=>{let{header:t,message:i,redirect_label:r,redirectOnClick:l,should_show_refresh:c=!0}=e;const d=c?(0,n.jsx)(o.Localize,{i18n_default_text:"Please refresh this page to continue."}):"";return(0,n.jsx)(a.PageError,{header:t||(0,n.jsx)(o.Localize,{i18n_default_text:"Oops, something went wrong."}),messages:i?[i,d]:[(0,n.jsx)(o.Localize,{i18n_default_text:"Sorry, an error occurred while processing your request."},0),d],redirect_urls:[s.routes.trade],redirect_labels:[r??(0,n.jsx)(o.Localize,{i18n_default_text:"Refresh"})],buttonOnClick:l??(()=>location.reload())})}},"./Components/form-body-section/index.ts":(e,t,i)=>{i.d(t,{A:()=>d});var a=i("react"),o=i.n(a),s=i("../../../node_modules/clsx/dist/clsx.mjs"),n=i("@deriv/components"),r=i("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),l=i("@deriv/translations"),c=i("../../../node_modules/react/jsx-runtime.js");const d=e=>{let{children:t,has_side_note:i,side_note:a,side_note_position:d="left",type:_="text"}=e;const{isDesktop:u}=(0,r.Y)();return i?(0,c.jsxs)("div",{"data-testid":"dt_side_note_container",className:(0,s.A)("account-form__section",{"account-form__section--reversed":"right"===d}),children:[(0,c.jsx)("div",{className:(0,s.A)("account-form__section-side-note",{"account-form__section-side-note__example":"text"!==_}),children:"text"===_?(0,c.jsx)(n.Text,{color:"less-prominent",size:u?"xs":"xxs","data-testid":"dt_side_note_text",children:a}):(0,c.jsxs)(o().Fragment,{children:[(0,c.jsx)(n.Text,{as:"p",size:u?"xs":"xxs",weight:"bold",children:(0,c.jsx)(l.Localize,{i18n_default_text:"Example :"})}),(0,c.jsx)("div",{className:"account-form__section-side-note__example-image",children:a})]})}),(0,c.jsx)("div",{className:"account-form__section-content",children:t})]}):t}},"./Components/form-body/index.ts":(e,t,i)=>{i.d(t,{A:()=>c});var a=i("react"),o=i("../../../node_modules/clsx/dist/clsx.mjs"),s=i("@deriv/components"),n=i("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),r=i("../../../node_modules/react/jsx-runtime.js");const l=e=>{let{children:t,className:i,scroll_offset:a,isFullHeight:l=!1}=e;const{isDesktop:c}=(0,n.Y)(),d=l?"100vh":"100%";return(0,r.jsx)(s.ThemedScrollbars,{is_bypassed:!c,height:a?`calc(${d} - ${a})`:"100%",children:(0,r.jsx)("div",{className:(0,o.A)("account__scrollbars_container",i),"data-testid":"dt_scrollbar_container_div",children:t})})},c=e=>{let{children:t,scroll_offset:i,className:c,isFullHeight:d}=e;const{isDesktop:_}=(0,n.Y)();return(0,r.jsx)(a.Fragment,{children:_?(0,r.jsx)(l,{className:(0,o.A)("account__scrollbars_container--grid-layout",c),scroll_offset:i,isFullHeight:d,children:t}):(0,r.jsx)(s.Div100vhContainer,{className:(0,o.A)("account__scrollbars_container--grid-layout",c),height_offset:i||"100%",children:t})})}},"./Components/form-footer/index.ts":(e,t,i)=>{i.d(t,{A:()=>s}),i("react");var a=i("../../../node_modules/clsx/dist/clsx.mjs"),o=i("../../../node_modules/react/jsx-runtime.js");const s=e=>{let{children:t,className:i}=e;return(0,o.jsx)("div",{className:(0,a.A)("account-form__footer",i),"data-testid":"form-footer-container",children:t})}},"./Components/form-sub-header/index.ts":(e,t,i)=>{i.d(t,{A:()=>r});var a=i("react"),o=i("../../../node_modules/clsx/dist/clsx.mjs"),s=i("@deriv/components"),n=i("../../../node_modules/react/jsx-runtime.js");const r=e=>{let{description:t,subtitle:i,title:r,title_text_size:l="xs"}=e;const c=r.replace(/\s+/g,"-").toLowerCase();return(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)("div",{className:(0,o.A)("account-form__header",c,{"account-form__header--has-description":!!t}),"data-testid":"form-sub-header",children:(0,n.jsxs)("div",{className:"account-form__header-section",children:[(0,n.jsx)(s.Text,{as:"h1",color:"prominent",weight:"bold",size:l,className:"account-form__title",children:r}),i&&(0,n.jsx)(s.Text,{as:"h2",size:"xxxs",color:"prominent",className:"account-form__subtitle",children:i})]})}),t&&(0,n.jsx)(s.Text,{as:"p",className:"account-form__description",children:t})]})}},"./Components/forms/form-fields/index.ts":(e,t,i)=>{i.d(t,{XU:()=>l,bE:()=>m,lp:()=>n,t$:()=>h,Oz:()=>f}),i("react");var a=i("formik"),o=i("@deriv/components"),s=i("../../../node_modules/react/jsx-runtime.js");const n=e=>{let{name:t,warn:i,...n}=e;return(0,s.jsx)(a.Field,{name:t,children:e=>{let{field:t,form:{errors:a,touched:r,setFieldTouched:l}}=e;return(0,s.jsx)(o.Input,{...t,...n,type:"text",autoComplete:"off",error:r[t.name]&&a[t.name]?a[t.name]:void 0,warn:i,onChange:e=>{!r[t.name]&&l(t.name),t.onChange(e)}})}})};var r=i("@deriv/shared");const l=e=>{let{name:t,portal_id:i,...n}=e;return(0,s.jsx)(a.Field,{name:t,children:e=>{let{field:a,form:{setFieldValue:l},meta:{error:c,touched:d}}=e;return(0,s.jsx)(o.DateOfBirthPicker,{...n,...a,error:d?c:void 0,name:t,onChange:e=>{let{target:i}=e;return l(t,i?.value?(0,r.toMoment)(i.value).format("YYYY-MM-DD"):"",!0)},portal_id:i})}})};var c=i("@deriv-com/translations"),d=i("./Constants/financial-information-list.ts"),_=i("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),u=i("../../../node_modules/clsx/dist/clsx.mjs");const m=e=>{let{required:t,is_disabled:i,fieldFocused:n}=e;const{isDesktop:r}=(0,_.Y)(),{localize:l}=(0,c.useTranslations)();return(0,s.jsx)(a.Field,{name:"employment_status",children:e=>{let{field:a,form:{setFieldValue:c,setFieldTouched:_,handleBlur:m,handleChange:p},meta:f}=e;return(0,s.jsx)("div",{className:"employment-status-field",children:r?(0,s.jsx)(o.Dropdown,{...a,placeholder:l(t?"Employment status*":"Employment status"),is_align_text_left:!0,name:a.name,list:(0,d.Rx)(),value:a.value,onChange:e=>{c("tin_skipped",0,!0),c(a.name,e.target?.value,!0),p(e)},handleBlur:m,error:f.touched?f.error:void 0,disabled:i,className:(0,u.A)("dropdown-field",{"focus-field":n})}):(0,s.jsx)(o.SelectNative,{...a,placeholder:l("Please select"),name:a.name,label:l(t?"Employment status*":"Employment status"),list_items:(0,d.Rx)(),value:a.value,error:f.touched?f.error:void 0,onChange:e=>{c("tin_skipped",0,!0),_("employment_status",!0),p(e)},disabled:i,className:(0,u.A)({"focus-field":n})})})}})};var p=i("@deriv/hooks");const f=e=>{let{required:t=!1,setIsTaxResidencePopoverOpen:i,setIsTinPopoverOpen:n,is_tax_residence_popover_open:r,disabled:l,fieldFocused:d}=e;const{data:m}=(0,p.useResidenceList)(),{isDesktop:f}=(0,_.Y)(),{localize:h}=(0,c.useTranslations)();return(0,s.jsx)(a.Field,{name:"tax_residence",children:e=>{let{field:a,form:{setFieldValue:c},meta:_}=e;return(0,s.jsxs)("div",{className:"details-form__tax",children:[f?(0,s.jsx)(o.Autocomplete,{...a,"data-lpignore":"true",autoComplete:"off",label:h(t?"Tax residence*":"Tax residence"),error:_.touched?_.error:void 0,list_items:m,onItemSelection:e=>{c("tax_residence",e.value?e.text:"",!0)},"data-testid":"tax_residence",disabled:l,required:t,className:(0,u.A)({"focus-field":d})}):(0,s.jsx)(o.SelectNative,{...a,placeholder:h(t?"Tax residence*":"Tax residence"),name:a.name,label:h(t?"Tax residence*":"Tax residence"),list_items:m,value:a.value,use_text:!0,error:_.touched?_.error:"",onChange:e=>{a.onChange(e),c("tax_residence",e.target.value,!0)},required:t,data_testid:"tax_residence_mobile",disabled:l,className:(0,u.A)({"focus-field":d})}),(0,s.jsx)("div",{"data-testid":"tax_residence_pop_over",onClick:e=>{i(!0),n(!1),e.stopPropagation()},children:(0,s.jsx)(o.Popover,{alignment:f?"right":"left",icon:"info",message:h("The country in which you meet the criteria for paying taxes. Usually the country in which you physically reside."),zIndex:"9998",disable_message_icon:!0,is_open:r})})]})}})},h=e=>{let{required:t=!1,is_tin_popover_open:i,setIsTinPopoverOpen:a,setIsTaxResidencePopoverOpen:r,disabled:l,fieldFocused:d}=e;const{localize:m}=(0,c.useTranslations)(),{isDesktop:p}=(0,_.Y)();return(0,s.jsxs)("div",{className:"details-form__tax",children:[(0,s.jsx)(n,{name:"tax_identification_number",label:m(t?"Tax identification number*":"Tax identification number"),placeholder:m("Tax identification number"),"data-testid":"tax_identification_number",disabled:l,required:t,className:(0,u.A)({"focus-field":d})}),(0,s.jsx)("div",{"data-testid":"tax_identification_number_pop_over",onClick:e=>{r(!1),a(!0),"A"!==e.target.tagName&&e.stopPropagation()},children:(0,s.jsx)(o.Popover,{alignment:p?"right":"left",icon:"info",is_open:i,message:(0,s.jsx)(c.Localize,{i18n_default_text:"Don't know your tax identification number? Click <0>here</0> to learn more.",components:[(0,s.jsx)("a",{className:"link link--red",rel:"noopener noreferrer",target:"_blank",href:"https://www.oecd.org/tax/automatic-exchange/crs-implementation-and-assistance/tax-identification-numbers/"},0)]}),zIndex:"9998",disable_message_icon:!0})})]})}},"./Components/forms/scroll-to-field-with-error.tsx":(e,t,i)=>{i.d(t,{A:()=>n});var a=i("react"),o=i.n(a),s=i("formik");const n=e=>{let{fields_to_scroll_top:t,fields_to_scroll_bottom:i,should_recollect_inputs_names:a=!1}=e;const[n,r]=o().useState([]),{errors:l,isSubmitting:c}=(0,s.useFormikContext)(),d=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"center";if(!e)return;const i=document.querySelector(`[name="${e}"]`),a=i?.parentElement??i;"function"==typeof a?.scrollIntoView&&a?.scrollIntoView({behavior:"smooth",block:t}),"radio"!==i?.type&&i?.focus()};return o().useEffect((()=>{const e=[...document.querySelectorAll("input, select")];r(e.map((e=>e.name)))}),[a]),o().useEffect((()=>{const e=n.find((e=>Object.prototype.hasOwnProperty.call(l,e)))||"";t?.includes(e)?d(e,"start"):i?.includes(e)?d(e,"end"):d(e)}),[c]),null}},"./Components/icon-message-content/icon-message-content.tsx":(e,t,i)=>{i.d(t,{A:()=>r}),i("react");var a=i("../../../node_modules/clsx/dist/clsx.mjs"),o=i("@deriv/components"),s=i("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),n=i("../../../node_modules/react/jsx-runtime.js");const r=e=>{let{children:t,className:i,full_width:r,icon:l,is_disabled_for_mobile:c=!1,message:d,text:_}=e;const{isDesktop:u}=(0,s.Y)();return(0,n.jsx)(o.Div100vhContainer,{className:(0,a.A)("account-management__message-wrapper",{"account-management__message-wrapper-full-width":r}),is_disabled:u||c,height_offset:"110px",children:(0,n.jsxs)("div",{className:(0,a.A)("account-management__message-content",{[`${i}__message-content`]:i}),children:[l&&(0,n.jsx)("div",{className:(0,a.A)("account-management__message-icon",{[`${i}__message-icon`]:i}),children:l}),(0,n.jsx)(o.Text,{as:"div",color:"general",weight:"bold",align:"center",className:(0,a.A)("account-management__message",{[`${i}__message`]:i}),children:d}),_&&(0,n.jsx)("div",{className:"account-management__text-container",children:(0,n.jsx)(o.Text,{className:(0,a.A)({[`${i}__text`]:i}),as:"p",size:"xs",align:"center",children:_})}),t]})})}},"./Components/icon-message-content/index.ts":(e,t,i)=>{i.d(t,{A:()=>a});const a=i("./Components/icon-message-content/icon-message-content.tsx").A},"./Components/inline-note-with-icon/index.ts":(e,t,i)=>{i.d(t,{A:()=>s}),i("react");var a=i("@deriv/components"),o=i("../../../node_modules/react/jsx-runtime.js");const s=e=>{let{icon:t,message:i,font_size:s="xxxs",title:n}=e;return(0,o.jsxs)("div",{className:"da-inline-note-with-icon",children:[t&&(0,o.jsx)("div",{children:(0,o.jsx)(a.Icon,{icon:t,size:16})}),(0,o.jsxs)(a.Text,{as:"p",size:s,line_height:"s",children:[n&&(0,o.jsxs)("strong",{children:[" ",n," "]}),i]})]})}},"./Components/leave-confirm/index.ts":(e,t,i)=>{i.d(t,{A:()=>p});var a=i("react"),o=i.n(a),s=i("react-router-dom"),n=i("formik"),r=i("@deriv/components"),l=i("@deriv/translations"),c=i("./Components/icon-message-content/index.ts"),d=i("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),_=i("../../../node_modules/react/jsx-runtime.js");const u=e=>{let{back:t,leave:i}=e;const{isMobile:a}=(0,d.Y)();return(0,_.jsx)(c.A,{className:"leave-confirm",message:(0,l.localize)("Unsaved changes"),text:(0,l.localize)("You have unsaved changes. Are you sure you want to discard changes and leave this page?"),icon:(0,_.jsx)(r.Icon,{icon:"IcUnsavedChanges",size:a?93:128,data_testid:"dt_unsaved_changes_icon"}),is_disabled_for_mobile:!0,children:(0,_.jsxs)("div",{className:"account-management-flex-wrapper account-management-leave-confirm",children:[(0,_.jsx)(r.Button,{type:"button",has_effect:!0,onClick:t,text:(0,l.localize)("Cancel"),secondary:!0,large:a}),(0,_.jsx)(r.Button,{type:"button",has_effect:!0,onClick:i,text:(0,l.localize)("Leave Settings"),primary:!0,large:a})]})})},m=(0,s.withRouter)((e=>{let{dirty:t,onDirty:i}=e;const a=(0,s.useHistory)(),n=(0,s.useLocation)(),{isMobile:l}=(0,d.Y)(),[c,m]=o().useState(!1),[p,f]=o().useState(n.pathname);o().useEffect((()=>{const e=a.block((e=>!(t&&!c&&(i&&i(!1),f(e.pathname),m(!0),1))));return()=>e()}),[t,c,a,i]);const h=o().useCallback((()=>{p&&(m(!1),a.push(p),i&&i(!1))}),[p,a,i]),x=()=>{m(!1),f(n.pathname),i&&i(!0)};return(0,_.jsx)(_.Fragment,{children:c&&l?(0,_.jsx)(u,{back:x,leave:h}):(0,_.jsx)(r.Modal,{is_open:c,small:!0,toggleModal:x,children:(0,_.jsx)(r.Modal.Body,{children:(0,_.jsx)(u,{back:x,leave:h})})})})})),p=e=>{let{onDirty:t}=e;return(0,_.jsx)(n.FormikConsumer,{children:e=>(0,_.jsx)(m,{onDirty:t,dirty:e.dirty&&0===e.submitCount})})}},"./Components/load-error-message/index.ts":(e,t,i)=>{i.d(t,{A:()=>n});var a=i("@deriv/components"),o=i("./Components/icon-message-content/index.ts"),s=i("../../../node_modules/react/jsx-runtime.js");const n=e=>{let{error_message:t}=e;return(0,s.jsx)(o.A,{message:t,icon:(0,s.jsx)(a.Icon,{icon:"IcPoaLock",size:128})})}},"./Constants/financial-information-list.ts":(e,t,i)=>{i.d(t,{DO:()=>f,E$:()=>g,JB:()=>l,QL:()=>h,Rx:()=>s,TC:()=>n,fb:()=>d,jL:()=>m,ke:()=>b,ow:()=>x,pR:()=>_,qd:()=>r,rf:()=>o,t6:()=>u,tw:()=>c,tx:()=>p});var a=i("@deriv-com/translations");const o=()=>[{text:(0,a.localize)("Salaried Employee"),value:"Salaried Employee"},{text:(0,a.localize)("Self-Employed"),value:"Self-Employed"},{text:(0,a.localize)("Investments & Dividends"),value:"Investments & Dividends"},{text:(0,a.localize)("Pension"),value:"Pension"},{text:(0,a.localize)("State Benefits"),value:"State Benefits"},{text:(0,a.localize)("Savings & Inheritance"),value:"Savings & Inheritance"}],s=()=>[{text:(0,a.localize)("Employed"),value:"Employed"},{text:(0,a.localize)("Pensioner"),value:"Pensioner"},{text:(0,a.localize)("Self-Employed"),value:"Self-Employed"},{text:(0,a.localize)("Student"),value:"Student"},{text:(0,a.localize)("Unemployed"),value:"Unemployed"}],n=()=>[{text:(0,a.localize)("Construction"),value:"Construction"},{text:(0,a.localize)("Education"),value:"Education"},{text:(0,a.localize)("Finance"),value:"Finance"},{text:(0,a.localize)("Health"),value:"Health"},{text:(0,a.localize)("Tourism"),value:"Tourism"},{text:(0,a.localize)("Information & Communications Technology"),value:"Information & Communications Technology"},{text:(0,a.localize)("Science & Engineering"),value:"Science & Engineering"},{text:(0,a.localize)("Legal"),value:"Legal"},{text:(0,a.localize)("Social & Cultural"),value:"Social & Cultural"},{text:(0,a.localize)("Agriculture"),value:"Agriculture"},{text:(0,a.localize)("Real Estate"),value:"Real Estate"},{text:(0,a.localize)("Food Services"),value:"Food Services"},{text:(0,a.localize)("Manufacturing"),value:"Manufacturing"},{text:(0,a.localize)("Unemployed"),value:"Unemployed"}],r=()=>[{text:(0,a.localize)("Accumulation of Income/Savings"),value:"Accumulation of Income/Savings"},{text:(0,a.localize)("Cash Business"),value:"Cash Business"},{text:(0,a.localize)("Company Ownership"),value:"Company Ownership"},{text:(0,a.localize)("Divorce Settlement"),value:"Divorce Settlement"},{text:(0,a.localize)("Inheritance"),value:"Inheritance"},{text:(0,a.localize)("Investment Income"),value:"Investment Income"},{text:(0,a.localize)("Sale of Property"),value:"Sale of Property"}],l=()=>[{text:(0,a.localize)("Primary"),value:"Primary"},{text:(0,a.localize)("Secondary"),value:"Secondary"},{text:(0,a.localize)("Tertiary"),value:"Tertiary"}],c=()=>[{text:(0,a.localize)("Less than $25,000"),value:"Less than $25,000"},{text:(0,a.localize)("$25,000 - $50,000"),value:"$25,000 - $50,000"},{text:(0,a.localize)("$50,001 - $100,000"),value:"$50,001 - $100,000"},{text:(0,a.localize)("$100,001 - $500,000"),value:"$100,001 - $500,000"},{text:(0,a.localize)("Over $500,000"),value:"Over $500,000"}],d=()=>[{text:(0,a.localize)("Less than $100,000"),value:"Less than $100,000"},{text:(0,a.localize)("$100,000 - $250,000"),value:"$100,000 - $250,000"},{text:(0,a.localize)("$250,001 - $500,000"),value:"$250,001 - $500,000"},{text:(0,a.localize)("$500,001 - $1,000,000"),value:"$500,001 - $1,000,000"},{text:(0,a.localize)("Over $1,000,000"),value:"Over $1,000,000"}],_=()=>[...c()],u=()=>[{text:(0,a.localize)("0-1 year"),value:"0-1 year"},{text:(0,a.localize)("1-2 years"),value:"1-2 years"},{text:(0,a.localize)("Over 3 years"),value:"Over 3 years"}],m=()=>[{text:(0,a.localize)("0-5 transactions in the past 12 months"),value:"0-5 transactions in the past 12 months"},{text:(0,a.localize)("6-10 transactions in the past 12 months"),value:"6-10 transactions in the past 12 months"},{text:(0,a.localize)("11-39 transactions in the past 12 months"),value:"11-39 transactions in the past 12 months"},{text:(0,a.localize)("40 transactions or more in the past 12 months"),value:"40 transactions or more in the past 12 months"}],p=()=>[...u()],f=()=>[...m()],h=()=>[...u()],x=()=>[...m()],g=()=>[...u()],b=()=>[...m()]},"./Constants/onfido.js":(e,t,i)=>{i.d(t,{e:()=>o,u:()=>s});var a=i("@deriv/translations");const o=()=>({country_select:{alert_dropdown:{country_not_found:(0,a.localize)("Country not found")},alert:{another_doc:(0,a.localize)("Documents from that country are not currently supported — <fallback>try another document type</fallback>")},button_primary:(0,a.localize)("Submit document"),search:{accessibility:(0,a.localize)("Select country"),input_placeholder:(0,a.localize)("e.g. United States"),label:(0,a.localize)("Search for country")},title:(0,a.localize)("Select issuing country")},cross_device_checklist:{button_primary:(0,a.localize)("Submit verification"),info:(0,a.localize)("Tips"),list_item_doc_multiple:(0,a.localize)("Documents uploaded"),list_item_doc_one:(0,a.localize)("Document uploaded"),list_item_selfie:(0,a.localize)("Selfie uploaded"),subtitle:(0,a.localize)("We're now ready to verify your identity"),title:(0,a.localize)("Great, that's everything we need")},cross_device_error_desktop:{subtitle:(0,a.localize)("The link only works on mobile devices"),title:(0,a.localize)("Something's gone wrong")},cross_device_error_restart:{subtitle:(0,a.localize)("You'll need to restart your verification on your computer"),title:(0,a.localize)("Something's gone wrong")},cross_device_intro:{button_primary:(0,a.localize)("Get secure link"),list_accessibility:(0,a.localize)("Steps required to continue verification on your mobile"),list_item_finish:(0,a.localize)("Check back here to finish the submission"),list_item_open_link:(0,a.localize)("Open the link and complete the tasks"),list_item_send_phone:(0,a.localize)("Send a secure link to your phone"),subtitle:(0,a.localize)("Here's how to do it:"),title:(0,a.localize)("Continue on your phone")},cross_device_return:{body:(0,a.localize)("Your computer may take a few seconds to update"),subtitle:(0,a.localize)("You can now return to your computer to continue"),title:(0,a.localize)("Uploads successful")},doc_confirmation:{alert:{blur_detail:(0,a.localize)("Make sure everything is clear"),blur_title:(0,a.localize)("Blurry photo detected"),crop_detail:(0,a.localize)("Make sure full document is visible"),crop_title:(0,a.localize)("Cut-off image detected"),glare_detail:(0,a.localize)("Move away from direct light"),glare_title:(0,a.localize)("Glare detected"),no_doc_detail:(0,a.localize)("Make sure all of the document is in the photo"),no_doc_title:(0,a.localize)("No document detected")},body_id:(0,a.localize)("Make sure your card details are clear to read, with no blur or glare"),body_image_medium:(0,a.localize)("It’ll take longer to verify you if we can’t read it"),body_image_poor:(0,a.localize)("To smoothly verify you, we need a better photo"),body_license:(0,a.localize)("Make sure your license details are clear to read, with no blur or glare"),body_passport:(0,a.localize)("Make sure your passport details are clear to read, with no blur or glare"),body_permit:(0,a.localize)("Make sure your permit details are clear to read, with no blur or glare"),body_tax_letter:(0,a.localize)("Make sure details are clear to read, with no blur or glare"),button_close:(0,a.localize)("Close"),button_primary_redo:(0,a.localize)("Redo"),button_primary_upload:(0,a.localize)("Confirm"),button_primary_upload_anyway:(0,a.localize)("Upload anyway"),button_secondary_redo:(0,a.localize)("Redo"),button_zoom:(0,a.localize)("Enlarge image"),image_accessibility:(0,a.localize)("Photo of your document"),title:(0,a.localize)("Check your image")},doc_select:{button_id:(0,a.localize)("Identity card"),button_id_detail:(0,a.localize)("Front and back"),button_license:(0,a.localize)("Driver's license"),button_license_detail:(0,a.localize)("Front and back"),button_passport:(0,a.localize)("Passport"),button_passport_detail:(0,a.localize)("Face photo page"),button_permit:(0,a.localize)("Residence permit"),button_permit_detail:(0,a.localize)("Front and back"),extra_no_mobile:(0,a.localize)("Sorry, no mobile phone bills"),list_accessibility:(0,a.localize)("Documents you can use to verify your identity"),subtitle:(0,a.localize)("It must be an official photo ID"),subtitle_poa:(0,a.localize)("These are the documents most likely to show your current home address"),title:(0,a.localize)("Choose document"),title_poa:(0,a.localize)("Select a %{country} document")},doc_submit:{button_link_upload:(0,a.localize)("or upload photo – no scans or photocopies"),button_primary:(0,a.localize)("Continue on phone"),subtitle:(0,a.localize)("Take a photo with your phone"),title_id_back:(0,a.localize)("Submit identity card (back)"),title_id_front:(0,a.localize)("Submit identity card (front)"),title_license_back:(0,a.localize)("Submit license (back)"),title_license_front:(0,a.localize)("Submit license (front)"),title_passport:(0,a.localize)("Submit passport photo pages"),title_permit_back:(0,a.localize)("Submit residence permit (back)"),title_permit_front:(0,a.localize)("Submit residence permit (front)")},error_unsupported_browser:{subtitle_android:(0,a.localize)("Restart the process on the latest version of Google Chrome"),subtitle_ios:(0,a.localize)("Restart the process on the latest version of Safari"),title_android:(0,a.localize)("Unsupported browser"),title_ios:(0,a.localize)("Unsupported browser")},generic:{accessibility:{close_sdk_screen:(0,a.localize)("Close identity verification screen"),dismiss_alert:(0,a.localize)("Dismiss alert")},back:(0,a.localize)("back"),close:(0,a.localize)("close"),errors:{interrupted_flow_error:{instruction:(0,a.localize)("Restart process on a different device"),message:(0,a.localize)("Camera not detected")},invalid_size:{instruction:(0,a.localize)("Must be under 10MB."),message:(0,a.localize)("File size exceeded.")},invalid_type:{instruction:(0,a.localize)("Try using another file type."),message:(0,a.localize)("File not uploaded.")},lazy_loading:{message:(0,a.localize)("An error occurred while loading the component")},multiple_faces:{instruction:(0,a.localize)("Only your face can be in the selfie"),message:(0,a.localize)("Multiple faces found")},no_face:{instruction:(0,a.localize)("Your face is needed in the selfie"),message:(0,a.localize)("No face found")},request_error:{instruction:(0,a.localize)("Please try again"),message:(0,a.localize)("Connection lost")},sms_failed:{instruction:(0,a.localize)("Copy the link to your phone"),message:(0,a.localize)("Something's gone wrong")},sms_overuse:{instruction:(0,a.localize)("Copy the link to your phone"),message:(0,a.localize)("Too many failed attempts")},unsupported_file:{instruction:(0,a.localize)("Try using a JPG or PNG file"),message:(0,a.localize)("File type not supported")}},lazy_load_placeholder:(0,a.localize)("Loading..."),loading:(0,a.localize)("Loading")},get_link:{alert_wrong_number:(0,a.localize)("Check that your number is correct"),button_copied:(0,a.localize)("Copied"),button_copy:(0,a.localize)("Copy"),button_submit:(0,a.localize)("Send link"),info_qr_how:(0,a.localize)("How to scan a QR code"),info_qr_how_list_item_camera:(0,a.localize)("Point your phone’s camera at the QR code"),info_qr_how_list_item_download:(0,a.localize)("If it doesn’t work, download a QR code scanner from Google Play or the App Store"),link_divider:(0,a.localize)("or"),link_qr:(0,a.localize)("Scan QR code"),link_sms:(0,a.localize)("Get link via SMS"),link_url:(0,a.localize)("Copy link"),loader_sending:(0,a.localize)("Sending"),number_field_input_placeholder:(0,a.localize)("Enter mobile number"),number_field_label:(0,a.localize)("Enter your mobile number:"),subtitle_qr:(0,a.localize)("Scan the QR code with your phone"),subtitle_sms:(0,a.localize)("Send this one-time link to your phone"),subtitle_url:(0,a.localize)("Open the link on your mobile"),title:(0,a.localize)("Get your secure link"),url_field_label:(0,a.localize)("Copy the link to your mobile browser")},linked_computer:{button_primary:(0,a.localize)("Continue"),info:(0,a.localize)("Make sure"),list_item_desktop_open:(0,a.localize)("2. Your desktop window stays open"),list_item_sent_by_you:(0,a.localize)("1. This link was sent by you"),subtitle:(0,a.localize)("Continue with the verification"),title:(0,a.localize)("Linked to your computer")},mobilePhrases:{photo_upload:{body_id_back:(0,a.localize)("Take a photo of the back of your card"),body_id_front:(0,a.localize)("Take a photo of the front of your card"),body_license_back:(0,a.localize)("Take a photo of the back of your license"),body_license_front:(0,a.localize)("Take a photo of the front of your license"),body_passport:(0,a.localize)("Take a photo of your passport photo page"),body_selfie:(0,a.localize)("Take a selfie showing your face")},selfie_capture:{alert:{camera_inactive:{detail:(0,a.localize)("Take a photo using the <fallback>basic camera mode</fallback> instead")},camera_not_working:{detail:(0,a.localize)("Take a photo using the <fallback>basic camera mode</fallback> instead")}}},upload_guide:{button_primary:(0,a.localize)("Take a photo"),title:(0,a.localize)("Passport photo page")}},outro:{body:(0,a.localize)("Thank you"),title:(0,a.localize)("Verification complete")},permission_recovery:{button_primary:(0,a.localize)("Refresh"),info:(0,a.localize)("Recovery"),list_header_cam:(0,a.localize)("Follow these steps to recover camera access:"),list_item_action_cam:(0,a.localize)("Refresh this page to restart the identity verification process"),list_item_how_to_cam:(0,a.localize)("Grant access to your camera from your browser settings"),subtitle_cam:(0,a.localize)("Recover camera access to continue face verification"),title_cam:(0,a.localize)("Camera access is denied")},permission:{body_cam:(0,a.localize)("We cannot verify you without using your camera"),button_primary_cam:(0,a.localize)("Enable camera"),subtitle_cam:(0,a.localize)("When prompted, you must enable camera access to continue"),title_cam:(0,a.localize)("Allow camera access")},photo_upload:{body_bank_statement:(0,a.localize)("Provide the whole document page for best results"),body_benefits_letter:(0,a.localize)("Provide the whole document page for best results"),body_bill:(0,a.localize)("Provide the whole document page for best results"),body_government_letter:(0,a.localize)("Provide the whole document page for best results"),body_id_back:(0,a.localize)("Upload back of card from your computer"),body_id_front:(0,a.localize)("Upload front of card from your computer"),body_license_back:(0,a.localize)("Upload back of license from your computer"),body_license_front:(0,a.localize)("Upload front of license from your computer"),body_passport:(0,a.localize)("Upload passport photo page from your computer"),body_selfie:(0,a.localize)("Upload a selfie from your computer"),body_tax_letter:(0,a.localize)("Provide the whole document page for best results"),button_take_photo:(0,a.localize)("Take photo"),button_upload:(0,a.localize)("Upload"),title_selfie:(0,a.localize)("Selfie")},selfie_capture:{alert:{camera_inactive:{detail:(0,a.localize)("Check that it is connected and functional. You can also <fallback>continue verification on your phone</fallback>"),detail_no_fallback:(0,a.localize)("Make sure your device has a working camera"),title:(0,a.localize)("Camera not working?")},camera_not_working:{detail:(0,a.localize)("It may be disconnected. <fallback>Try using your phone instead</fallback>."),detail_no_fallback:(0,a.localize)("Make sure your device's camera works"),title:(0,a.localize)("Camera not working")},timeout:{detail:(0,a.localize)("Remember to press stop when you're done. <fallback>Redo video actions</fallback>"),title:(0,a.localize)("Looks like you took too long")}},button_accessibility:(0,a.localize)("Take a photo"),frame_accessibility:(0,a.localize)("View from camera"),title:(0,a.localize)("Take a selfie")},selfie_confirmation:{image_accessibility:(0,a.localize)("Photo of your face"),subtitle:(0,a.localize)("Make sure your selfie clearly shows your face"),title:(0,a.localize)("Check selfie")},selfie_intro:{button_primary:(0,a.localize)("Continue"),list_accessibility:(0,a.localize)("Tips to take a good selfie"),list_item_face_forward:(0,a.localize)("Face forward and make sure your eyes are clearly visible"),list_item_no_glasses:(0,a.localize)("Remove your glasses, if necessary"),subtitle:(0,a.localize)("We'll compare it with your document"),title:(0,a.localize)("Take a selfie")},sms_sent:{info:(0,a.localize)("Tips"),info_link_expire:(0,a.localize)("Your link will expire in one hour"),info_link_window:(0,a.localize)("Keep this window open while using your mobile"),link:(0,a.localize)("Resend link"),subtitle:(0,a.localize)("We've sent a secure link to %{number}"),subtitle_minutes:(0,a.localize)("It may take a few minutes to arrive"),title:(0,a.localize)("Check your mobile")},switch_phone:{info:(0,a.localize)("Tips"),info_link_expire:(0,a.localize)("Your mobile link will expire in one hour"),info_link_refresh:(0,a.localize)("Don't refresh this page"),info_link_window:(0,a.localize)("Keep this window open while using your mobile"),link:(0,a.localize)("Cancel"),subtitle:(0,a.localize)("Once you've finished we'll take you to the next step"),title:(0,a.localize)("Connected to your mobile")},upload_guide:{button_primary:(0,a.localize)("Upload photo"),image_detail_blur_alt:(0,a.localize)("Example of a blurry document"),image_detail_blur_label:(0,a.localize)("All details must be clear — nothing blurry"),image_detail_cutoff_alt:(0,a.localize)("Example of a cut-off document"),image_detail_cutoff_label:(0,a.localize)("Show all details — including the bottom 2 lines"),image_detail_glare_alt:(0,a.localize)("Example of a document with glare"),image_detail_glare_label:(0,a.localize)("Move away from direct light — no glare"),image_detail_good_alt:(0,a.localize)("Document example"),image_detail_good_label:(0,a.localize)("The photo should clearly show your document"),subtitle:(0,a.localize)("Scans and photocopies are not accepted"),title:(0,a.localize)("Upload passport photo page")}}),s={ID:"id_ID",EN:"en_US"}},"./Helpers/utils.tsx":(e,t,i)=>{i.d(t,{aZ:()=>z,IW:()=>w,E0:()=>T,_c:()=>m,UC:()=>d,mQ:()=>x,xy:()=>k,hf:()=>S,dC:()=>b,Zy:()=>y,k4:()=>g,dS:()=>p,GQ:()=>v,tb:()=>I,Di:()=>f,bu:()=>_,DY:()=>j,tf:()=>N,yS:()=>h,RC:()=>C});var a=i("../../../node_modules/i18n-iso-countries/index.js"),o=i("@deriv/shared"),s=i("@deriv-com/translations"),n=i("@deriv/translations");var r=i("./Constants/onfido.js");const l=[{regex_string:"^(?i)G[a-zA-Z0-9]{7,9}$",value:"^G[a-zA-Z0-9]{7,9}$",flags:"i"}],c=(0,o.getIDVNotApplicableOption)(),d=(e,t)=>{const i={new_display_name:"",example_format:""},a=(e=>({ke:{alien_card:{new_display_name:"",example_format:"123456"},national_id:{new_display_name:"",example_format:"12345678"},passport:{new_display_name:"",example_format:"A12345678"}},za:{national_id:{new_display_name:(0,n.localize)("National ID"),example_format:"1234567890123"},national_id_no_photo:{new_display_name:(0,n.localize)("National ID (No Photo)"),example_format:"1234567890123"}},ng:{bvn:{new_display_name:(0,n.localize)("Bank Verification Number"),example_format:"12345678901"},cac:{new_display_name:(0,n.localize)("Corporate Affairs Commission"),example_format:"12345678"},drivers_license:{new_display_name:"",example_format:"ABC123456789"},nin:{new_display_name:(0,n.localize)("National Identity Number"),example_format:"12345678901"},nin_slip:{new_display_name:(0,n.localize)("National Identity Number Slip"),example_format:"12345678901"},tin:{new_display_name:(0,n.localize)("Taxpayer identification number"),example_format:"12345678-1234"},voter_id:{new_display_name:(0,n.localize)("Voter ID"),example_format:"1234567890123456789"}},gh:{drivers_license:{new_display_name:"",example_format:"B1234567"},national_id:{new_display_name:(0,n.localize)("National ID"),example_format:"GHA-123456789-1"},passport:{new_display_name:(0,n.localize)("Passport"),example_format:"G1234567"},ssnit:{new_display_name:(0,n.localize)("Social Security and National Insurance Trust"),example_format:"C123456789012"},voter_id:{new_display_name:(0,n.localize)("Voter ID"),example_format:"01234567890"}},br:{cpf:{new_display_name:(0,n.localize)("CPF"),example_format:"123.456.789-12"}},ug:{national_id:{new_display_name:(0,n.localize)("National ID"),example_format:"CM12345678PE1D"},national_id_no_photo:{new_display_name:(0,n.localize)("National ID (No Photo)"),example_format:"CM12345678PE1D",additional_document_example_format:"0123456789"}},zw:{national_id:{new_display_name:(0,n.localize)("National ID"),example_format:"081234567F53"}},cl:{national_id:{example_format:"123456789"}},ar:{dni:{example_format:"12345678"}},mx:{curp:{example_format:"ABCD123456HEFGIJ00"}},id:{nik:{example_format:"1234567890123456"}},in:{aadhaar:{example_format:"123456789012",additional_document_example_format:"ABCDE1234F"},drivers_license:{example_format:"AB1234567890123"},epic:{example_format:"ABC1234567"},pan:{example_format:"ABCDE1234F"},passport:{example_format:"A1234567",additional_document_example_format:"AB1234567890123"}},pe:{national_id:{example_format:"12345678"}},vn:{national_id:{example_format:"12345678901"}}}[e]))(e);return a?a[t]??i:i},_=e=>{0===(e.clipboardData??window.clipboardData).getData("text").length&&e.preventDefault()},u=e=>{const t=l.find((t=>t.regex_string===e));return t?new RegExp(t.value,t.flags):new RegExp(e)},m=e=>{switch(e){case"drivers_license":return(0,s.localize)("Enter Driver License Reference number");case"ssnit":return(0,s.localize)("Enter your SSNIT number");case"national_id_no_photo":return(0,s.localize)("Enter your National Identification Number (NIN)");default:return(0,s.localize)("Enter your document number")}},p=function(e){return!(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).includes(e)},f=(e,t)=>{const i=(0,o.filterObjProperties)(e,t);return i.first_name&&(i.first_name=i.first_name.trim()),i.last_name&&(i.last_name=i.last_name.trim()),i.date_of_birth&&(i.date_of_birth=(0,o.toMoment)(i.date_of_birth).format("YYYY-MM-DD")),i},h=e=>{if(e){if(!(0,o.validLength)(e.trim(),{min:1,max:50}))return(0,s.localize)("Enter no more than 50 characters.");if(!(0,o.validName)(e))return(0,s.localize)("Letters, spaces, periods, hyphens, apostrophes only.")}return""},x=e=>e?(0,s.localize)("Example: ")+e:"",g=e=>{if(!e?.text)return(0,s.localize)("Please select a document type.")},b=(e,t)=>{const i=((e,t)=>{let i=null;return e?u(t?.format).test(e)||(i=(0,s.localize)("Please enter the correct format. ")):i=(0,s.localize)("Please enter your {{document_name}}. ",{document_name:t?.display_name?.toLowerCase()??(0,s.localize)("document number")}),i})(t,e?.additional);if(i)return i+x(e?.additional?.example_format)},y=(e,t)=>{const i=e===t?.example_format;if(!e&&t?.text){let e="";const i=x(t.example_format);switch(t.id){case"drivers_license":e=(0,s.localize)("Driver License Reference number");break;case"ssnit":e=(0,s.localize)("SSNIT number");break;case"national_id_no_photo":e=(0,s.localize)("NIN");break;default:e=(0,s.localize)("document number")}return(0,s.localize)("Please enter your {{document_name}}. {{example_format}}",{document_name:e,example_format:i})}if(i)return(0,s.localize)("Please enter a valid ID number.");const a=u(t?.value);return e&&!a.test(e)?(0,s.localize)("Please enter the correct format. ")+x(t?.example_format):void 0},j=e=>e===c.id,v=e=>"object"==typeof e&&null!==e&&"code"in e,z=e=>3!==e.length?a.alpha2ToAlpha3(e.toUpperCase()):e,w=e=>2!==e.length?a.alpha3ToAlpha2(e.toUpperCase()):e,S=e=>{try{const t=e.toLowerCase().split("_");return"id"===t[0]?r.u.ID:t.length>1?`${t[0]}_${t[1].toUpperCase()}`:t[0]}catch(e){return r.u.EN}},k=(e,t)=>{if(!e||!Object.keys(t).length)return(0,s.localize)("identity document");const{document_type:i}=e;if(!i)return(0,s.localize)("identity document");if(t?.identity?.services?.idv?.documents_supported){const{identity:{services:{idv:{documents_supported:e}}}}=t;return e[i].display_name}return null},N=(e,t)=>(i,a,o)=>{a.forEach((a=>{const s=t[a];i(s)||e[a]||(e[a]=o)}))},C=e=>{switch(e){case o.IDV_ERROR_STATUS.DobMismatch.code:return["date_of_birth"];case o.IDV_ERROR_STATUS.NameMismatch.code:return["first_name","last_name"];default:return["first_name","last_name","date_of_birth"]}},I=e=>["IcOnlineNaira","IcAstroPayLight","IcAstroPayDark"].some((t=>t===e)),T=e=>e===o.VERIFICATION_SERVICES.SMS?e.toUpperCase():"WhatsApp"}}]);