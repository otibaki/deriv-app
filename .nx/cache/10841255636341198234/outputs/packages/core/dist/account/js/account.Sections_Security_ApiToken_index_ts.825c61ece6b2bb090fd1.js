"use strict";(self.webpackChunk_deriv_account=self.webpackChunk_deriv_account||[]).push([["Sections_Security_ApiToken_index_ts"],{"./Components/article/index.ts":(e,t,s)=>{s.d(t,{A:()=>r});var a=s("react"),n=s("@deriv/components"),i=s("@deriv-com/translations"),o=s("../../../node_modules/clsx/dist/clsx.mjs"),l=s("../../../node_modules/react/jsx-runtime.js");const r=e=>{let{title:t,descriptions:s,onClickLearnMore:r,className:c}=e;const d=s?.length>0,_=1===s?.length;return(0,l.jsxs)("article",{className:(0,o.A)("da-article",c),children:[(0,l.jsx)(n.Text,{as:"h4",color:"prominent",line_height:"m",size:"xs",weight:"bold",className:"da-article__header",children:t}),d&&(0,l.jsx)(a.Fragment,{children:_?(0,l.jsx)(n.Text,{as:"p",size:"xxs",line_height:"m",children:s[0]}):(0,l.jsx)("ul",{className:"da-article__list",children:s.map(((e,t)=>(0,l.jsx)("li",{children:(0,l.jsx)(n.Text,{size:"xxs",line_height:"xs",children:e})},t)))})}),r&&(0,l.jsxs)("div",{className:"da-article__learn-more",onClick:r,children:[(0,l.jsx)(n.Text,{size:"xxs",color:"loss-danger",line_height:"s",children:(0,l.jsx)(i.Localize,{i18n_default_text:"Learn more"})}),(0,l.jsx)(n.Icon,{icon:"IcChevronRight",className:"da-article__learn-more-icon",color:"red"})]})]})}},"./Sections/Security/ApiToken/index.ts":(e,t,s)=>{s.r(t),s.d(t,{default:()=>I});var a=s("react"),n=s("../../../node_modules/clsx/dist/clsx.mjs"),i=s("formik"),o=s("@deriv/components"),l=s("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),r=s("@deriv/shared"),c=s("@deriv/stores"),d=s("@deriv-com/translations"),_=s("./Components/article/index.ts"),x=s("../../../node_modules/react/jsx-runtime.js");const m=()=>(0,x.jsx)(_.A,{title:(0,x.jsx)(d.Localize,{i18n_default_text:"API token"}),descriptions:[(0,x.jsx)(d.Localize,{i18n_default_text:"To access your mobile apps and other third-party apps, you'll first need to generate an API token."},0)]}),p=e=>{let{name:t,display_name:s,description:a,children:n}=e;return(0,x.jsx)(i.Field,{name:t,children:e=>{let{field:i,form:{setFieldValue:l}}=e;return(0,x.jsx)(o.CompositeCheckbox,{...i,onChange:()=>l(t,!i.value),className:"api-token__checkbox",label:s,description:a,children:n})}})},u=e=>{let{message:t}=e;return(0,x.jsxs)("div",{className:"da-api-token__bullet-wrapper",children:[(0,x.jsx)("div",{className:"da-api-token__bullet"}),(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:t})]})},h=()=>(0,x.jsxs)(a.Fragment,{children:[(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Be careful who you share this token with. Anyone with this token can perform the following actions on your account behalf"})}),(0,x.jsxs)("div",{className:"da-api-token__bullet-container",children:[(0,x.jsx)(u,{message:(0,x.jsx)(d.Localize,{i18n_default_text:"Add accounts"})}),(0,x.jsx)(u,{message:(0,x.jsx)(d.Localize,{i18n_default_text:"Create or delete API tokens for trading and withdrawals"})}),(0,x.jsx)(u,{message:(0,x.jsx)(d.Localize,{i18n_default_text:"Modify account settings"})})]})]}),j=e=>{let{scopes:t,text_copy:s,info_message:n,success_message:i,popover_alignment:l="bottom"}=e;const[c,_,m]=(0,o.useCopyToClipboard)(),[p,u]=(0,a.useState)(!1),[j,k]=(0,a.useState)(!1),g=(0,r.useIsMounted)();let f,y;const b=t?.includes("Admin"),v=()=>{u(!1),_(s??""),k(!0),f=setTimeout((()=>{g()&&(k(!1),m(!1))}),1900),y=setTimeout((()=>{g()&&m(!1)}),2050)};return(0,a.useEffect)((()=>()=>{clearTimeout(f),clearTimeout(y)}),[f,y]),(0,x.jsxs)(a.Fragment,{children:[(0,x.jsxs)(o.Modal,{is_open:p,small:!0,children:[(0,x.jsx)(o.Modal.Body,{children:(0,x.jsx)(h,{})}),(0,x.jsx)(o.Modal.Footer,{className:"da-api-token__modal-footer",children:(0,x.jsx)(o.Button,{className:"dc-dialog__button",has_effect:!0,onClick:v,primary:!0,large:!0,children:(0,x.jsx)(d.Localize,{i18n_default_text:"OK"})})})]}),(0,x.jsx)(o.Popover,{alignment:l,classNameBubble:"dc-clipboard__popover",message:c?i:n,is_open:j,zIndex:"9999",children:(0,x.jsx)(o.Icon,{icon:c?"IcCheckmarkCircle":"IcClipboard",custom_color:c?"var(--status-success)":"var(--text-prominent)",className:"dc-clipboard",size:14,data_testid:c?"dt_token_copied_icon":"dt_copy_token_icon",onClick:()=>{b?u(!0):v()},onMouseEnter:()=>{c||k(!0)},onMouseLeave:()=>{c||k(!1)}})})]})},k=(0,a.createContext)({api_tokens:[],deleteToken:()=>Promise.resolve()}),g=e=>{let{token:t,popover_alignment:s="left"}=e;const{isDesktop:n}=(0,l.Y)(),{deleteToken:i}=(0,a.useContext)(k),[c,_]=(0,a.useState)(!1),[m,p]=(0,a.useState)(!1),[u,h]=(0,a.useState)(!1),j=(0,r.useIsMounted)();return(0,x.jsxs)(a.Fragment,{children:[(0,x.jsxs)(o.Modal,{is_open:c,small:!0,children:[(0,x.jsxs)(o.Modal.Body,{children:[(0,x.jsx)(o.Text,{as:"h1",color:"prominent",weight:"bold",className:"da-api-token__modal-title",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Delete token"})}),(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Are you sure you want to delete this token?"})})]}),(0,x.jsxs)(o.Modal.Footer,{className:"da-api-token__modal-footer",children:[(0,x.jsx)(o.Button,{className:"dc-dialog__button",has_effect:!0,onClick:()=>_(!1),secondary:!0,large:!0,children:(0,x.jsx)(d.Localize,{i18n_default_text:"Cancel"})}),(0,x.jsx)(o.Button,{className:"dc-dialog__button",has_effect:!0,onClick:async()=>{p(!0),await i(t.token??""),j()&&(p(!1),_(!1))},primary:!0,large:!0,is_loading:m,children:(0,x.jsx)(d.Localize,{i18n_default_text:"Yes, delete"})})]})]}),(0,x.jsx)(o.Popover,{alignment:s,classNameBubble:"dc-clipboard__popover",message:(0,x.jsx)(d.Localize,{i18n_default_text:"Delete this token"}),relative_render:!1,zIndex:"9999",is_open:u,children:(0,x.jsx)(o.Icon,{icon:"IcDelete",custom_color:"var(--text-prominent)",className:"dc-clipboard da-api-token__delete-icon",onClick:()=>{n&&h(!1),_(!0)},size:14,data_testid:"dt_token_delete_icon",onMouseEnter:()=>{!c&&n&&h(!0)},onMouseLeave:()=>{!c&&n&&h(!1)}})})]})},f=e=>{let{className:t,children:s,should_bypass_text:a}=e;return a?(0,x.jsx)("td",{className:(0,n.A)("da-api-token__table-cell",t),children:s}):(0,x.jsx)("td",{className:(0,n.A)("da-api-token__table-cell",t),children:(0,x.jsx)(o.Text,{color:"prominent ",size:"xs",line_height:"m",children:s})})},y=e=>{let{text:t}=e;return(0,x.jsx)("th",{className:"da-api-token__table-header",children:(0,x.jsx)(o.Text,{color:"prominent ",size:"xs",line_height:"m",weight:"bold",children:t})})},b=()=>(0,x.jsx)("div",{"data-testid":"dt_hidden_tokens",className:"da-api-token__pass-dot-container",children:Array.from(Array(15).keys()).map((e=>(0,x.jsx)("div",{className:"da-api-token__pass-dot"},e)))}),v=e=>{let{token:t,scopes:s}=e;const[n,i]=(0,a.useState)(!1);return(0,x.jsxs)("div",{className:"da-api-token__clipboard-wrapper",children:[n?(0,x.jsx)(o.Text,{as:"p",color:"prominent ",size:"xs",line_height:"m",children:t}):(0,x.jsx)(b,{}),(0,x.jsx)(j,{info_message:(0,x.jsx)(d.Localize,{i18n_default_text:"Copy this token"}),success_message:(0,x.jsx)(d.Localize,{i18n_default_text:"Token copied!"}),text_copy:t,scopes:s}),(0,x.jsx)(o.Popover,{alignment:"bottom",classNameBubble:"dc-clipboard__popover",message:n?(0,x.jsx)(d.Localize,{i18n_default_text:"Hide this token"}):(0,x.jsx)(d.Localize,{i18n_default_text:"Show this token"}),children:(0,x.jsx)(o.Icon,{icon:n?"IcPasswordEyeVisible":"IcPasswordEyeHide",className:"da-api-token__visibility-icon",onClick:()=>{i((e=>!e))},width:15,custom_color:"var(--text-prominent)",data_testid:"dt_toggle_visibility_icon"})})]})},z=e=>{let{scopes:t}=e;return(0,x.jsx)("div",{className:"da-api-token__table-scopes-cell-block",children:t?.map((e=>(0,x.jsx)("div",{className:(0,n.A)("da-api-token__table-scope-cell",{"da-api-token__table-scope-cell-admin":"admin"===e.toLowerCase()}),children:e},e)))})},T=e=>{let{token:t}=e;return(0,x.jsxs)("tr",{className:"da-api-token__table-cell-row",children:[(0,x.jsx)(f,{className:"da-api-token__table-cell--name",children:t.display_name}),(0,x.jsx)(f,{should_bypass_text:!0,children:(0,x.jsx)(v,{token:t.token,scopes:t.formatted_scopes})}),(0,x.jsx)(f,{should_bypass_text:!0,children:(0,x.jsx)(z,{scopes:t.formatted_scopes})}),(0,x.jsx)(f,{children:t.last_used}),(0,x.jsx)(f,{should_bypass_text:!0,children:(0,x.jsx)(g,{token:t})})]})},N=()=>{const{api_tokens:e}=(0,a.useContext)(k),{isDesktop:t}=(0,l.Y)(),{localize:s}=(0,d.useTranslations)(),n=e=>{const t=e?.scopes?.map((e=>(e=>{switch(e){case"read":return s("Read");case"trade":return s("Trade");case"payments":return s("Payments");case"admin":return s("Admin");case"trading_information":return s("Trading information");default:return(e=>{const t=e.replace(/[-_]/g," ");return t[0].toUpperCase()+t.slice(1).toLowerCase()})(e)}})(e))),a=e?.last_used?(0,r.formatDate)(e.last_used,"DD/MM/YYYY"):s("Never");return{display_name:e.display_name,formatted_scopes:t??[],last_used:a,token:e.token}};return t?(0,x.jsxs)("table",{className:"da-api-token__table",children:[(0,x.jsx)("thead",{children:(0,x.jsxs)("tr",{className:"da-api-token__table-header-row",children:[(0,x.jsx)(y,{text:s("Name")}),(0,x.jsx)(y,{text:s("Token")}),(0,x.jsx)(y,{text:s("Scopes")}),(0,x.jsx)(y,{text:s("Last used")}),(0,x.jsx)("th",{})]})}),(0,x.jsx)("tbody",{children:e?.map((e=>(0,x.jsx)(T,{token:n(e)},e?.token)))})]}):(0,x.jsx)(a.Fragment,{children:e?.map((e=>{const t=n(e);return(0,x.jsxs)("div",{className:"da-api-token__scope",children:[(0,x.jsx)("div",{className:"da-api-token__scope-item",children:(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Name"})}),(0,x.jsx)(o.Text,{className:"da-api-token__scope-item--name",as:"p",size:"s",color:"general",line_height:"m",children:t.display_name})]})}),(0,x.jsxs)("div",{className:"da-api-token__scope-item",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Token"})}),(0,x.jsx)(v,{token:t.token,scopes:t.formatted_scopes})]}),(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Last Used"})}),(0,x.jsx)(o.Text,{as:"p",size:"s",color:"general",line_height:"m",children:t.last_used})]})]}),(0,x.jsxs)("div",{className:"da-api-token__scope-item",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)(o.Text,{as:"h5",size:"xxs",color:"general",line_height:"xs",weight:"bold",children:(0,x.jsx)(d.Localize,{i18n_default_text:"Scopes"})}),(0,x.jsx)(z,{scopes:t.formatted_scopes})]}),(0,x.jsx)("div",{children:(0,x.jsx)(g,{token:t})})]})]},t.token)}))})};var w=s("./Components/inline-note-with-icon/index.ts"),L=s("./Components/load-error-message/index.ts");const C=[{name:"read",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Read"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to view your account activity, settings, limits, balance sheets, trade purchase history, and more."})},{name:"trade",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Trade"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to buy and sell contracts for you, renew your expired purchases, and top up your demo accounts."})},{name:"payments",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Payments"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to withdraw to payment agents and make inter-account transfers for you."})},{name:"trading_information",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Trading information"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to view your trading history."})},{name:"admin",display_name:(0,x.jsx)(d.Localize,{i18n_default_text:"Admin"}),description:(0,x.jsx)(d.Localize,{i18n_default_text:"This scope will allow third-party apps to open accounts for you, manage your settings and token usage, and more. "})}],A=/^[A-Za-z0-9\s_]+$/,I=(0,c.observer)((()=>{const{client:e}=(0,c.useStore)(),{is_switching:t}=e,s=(0,a.useRef)(t),{isDesktop:_}=(0,l.Y)(),{localize:u}=(0,d.useTranslations)(),[h,j]=(0,a.useReducer)(((e,t)=>({...e,...t})),{api_tokens:[],is_loading:!0,is_success:!1,error_message:"",show_delete:!1,is_delete_loading:!1,is_delete_success:!1}),g=(0,a.useRef)(),f=(0,a.useRef)();(0,a.useEffect)((()=>(v(),()=>{clearTimeout(g.current),clearTimeout(f.current)})),[]),(0,a.useEffect)((()=>{s.current!==t&&(s.current=t,v())}),[t]);const y=e=>Object.keys(e).filter((t=>"token_name"!==t&&Boolean(e[t]))),b=e=>{e.error?j({is_loading:!1,error_message:(0,r.getPropertyValue)(e,["error","message"])}):j({is_loading:!1,api_tokens:(0,r.getPropertyValue)(e,["api_token","tokens"])})},v=async()=>{j({is_loading:!0});const e=await r.WS.authorized.apiToken({api_token:1});b(e)},{api_tokens:z,is_loading:T,is_success:I,error_message:M}=h;if(T||t)return(0,x.jsx)(o.Loading,{is_fullscreen:!1,className:"account__initial-loader"});if(M)return(0,x.jsx)(L.A,{error_message:M});if(void 0===z)return null;const S={api_tokens:z,deleteToken:async e=>{j({is_delete_loading:!0});const t=await r.WS.authorized.apiToken({api_token:1,delete_token:e});b(t),j({is_delete_loading:!1,is_delete_success:!0}),f.current=setTimeout((()=>{j({is_delete_success:!1})}),500)}};return(0,x.jsx)(k.Provider,{value:S,children:(0,x.jsx)("section",{className:"da-api-token",children:(0,x.jsxs)("div",{className:"da-api-token__wrapper",children:[(0,x.jsxs)(o.ThemedScrollbars,{className:"da-api-token__scrollbars",is_bypassed:!_,children:[!_&&(0,x.jsx)(m,{}),(0,x.jsx)(i.Formik,{initialValues:{token_name:"",read:!1,trade:!1,payments:!1,trading_information:!1,admin:!1},onSubmit:async(e,t)=>{let{setSubmitting:s,setFieldError:a,resetForm:n}=t;const i=await r.WS.apiToken({api_token:1,new_token:e.token_name,new_token_scopes:y(e)});i.error?a("token_name",i.error.message):(j({is_success:!0,api_tokens:(0,r.getPropertyValue)(i,["api_token","tokens"])}),g.current=setTimeout((()=>{j({is_success:!1})}),500)),n(),s(!1)},validate:e=>{const t={},s=e?.token_name?.trim();return s?A.test(s)?s.length<2?t.token_name=u("Length of token name must be between {{MIN_TOKEN}} and {{MAX_TOKEN}} characters.",{MIN_TOKEN:2,MAX_TOKEN:32}):s.length>32&&(t.token_name=u("Maximum {{MAX_TOKEN}} characters.",{MAX_TOKEN:32})):t.token_name=u("Only letters, numbers, and underscores are allowed."):t.token_name=u("Please enter a token name."),t},children:e=>{let{values:t,errors:s,isValid:a,dirty:l,touched:r,handleChange:c,handleBlur:_,isSubmitting:m,setFieldTouched:h}=e;return(0,x.jsx)(i.Form,{noValidate:!0,children:(0,x.jsxs)(o.Timeline,{className:"da-api-token__timeline",line_height:"xxxl",children:[(0,x.jsx)(o.Timeline.Item,{item_title:(0,x.jsx)(d.Localize,{i18n_default_text:"Select scopes based on the access you need."}),children:(0,x.jsx)("div",{className:"da-api-token__checkbox-wrapper",children:C.map((e=>(0,x.jsx)(p,{name:e.name,display_name:e.display_name,description:e.description,children:"admin"===e.name&&(0,x.jsx)(w.A,{icon:"IcAlertWarning",message:(0,x.jsx)(d.Localize,{i18n_default_text:"To avoid loss of funds, do not share tokens with the Admin scope with unauthorised parties."}),title:(0,x.jsx)(d.Localize,{i18n_default_text:"Note:"})})},e.name)))})}),(0,x.jsx)(o.Timeline.Item,{item_title:(0,x.jsx)(d.Localize,{i18n_default_text:"Name your token and click on 'Create' to generate your token."}),children:(0,x.jsxs)("div",{className:"da-api-token__input-group",children:[(0,x.jsx)(i.Field,{name:"token_name",children:e=>{let{field:a}=e;return(0,x.jsx)(o.Input,{...a,"data-lpignore":"true",type:"text",className:"da-api-token__input dc-input__input-group",label:u("Token name"),value:t.token_name,onChange:e=>{h("token_name",!0),c(e)},onBlur:_,hint:(0,x.jsx)(d.Localize,{i18n_default_text:"Length of token name must be between 2 and 32 characters."}),required:!0,error:r.token_name&&s.token_name?s.token_name:void 0})}}),(0,x.jsx)(o.Button,{className:(0,n.A)("dc-btn__button-group","da-api-token__button",{"da-api-token__button--success":I}),type:"submit",is_disabled:!l||m||!a||!y(t).length,has_effect:!0,is_loading:m,is_submit_success:I,primary:!0,large:!0,children:(0,x.jsx)(d.Localize,{i18n_default_text:"Create"})})]})}),(0,x.jsx)(o.Timeline.Item,{item_title:(0,x.jsx)(d.Localize,{i18n_default_text:"Copy and paste the token into the app."}),children:(0,x.jsx)(N,{})})]})})}})]}),_&&(0,x.jsx)(m,{})]})})})}))}}]);