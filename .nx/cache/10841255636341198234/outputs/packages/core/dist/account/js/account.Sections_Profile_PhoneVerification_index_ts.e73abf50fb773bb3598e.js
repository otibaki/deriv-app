"use strict";(self.webpackChunk_deriv_account=self.webpackChunk_deriv_account||[]).push([["Sections_Profile_PhoneVerification_index_ts"],{"./Sections/Profile/PhoneVerification/index.ts":(e,t,i)=>{i.r(t),i.d(t,{default:()=>J});var o=i("react"),n=i.n(o),a=i("react-router-dom"),s=i("@deriv/components"),r=i("@deriv/hooks"),l=i("@deriv/quill-icons"),c=i("@deriv/shared"),d=i("@deriv/stores"),_=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Button/icon-button/index.js"),u=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Typography/text/index.js"),h=i("../../../node_modules/@deriv-com/ui/dist/hooks/useDevice.js"),m=i("@deriv-com/translations"),p=i("../../../node_modules/clsx/dist/clsx.mjs"),f=i("../../../node_modules/@deriv-com/quill-ui/dist/snackbar-controller-ChcV5SXl.js"),v=i("../../../node_modules/@deriv-com/quill-ui/dist/jsx-runtime-DmTjM30f.js"),b=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Input/base/index.js"),x=i("../../../node_modules/@deriv-com/quill-ui/dist/clsx-OuTLNxxd.js");const j=(0,o.forwardRef)((({addOnPosition:e="left",variant:t="outline",fillAddonBorderColor:i,rightIcon:o,addonLabel:n,inputSize:a="lg",disabled:s,...r},l)=>{const c="fill"===t?{borderColor:i}:{},d=v.j.jsx("div",{className:(0,x.c)("quill-addon",`quill-addon__position--${e}`,`quill-addon__position--${e}--${t}`,`quill-addon__variant--${t}`),style:c,children:v.j.jsx(u.E,{size:"lg"===a?"md":a,className:(0,x.c)(s&&"quill-addon__label--disabled"),children:n})}),_=v.j.jsx("span",{className:"icon_wrapper",children:o});return v.j.jsx(b.A,{addOn:d,disabled:s,addOnIcon:_,variant:t,inputSize:a,ref:l,...r})}));var g=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Button/base/index.js"),w=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Snackbar/snackbar.js"),E=i("../../../node_modules/yup/es/index.js"),S=i("@deriv-com/utils");const y=/^[0-9]{5,15}$/,C=(e,t,i,o)=>{(e=>E.Yj().matches(e?y:S.ValidationConstants.patterns.phoneNumber,(0,m.localize)("Enter a valid phone number.")))(o).validate(e).then((()=>{t(""),i(!1)})).catch((e=>{let{errors:o}=e;t(o),i(!0)}))};var I=i("../../../node_modules/react/jsx-runtime.js");const M=(0,d.observer)((e=>{let{show_confirm_phone_number:t,setOtpVerification:i}=e;const[n,a]=(0,o.useState)(""),[s,l]=(0,o.useState)(""),[_]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"enable_country_code_dropdown"}),[h,v]=(0,o.useState)(!1),{requestOnSMS:b,requestOnWhatsApp:x,error_message:E,setErrorMessage:S,setUsersPhoneNumber:y,is_email_verified:M,email_otp_error:V,is_disabled_request_button:P,setIsDisabledRequestButton:O}=(0,r.useRequestPhoneNumberOTP)(),{is_global_sms_available:z,is_global_whatsapp_available:N,no_of_available_carriers:L,formatted_countries_list:k,short_code_selected:T,selected_phone_code:A,selected_country_list:B,isLoading:R}=(0,r.useGetPhoneNumberList)(),{data:q,invalidate:F}=(0,r.useSettings)(),[$,H]=(0,o.useState)(),{ui:G}=(0,d.useStore)(),{setShouldShowPhoneNumberOTP:D}=G,{next_phone_otp_request_timer:W,is_phone_otp_timer_loading:Y}=(0,r.usePhoneNumberVerificationSetTimer)(!0),{trackPhoneVerificationEvents:K}=(0,r.usePhoneVerificationAnalytics)(),{localize:U}=(0,m.useTranslations)(),X=1===L;(0,o.useEffect)((()=>{t&&K({action:"open",subform_name:"verify_phone_screen"})}),[t,K]),(0,o.useEffect)((()=>{a(q?.phone?.replace(/\D/g,"")||"")}),[q?.phone]),(0,o.useEffect)((()=>{V&&(K({action:"error",subform_name:"verify_phone_screen",error_code:V.code}),F("get_settings").then((()=>v(!1)))),M&&(v(!1),i({show_otp_verification:!0,phone_verification_type:s}),D(!0))}),[M,V,F,K]);const J=e=>{a(e.target.value),C(_?e.target.value:`+${e.target.value}`,S,O,!!_)},Q=async e=>{v(!0),l(e);const{error:t}=await y({phone:_?n:`+${n}`,..._?{calling_country_code:$?.phone_code||A}:{}});t?v(!1):(K({action:"click_cta",cta_name:e===c.VERIFICATION_SERVICES.SMS?"Get code via SMS":"Get code via WhatsApp",subform_name:"verify_phone_screen"}),e===c.VERIFICATION_SERVICES.SMS?b():x())},Z=e=>1===e,ee=!_||($?$?.carriers.includes("sms")&&z:B?.carriers.includes("sms")&&z),te=!_||($?$?.carriers.includes("whatsapp")&&N:B?.carriers.includes("whatsapp")&&N);return(0,I.jsxs)(o.Fragment,{children:[(0,I.jsx)(u.E,{bold:!0,children:(0,I.jsx)(m.Localize,{i18n_default_text:"Step 2 of 3: Confirm your phone number"})}),(0,I.jsx)("div",{className:(0,p.A)("phone-verification__card--inputfield",{"phone-verification__card--inputfield--error":E}),children:_?k&&!R&&(0,I.jsx)(f.b,{showSearchBar:!0,codeIcon:!1,countryCodes:k,codeLabel:U("Code"),shortCode:$?.short_code||T,onCodeChange:e=>{H(e)},value:n,showFlags:!1,label:U("Phone number"),onChange:J,status:E?"error":"neutral",message:E}):(0,I.jsx)(j,{type:"number",label:U("Phone number"),value:n,status:E?"error":"neutral",message:E,className:"phone-verification__card--inputfield__phone-number-input",onChange:J,addonLabel:"+"})}),(0,I.jsxs)("div",{className:(0,p.A)("phone-verification__card--buttons_container",{"phone-verification__card--buttons_container--with-1-carrier":X}),children:[(!_||ee)&&!R&&(0,I.jsx)(g.$n,{variant:_?te?"secondary":"primary":"secondary",color:_?te?"black-white":"coral":"black-white",fullWidth:!_||te,size:"lg",onClick:()=>Q(c.VERIFICATION_SERVICES.SMS),disabled:h||!!W||P||Y,children:(0,I.jsx)(u.E,{color:_?te?"black":"white":"black",bold:!0,children:(0,I.jsx)(m.Localize,{i18n_default_text:"Get code via SMS"})})}),(!_||te)&&!R&&(0,I.jsx)(g.$n,{color:"coral",fullWidth:!_||ee,size:"lg",onClick:()=>Q(c.VERIFICATION_SERVICES.WHATSAPP),disabled:h||!!W||P||Y,children:(0,I.jsx)(u.E,{color:"white",bold:!0,children:(0,I.jsx)(m.Localize,{i18n_default_text:"Get code via WhatsApp"})})})]}),(0,I.jsx)(w.q,{hasCloseButton:!1,message:(0,I.jsx)(m.Localize,{i18n_default_text:"Request new code in {{next_phone_number_attempt_timestamp}}.",values:{next_phone_number_attempt_timestamp:(()=>{let e="";return e=W?W<60?`${W} ${Z(W)?U("second"):U("seconds")}`:`${Math.round(W/60)} ${Z(Math.round(W/60))?U("minute"):U("minutes")}`:"",e})()}}),isVisible:!!W})]})}));var V=i("react-router");const P=(0,d.observer)((()=>{const e=(0,V.useHistory)(),t=(0,V.useLocation)(),[i,n]=(0,o.useState)(!1),[a,s]=(0,o.useState)(t.pathname),{ui:l,client:c}=(0,d.useStore)(),{setShouldShowPhoneNumberOTP:_,is_forced_to_exit_pnv:p}=l,{setVerificationCode:v,is_virtual:b}=c,{isMobile:x}=(0,h.Y)(),{trackPhoneVerificationEvents:j}=(0,r.usePhoneVerificationAnalytics)(),{is_phone_number_verified:g}=(0,r.useIsPhoneNumberVerified)(),[w]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"phone_number_verification"});return(0,o.useEffect)((()=>{const t=e.block((e=>!(!(i||b||p||g)&&w&&(n(!0),s(e.pathname),1))));return()=>t()}),[e,i,b,p,g,w]),(0,I.jsxs)(f.M,{isMobile:x,showHandleBar:!0,isOpened:i,isNonExpandable:!0,shouldCloseModalOnSwipeDown:!0,shouldCloseOnPrimaryButtonClick:!0,primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Continue verification"}),buttonColor:"coral",showSecondaryButton:!0,showCrossIcon:!0,toggleModal:()=>{n(!1),s(t.pathname)},secondaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Cancel"}),secondaryButtonCallback:()=>{a&&(v("","phone_number_verification"),_(!1),n(!1),j({action:"back"}),e.push(a))},children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Cancel phone number verification?"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)("div",{className:"phone-verification__cancel-modal--contents",children:(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:"If you cancel, you'll lose all progress."})})})})]})}));var O=i("./Helpers/utils.tsx"),z=i("../../../node_modules/@deriv-com/quill-ui/dist/components/Typography/caption/index.js");const N=e=>{let{is_button_disabled:t,should_show_resend_code_button:i,clearOtpValue:a,setIsButtonDisabled:s,setShouldShowDidntGetTheCodeModal:l,reInitializeGetSettings:c}=e;const{sendPhoneNumberVerifyEmail:d,WS:_,error:u}=(0,r.useVerifyEmail)("phone_number_verification"),{is_request_button_disabled:h,next_email_otp_request_timer:p,next_phone_otp_request_timer:f}=(0,r.usePhoneNumberVerificationSetTimer)(),{localize:v}=(0,m.useTranslations)();n().useEffect((()=>{(_.isSuccess||u)&&c()}),[_.isSuccess,c,u]);const b=(0,o.useCallback)((()=>i?!!p||t:!!f||t||h),[i,p,f,t,h]);return(0,I.jsx)(g.$n,{variant:"tertiary",onClick:()=>{i?(a(),s(!0),d()):l(!0)},disabled:b(),color:"black",children:(0,I.jsx)(z.O,{bold:!0,underlined:!0,children:i?(0,I.jsx)(m.Localize,{i18n_default_text:"Resend code{{resendCode}}",values:{resendCode:(()=>{let e="";return e=p?p<60?`${v(" in ")}${p}s`:`${v(" in ")}${Math.round(p/60)}m`:"",e})()}}):(0,I.jsx)(m.Localize,{i18n_default_text:"Didn't get the code?{{resendCode}}",values:{resendCode:(()=>{let e="";return e=f?f<60?` (${f}s)`:` (${f&&Math.round(f/60)}m)`:"",e})()}})})})},L=e=>{let{should_show_didnt_get_the_code_modal:t,setShouldShowDidntGetTheCodeModal:i,setIsButtonDisabled:n,reInitializeGetSettings:a,requestOnSMS:s,requestOnWhatsApp:r,clearOtpValue:l,phone_verification_type:d,is_email_verified:_,email_otp_error:u,setOtpVerification:p}=e;const{isMobile:v}=(0,h.Y)(),{localize:b}=(0,m.useTranslations)();(0,o.useEffect)((()=>{(_||u)&&a()}),[_,u,a]);const x=()=>{n(!0)};return(0,I.jsx)(f.M,{isMobile:v,showHandleBar:!0,isOpened:t,isNonExpandable:!0,shouldCloseModalOnSwipeDown:!0,showSecondaryButton:!0,primaryButtonCallback:()=>{l(),x(),d===c.VERIFICATION_SERVICES.SMS?s():r(),p({show_otp_verification:!0,phone_verification_type:d}),i(!1)},secondaryButtonCallback:()=>{l(),x();const e=d===c.VERIFICATION_SERVICES.SMS?c.VERIFICATION_SERVICES.WHATSAPP:c.VERIFICATION_SERVICES.SMS;d===c.VERIFICATION_SERVICES.SMS?r():s(),p({show_otp_verification:!0,phone_verification_type:e}),i(!1)},primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Resend code"}),buttonColor:"coral",secondaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Send code via {{phone_verification_type}}",values:{phone_verification_type:b((0,O.E0)(d===c.VERIFICATION_SERVICES.SMS?c.VERIFICATION_SERVICES.WHATSAPP:c.VERIFICATION_SERVICES.SMS))}}),showCrossIcon:!0,toggleModal:()=>i(!1),children:(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Didn't receive a code?"})})})},k=(0,d.observer)((e=>{let{should_show_phone_number_verified_modal:t}=e;const i=(0,a.useHistory)(),n=localStorage.getItem("routes_from_notification_to_pnv"),s=n!==c.routes.personal_details&&n!==c.routes.phone_verification&&!!n,[l]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"enable_country_code_dropdown"}),{isMobile:_}=(0,h.Y)(),{ui:p,client:{account_settings:v}}=(0,d.useStore)(),{setIsPhoneVerificationCompleted:b,setShouldShowPhoneNumberOTP:x}=p,{trackPhoneVerificationEvents:j}=(0,r.usePhoneVerificationAnalytics)();return(0,o.useEffect)((()=>{t&&(j({action:"open",subform_name:"verification_successful"}),x(!1),b(!0))}),[t,j]),(0,I.jsxs)(f.M,{isMobile:_,isOpened:t,showHandleBar:!1,showCrossIcon:!1,isNonExpandable:!0,buttonColor:"coral",primaryButtonCallback:()=>{localStorage.removeItem("routes_from_notification_to_pnv"),s?i.push(n):i.push(c.routes.traders_hub)},primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"OK"}),disableCloseOnOverlay:!0,children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Phone number verified"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)("div",{className:"phone-verification__verified-modal--contents",children:(0,I.jsxs)("div",{className:"phone-verification__verified-modal--contents__phone-number-container",children:[(0,I.jsx)("div",{className:"phone-verification__verified-modal--contents__phone-number-container__phone-number",children:l?`+${v?.calling_country_code}${v?.phone}`:`${v?.phone}`}),"Â ",(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:" is verified as your phone number."})})]})})})]})})),T=(0,d.observer)((e=>{let{show_cool_down_period_modal:t,setShowCoolDownPeriodModal:i}=e;const{ui:o}=(0,d.useStore)(),n=(0,V.useHistory)(),a=localStorage.getItem("routes_from_notification_to_pnv"),s=a!==c.routes.personal_details&&a!==c.routes.phone_verification&&!!a,{isMobile:r}=(0,h.Y)(),{setIsForcedToExitPnv:l,setShouldShowPhoneNumberOTP:_}=o;return(0,I.jsxs)(f.M,{isOpened:t,isMobile:r,showCrossIcon:!1,showHandleBar:!1,isNonExpandable:!0,primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"OK"}),primaryButtonCallback:()=>{_(!1),l(!1),i(!1),localStorage.removeItem("routes_from_notification_to_pnv"),s?n.push(a):n.push(c.routes.traders_hub)},disableCloseOnOverlay:!0,buttonColor:"coral",children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"OTP limit reached"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:"Request a new OTP after 10 minutes."})})})]})})),A=(0,d.observer)((e=>{let{phone_verification_type:t,setOtpVerification:i}=e;const{client:n,ui:a}=(0,d.useStore)(),{setVerificationCode:s,is_authorize:l}=n,{data:_,invalidate:h}=(0,r.useSettings)(),[p,v]=(0,o.useState)(!1),[b,x]=(0,o.useState)(""),[j,w]=(0,o.useState)(!1),{trackPhoneVerificationEvents:E}=(0,r.usePhoneVerificationAnalytics)(),{localize:S}=(0,m.useTranslations)(),y=(0,c.useIsMounted)(),[C]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"enable_country_code_dropdown"}),{sendPhoneOTPVerification:M,phone_otp_error_message:V,setPhoneOtpErrorMessage:P,is_phone_number_verified:z,is_email_verified:A,show_cool_down_period_modal:B,setShowCoolDownPeriodModal:R,sendEmailOTPVerification:q,requestOnSMS:F,requestOnWhatsApp:$,email_otp_error:H,reset:G}=(0,r.useSendOTPVerificationCode)(),{setNextEmailOtpRequestTimer:D,is_email_otp_timer_loading:W,setNextPhoneOtpRequestTimer:Y,is_phone_otp_timer_loading:K}=(0,r.usePhoneNumberVerificationSetTimer)(),{should_show_phone_number_otp:U,setIsForcedToExitPnv:X}=a,J=(0,o.useCallback)((()=>{h("get_settings").then((()=>{y()&&w(!1)}))}),[h]);(0,o.useEffect)((()=>{H&&E({action:"error",subform_name:U?"verify_phone_otp_screen":"verify_email_screen",error_code:H.code})}),[H,E,U]),(0,o.useEffect)((()=>{E(U?{action:"open",subform_name:"verify_phone_otp_screen"}:{action:"open",subform_name:"verify_email_screen"})}),[U,E]),(0,o.useEffect)((()=>{l&&(w(!0),J())}),[J,l]),(0,o.useEffect)((()=>{z?X(!0):A&&!U&&(s(b,"phone_number_verification"),i({show_otp_verification:!1,phone_verification_type:""}))}),[z,A,i,U]);const Q=()=>{x(""),P(""),U?Y(void 0):D(void 0),G()},Z=()=>{U?(E({action:"click_cta",subform_name:"verify_phone_otp_screen"}),M(b)):(E({action:"click_cta",subform_name:"verify_email_screen"}),q(b))};return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(T,{show_cool_down_period_modal:B,setShowCoolDownPeriodModal:R}),(0,I.jsx)(k,{should_show_phone_number_verified_modal:z}),U&&(0,I.jsx)(L,{clearOtpValue:Q,setIsButtonDisabled:w,reInitializeGetSettings:J,requestOnSMS:F,requestOnWhatsApp:$,email_otp_error:H,is_email_verified:A,should_show_didnt_get_the_code_modal:p,setShouldShowDidntGetTheCodeModal:v,phone_verification_type:t,setOtpVerification:i}),(0,I.jsx)(u.E,{bold:!0,children:U?(0,I.jsx)(m.Localize,{i18n_default_text:"Step 3 of 3: Verify your number"}):(0,I.jsx)(m.Localize,{i18n_default_text:"Step 1 of 3: Email verification needed"})}),(0,I.jsx)("div",{className:"phone-verification__card--email-verification-content",children:U?(0,I.jsx)(u.E,{size:"sm",children:(0,I.jsx)(m.Localize,{i18n_default_text:"Enter the 6-digit code sent to you via {{phone_verification_type}} at <1>{{users_phone_number}}</1>. <0></0>",values:{phone_verification_type:S((0,O.E0)(t)),users_phone_number:C?`+${_?.calling_country_code}${_?.phone}`:`${_?.phone}`},components:[(0,I.jsx)(g.$n,{variant:"tertiary",label:S("Edit number"),size:"sm",color:"black-white",onClick:()=>i({show_otp_verification:!1,phone_verification_type:t})},0),(0,I.jsx)("span",{className:"phone-verification__card--email-verification-content__phone-number"},1)]})}):(0,I.jsxs)(o.Fragment,{children:[(0,I.jsx)(u.E,{size:"sm",children:(0,I.jsx)(m.Localize,{i18n_default_text:"We've sent a verification code to <0>{{users_email}}</0>.",values:{users_email:_?.email},components:[(0,I.jsx)("strong",{},0)]})}),(0,I.jsx)(u.E,{size:"sm",children:(0,I.jsx)(m.Localize,{i18n_default_text:"Enter the code below to verify it's you."})})]})}),(0,I.jsxs)("div",{className:"phone-verification__card--email-verification-otp-container",children:[(0,I.jsx)(f.c,{status:V?"error":"neutral",buttonLabel:S("Verify"),label:S(U?"OTP code":"Verification code"),buttonCallback:Z,onKeyDown:e=>{"Enter"===e.key&&Z()},inputMode:"numeric",buttonColor:"coral",onChange:e=>{x(e.target.value),P("")},message:V,value:b,type:"number",maxLength:6,buttonDisabled:b.length<6}),(0,I.jsx)(N,{clearOtpValue:Q,is_button_disabled:j||(U?K:W),setIsButtonDisabled:w,should_show_resend_code_button:!U,setShouldShowDidntGetTheCodeModal:v,reInitializeGetSettings:J})]})]})})),B=(0,d.observer)((e=>{let{is_at_otp_verification:t}=e;const{isMobile:i}=(0,h.Y)(),n=(0,V.useHistory)(),{localize:a}=(0,m.useTranslations)(),{should_show_session_timeout_modal:s}=(0,r.usePhoneNumberVerificationSessionTimer)(),{ui:l}=(0,d.useStore)(),{is_phone_verification_completed:_,setShouldShowPhoneNumberOTP:p,setIsForcedToExitPnv:v,should_show_phone_number_otp:b}=l,{trackPhoneVerificationEvents:x}=(0,r.usePhoneVerificationAnalytics)();return(0,o.useEffect)((()=>{s&&(v(!0),x({action:"open_session_expired_popup",subform_name:t?b?"verify_phone_otp_screen":"verify_email_screen":"verify_phone_screen"}))}),[s,x]),(0,I.jsxs)(f.M,{isMobile:i,isOpened:s&&!_,showCrossIcon:!1,showHandleBar:!1,isNonExpandable:!0,primaryButtonCallback:()=>{v(!1),p(!1),n.push(c.routes.personal_details)},primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"OK"}),buttonColor:"coral",title:a("Session Expired"),disableCloseOnOverlay:!0,children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Session expired"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:"Restart your phone number verification."})})})]})})),R=(0,d.observer)((e=>{let{should_show_verification_link_expired_modal:t,setShouldShowVerificationLinkExpiredModal:i}=e;const n=(0,V.useHistory)(),{ui:a}=(0,d.useStore)(),{setIsForcedToExitPnv:s}=a,{sendPhoneNumberVerifyEmail:l,WS:_}=(0,r.useVerifyEmail)("phone_number_verification"),{next_email_otp_request_timer:p,is_email_otp_timer_loading:v,setNextEmailOtpRequestTimer:b}=(0,r.usePhoneNumberVerificationSetTimer)(),{invalidate:x}=(0,r.useSettings)(),{isMobile:j}=(0,h.Y)(),{localize:g}=(0,m.useTranslations)();return(0,o.useEffect)((()=>{_.isSuccess&&x("get_settings").then((()=>i(!1)))}),[_.isSuccess,x]),(0,I.jsxs)(f.M,{isMobile:j,isOpened:t,isPrimaryButtonDisabled:!!p||v,buttonColor:"coral",showCrossIcon:!1,showHandleBar:!1,disableCloseOnOverlay:!0,isNonExpandable:!0,primaryButtonCallback:()=>{l(),b(void 0),s(!1)},primaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Send new link{{next_email_attempt_timestamp}}",values:{next_email_attempt_timestamp:(()=>{let e="";return e=p?p<60?`${g(" in ")}${p}s`:`${g(" in ")}${Math.round(p/60)}m`:"",e})()}}),toggleModal:()=>i(!1),showSecondaryButton:!0,secondaryButtonLabel:(0,I.jsx)(m.Localize,{i18n_default_text:"Cancel"}),secondaryButtonCallback:()=>{s(!1),i(!1),n.push(c.routes.personal_details)},children:[(0,I.jsx)(f.M.Header,{title:(0,I.jsx)(m.Localize,{i18n_default_text:"Link expired"})}),(0,I.jsx)(f.M.Body,{children:(0,I.jsx)("div",{className:"phone-verification__cancel-modal--contents",children:(0,I.jsx)(u.E,{children:(0,I.jsx)(m.Localize,{i18n_default_text:"Request a new verification link via email."})})})})]})}));var q=i("../../../node_modules/@deriv-com/quill-ui/dist/LabelPairedCircleInfoSmRegularIcon-CnUvtxa5.js");const F=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 4.625a6.11 6.11 0 0 0-5.305 3.063c-1.12 1.914-1.12 4.238 0 6.125C2.79 15.727 4.785 16.875 7 16.875a6.04 6.04 0 0 0 5.277-3.062c1.121-1.887 1.121-4.211 0-6.126A6.1 6.1 0 0 0 7 4.626M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m2.926-8.422-3.5 3.5a.463.463 0 0 1-.63 0l-1.75-1.75a.463.463 0 0 1 0-.629.463.463 0 0 1 .63 0l1.449 1.45 3.172-3.2a.463.463 0 0 1 .629 0 .463.463 0 0 1 0 .63"})),o.createElement("defs",null,o.createElement("clipPath",{id:"9dd3266b3a0417e9963724a864a443a9__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),$=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 5.063c-2.05 0-3.91 1.093-4.95 2.843a5.71 5.71 0 0 0 0 5.688A5.7 5.7 0 0 0 7 16.438a5.68 5.68 0 0 0 4.922-2.844 5.71 5.71 0 0 0 0-5.688C10.882 6.156 9.023 5.063 7 5.063M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m3.09-8.285-3.5 3.5c-.274.273-.684.273-.93 0l-1.75-1.75a.6.6 0 0 1 0-.902c.246-.274.656-.274.93 0l1.285 1.285L9.16 8.562c.246-.273.656-.273.93 0a.644.644 0 0 1 0 .903"})),o.createElement("defs",null,o.createElement("clipPath",{id:"9667f2bfeac4e36d18c79ef42cdab30a__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),H=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M.93 15.262c-.055.082-.055.164-.055.246 0 .273.219.52.492.52h11.238c.274 0 .52-.247.52-.52a.44.44 0 0 0-.082-.246L7.547 5.828A.66.66 0 0 0 7 5.5a.67.67 0 0 0-.574.328zm-.766-.438L5.66 5.391A1.57 1.57 0 0 1 7 4.625c.52 0 1.04.3 1.313.766l5.496 9.433c.109.192.191.438.191.684 0 .765-.629 1.367-1.395 1.367H1.367A1.354 1.354 0 0 1 0 15.508c0-.246.055-.492.164-.684M7 8.125a.47.47 0 0 1 .438.438v3.5A.45.45 0 0 1 7 12.5a.43.43 0 0 1-.437-.437v-3.5A.45.45 0 0 1 7 8.124m-.656 6.125c0-.355.273-.656.656-.656.355 0 .656.3.656.656 0 .383-.3.656-.656.656a.63.63 0 0 1-.656-.656"})),o.createElement("defs",null,o.createElement("clipPath",{id:"0c2f8e90d9f75dcf30ea1d2e60f5d0d9__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),G=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"m6.781 6.074-5.414 8.887c-.054.082-.054.137-.054.219 0 .218.164.383.382.383h10.582c.22 0 .41-.165.41-.383 0-.082-.027-.137-.082-.22L7.192 6.075A.21.21 0 0 0 7 5.938c-.11 0-.164.054-.219.136m-1.12-.683A1.57 1.57 0 0 1 7 4.625c.52 0 1.04.3 1.313.766l5.414 8.886c.164.274.273.575.273.903 0 .93-.766 1.695-1.723 1.695H1.695C.765 16.875 0 16.109 0 15.18q0-.493.246-.903zm2.214 8.422c0 .492-.41.874-.875.874a.864.864 0 0 1-.875-.874c0-.465.383-.876.875-.876a.9.9 0 0 1 .875.876M7.656 8.78v2.625c0 .383-.3.656-.656.656a.63.63 0 0 1-.656-.656V8.781c0-.355.273-.656.656-.656.355 0 .656.3.656.656"})),o.createElement("defs",null,o.createElement("clipPath",{id:"48f2db37f605b08a690e0494ee27901d__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),D=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 4.625a6.11 6.11 0 0 0-5.305 3.063c-1.12 1.914-1.12 4.238 0 6.125C2.79 15.727 4.785 16.875 7 16.875a6.04 6.04 0 0 0 5.277-3.062c1.121-1.887 1.121-4.211 0-6.126A6.1 6.1 0 0 0 7 4.626M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m0-10.5a.47.47 0 0 1 .438.438v3.5a.45.45 0 0 1-.438.437.43.43 0 0 1-.437-.437v-3.5A.45.45 0 0 1 7 7.25m.656 6.125c0 .383-.3.656-.656.656a.63.63 0 0 1-.656-.656c0-.355.273-.656.656-.656.355 0 .656.3.656.656"})),o.createElement("defs",null,o.createElement("clipPath",{id:"a7482d221eb247f9f8bcd9c9acfe3778__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),W=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 5.063c-2.05 0-3.91 1.093-4.95 2.843a5.71 5.71 0 0 0 0 5.688A5.7 5.7 0 0 0 7 16.438a5.68 5.68 0 0 0 4.922-2.844 5.71 5.71 0 0 0 0-5.688C10.882 6.156 9.023 5.063 7 5.063M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m0-10.5c.355 0 .656.3.656.656v3.063c0 .383-.3.656-.656.656a.63.63 0 0 1-.656-.656V7.906c0-.355.273-.656.656-.656m.875 6.125c0 .492-.41.875-.875.875a.864.864 0 0 1-.875-.875c0-.465.383-.875.875-.875a.9.9 0 0 1 .875.875"})),o.createElement("defs",null,o.createElement("clipPath",{id:"899cb56538ebdf1d12f18f1e915b18f9__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),Y=(0,o.forwardRef)((({title:e,titleId:t,...i},n)=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:14,height:22,viewBox:"0 0 14 22",role:"img",ref:n,"aria-labelledby":t,...i},e?o.createElement("title",{id:t},e):null,o.createElement("g",null,o.createElement("path",{d:"M7 5.063c-2.05 0-3.91 1.093-4.95 2.843a5.71 5.71 0 0 0 0 5.688A5.7 5.7 0 0 0 7 16.438a5.68 5.68 0 0 0 4.922-2.844 5.71 5.71 0 0 0 0-5.688C10.882 6.156 9.023 5.063 7 5.063M7 17.75a6.96 6.96 0 0 1-6.07-3.5c-1.258-2.16-1.258-4.812 0-7A7.02 7.02 0 0 1 7 3.75c2.488 0 4.785 1.34 6.043 3.5 1.258 2.188 1.258 4.84 0 7A6.95 6.95 0 0 1 7 17.75m-1.094-4.812h.657v-1.75h-.657a.63.63 0 0 1-.656-.657c0-.355.273-.656.656-.656H7.22c.355 0 .656.3.656.656v2.406h.219c.355 0 .656.301.656.657 0 .383-.3.656-.656.656H5.906a.63.63 0 0 1-.656-.656c0-.356.273-.656.656-.656M7 9a.864.864 0 0 1-.875-.875c0-.465.383-.875.875-.875a.9.9 0 0 1 .875.875c0 .492-.41.875-.875.875"})),o.createElement("defs",null,o.createElement("clipPath",{id:"6bb7294d410046a35078a61ab3d31971__a"},o.createElement("path",{d:"M0 0h14v22H0z"})))))),K=({icon:e,size:t,className:i,isBold:o,color:n})=>{const a={error:{bold:v.j.jsx(G,{}),regular:v.j.jsx(H,{})},warning:{bold:v.j.jsx(W,{}),regular:v.j.jsx(D,{})},success:{bold:v.j.jsx($,{}),regular:v.j.jsx(F,{})},info:{bold:v.j.jsx(Y,{}),regular:v.j.jsx(q.F,{})}};let s;return s="custom"===n?e:a[n??"success"][o?"bold":"regular"],v.j.jsx(v.j.Fragment,{children:e&&"custom"===n?v.j.jsx("div",{className:(0,x.c)("tag__icon",`tag__icon--${t}`,i),children:e}):v.j.jsx(v.j.Fragment,{children:s&&v.j.jsx("div",{className:(0,x.c)("tag__icon",`tag__color--${n}-svg`,`tag__icon--${t}`),children:s})})})},U=(0,o.forwardRef)((({label:e,className:t,variant:i="fill",size:o="md",color:n="success",isBold:a=!1,icon:s,iconClassName:r,showIcon:l=!0,...c},d)=>{const _="custom"===i?"custom":n;return v.j.jsxs("div",{className:(0,x.c)(t,"tag",`tag__size-${o}`,`tag__color--${_}`,`tag__color--${_}-${i}`),style:"custom"===i?{backgroundColor:n}:void 0,...c,ref:d,children:[l&&v.j.jsx(K,{isBold:a,className:r,icon:s,color:_,size:o}),"string"!=typeof e?e:v.j.jsx(v.j.Fragment,{children:"sm"===o||"xs"===o?v.j.jsx(z.O,{bold:a,color:_,children:e}):v.j.jsx(u.E,{size:"md"===o?"sm":"md",bold:a,color:_,children:e})})]})}));U.displayName="Tag";const X=e=>{let{children:t,is_small_card:i}=e;const{formatted_time:o}=(0,r.usePhoneNumberVerificationSessionTimer)();return(0,I.jsxs)("div",{className:(0,p.A)("phone-verification__card",{"phone-verification__card--small-card":i}),children:[(0,I.jsx)("div",{className:"phone-verification__card--session-timeout-component",children:(0,I.jsx)(U,{showIcon:!1,size:"sm",variant:"custom",color:"#f5f5f5",label:(0,I.jsx)(m.Localize,{i18n_default_text:"Time remaining: {{time_remaining}}",values:{time_remaining:o}})})}),t]})},J=(0,d.observer)((()=>{const e=(0,a.useHistory)(),[t,i]=(0,o.useState)({show_otp_verification:!0,phone_verification_type:""}),n=sessionStorage.getItem("phone_number_verification_code"),[p,f]=(0,o.useState)(!1),[v,b]=(0,o.useState)(!1),{sendEmailOTPVerification:x,email_otp_error:j,is_email_verified:g}=(0,r.useSendOTPVerificationCode)(),{is_phone_number_verified:w}=(0,r.useIsPhoneNumberVerified)(),[E,S]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"phone_number_verification"}),[y,C]=(0,r.useGrowthbookGetFeatureValue)({featureFlag:"enable_country_code_dropdown"}),{isDesktop:V}=(0,h.Y)(),{client:O,ui:z}=(0,d.useStore)(),{is_redirected_from_email:N,setRedirectFromEmail:L,setIsForcedToExitPnv:k}=z,{verification_code:{phone_number_verification:T},is_authorize:q,is_virtual:F,setVerificationCode:$,phone_settings:H}=O,G=H?.carriers&&0===H?.carriers.length;return(0,o.useEffect)((()=>{(S&&!E||F||w||C&&!y&&G)&&(k(!0),e.push(c.routes.personal_details))}),[S,E,F,e,w]),(0,o.useEffect)((()=>{(N||n)&&(f(!0),j?(f(!1),k(!0),b(!0),L(!1),sessionStorage.removeItem("phone_number_verification_code")):g?(f(!1),i({show_otp_verification:!1,phone_verification_type:""}),L(!1),sessionStorage.removeItem("phone_number_verification_code")):(T||n)&&q&&(n&&$(n,"phone_number_verification"),x(n||T)))}),[j,g,T,q,N,n]),p||!S?(0,I.jsx)(s.Loading,{is_fullscreen:!1}):(0,I.jsxs)("div",{children:[(0,I.jsx)(R,{should_show_verification_link_expired_modal:v,setShouldShowVerificationLinkExpiredModal:b}),!v&&(0,I.jsx)(B,{is_at_otp_verification:t.show_otp_verification}),(0,I.jsx)(P,{}),V&&(0,I.jsxs)("div",{className:"phone-verification__redirect_button",children:[(0,I.jsx)(_.K,{color:"black-white",variant:"tertiary",onClick:()=>{e.push(c.routes.personal_details)},icon:(0,I.jsx)(l.LabelPairedArrowLeftCaptionFillIcon,{width:24,height:24,"data-testid":"dt_phone_verification_back_btn",className:"phone-verification__redirect_button--icon"})}),(0,I.jsx)(u.E,{className:"phone-verification__redirect_button--text",bold:!0,children:(0,I.jsx)(m.Localize,{i18n_default_text:"Back to personal details"})})]}),(0,I.jsx)(X,{is_small_card:t.show_otp_verification,children:t.show_otp_verification?(0,I.jsx)(A,{phone_verification_type:t.phone_verification_type,setOtpVerification:i}):(0,I.jsx)(M,{show_confirm_phone_number:!t.show_otp_verification,setOtpVerification:i})})]})}))}}]);