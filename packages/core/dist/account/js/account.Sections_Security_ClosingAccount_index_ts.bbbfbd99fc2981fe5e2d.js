"use strict";(self.webpackChunk_deriv_account=self.webpackChunk_deriv_account||[]).push([["Sections_Security_ClosingAccount_index_ts"],{"./Sections/Security/ClosingAccount/index.ts":(e,t,a)=>{a.r(t),a.d(t,{default:()=>M});var n=a("react"),s=a("react-router-dom"),o=a("@deriv/stores"),c=a("@deriv-com/translations"),i=a("@deriv/components"),r=a("../../../node_modules/react/jsx-runtime.js");const l=e=>{let{redirectToReasons:t}=e;return(0,r.jsx)(i.Button,{className:"closing-account__button--close-account",large:!0,onClick:()=>t(),primary:!0,children:(0,r.jsx)(c.Localize,{i18n_default_text:"Close my account"})})},d=(0,o.observer)((e=>{let{redirectToReasons:t}=e;const{common:a}=(0,o.useStore)(),{is_from_derivgo:n}=a;return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"closing-account__information",children:(0,r.jsx)(i.Text,{size:"xs",weight:"bold",className:"closing-account__information--bold",as:"p",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Are you sure?"})})}),(0,r.jsxs)("div",{className:"closing-account__steps",children:[(0,r.jsx)(i.Text,{size:"xs",as:"p",className:"closing-account__title",children:(0,r.jsx)(c.Localize,{i18n_default_text:"If you close your account:"})}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:(0,r.jsx)(c.Localize,{i18n_default_text:"You can't trade on Deriv."})}),(0,r.jsx)("li",{children:(0,r.jsx)(c.Localize,{i18n_default_text:"You can't make transactions."})})]})]}),(0,r.jsxs)("div",{className:"closing-account__steps",children:[(0,r.jsx)(i.Text,{size:"xs",as:"p",line_height:"s",className:"closing-account__title",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Before closing your account:"})}),(0,r.jsxs)("ul",{children:[(0,r.jsx)("li",{children:(0,r.jsx)(c.Localize,{i18n_default_text:"Close all your positions."})}),(0,r.jsx)("li",{children:(0,r.jsx)(c.Localize,{i18n_default_text:"Withdraw your funds."})})]})]}),(0,r.jsx)("div",{className:"closing-account__steps",children:(0,r.jsx)(i.Text,{size:"xs",as:"p",line_height:"s",children:(0,r.jsx)(c.Localize,{i18n_default_text:"We shall delete your personal information as soon as our legal obligations are met, as mentioned in the section on Data Retention in our <0>Security and privacy policy</0>",components:[(0,r.jsx)(i.StaticUrl,{className:"link",href:"tnc/security-and-privacy.pdf",is_document:!0},0)]})})}),n?(0,r.jsx)("div",{className:"closing-account__buttons-container",children:(0,r.jsx)(l,{redirectToReasons:t})}):(0,r.jsxs)("div",{className:"closing-account__buttons-container",children:[(0,r.jsx)(s.Link,{to:"/",children:(0,r.jsx)(i.Button,{className:"closing-account__button--cancel",large:!0,secondary:!0,children:(0,r.jsx)(c.Localize,{i18n_default_text:"Cancel"})})}),(0,r.jsx)(l,{redirectToReasons:t})]})]})}));var u=a("@deriv/shared"),_=a("@deriv/api");const m=110,x="SET_CHECKBOX_DISABLED",p="SET_TOTAL_CHECKBOX_CHECKED",h="SET_REMAINING_CHARACTERS",g="SET_TOTAL_ACCUMULATED_CHARACTERS";var f=a("@deriv-com/utils");const j=e=>{let{currency_icon:t,loginid:a,title:n,value:s}=e;return(0,r.jsxs)("div",{className:"closing-account-error__container",children:[(0,r.jsxs)("div",{className:"closing-account-error__account-details",children:[(0,r.jsx)(i.Icon,{icon:t,size:24}),(0,r.jsxs)("div",{className:"closing-account-error__account",children:[(0,r.jsx)(i.Text,{line_height:"s",color:"prominent",size:"xs",children:n}),(0,r.jsx)(i.Text,{color:"prominent",size:"xxxs",line_height:"xs",children:a})]})]}),(0,r.jsx)(i.Text,{className:"closing-account-error__details",color:"prominent",size:"xs",line_height:"s",align:"right",children:s})]})},y=e=>{let{children:t,title:a,description:n}=e;return(0,r.jsxs)("div",{className:"closing-account-error",children:[(0,r.jsx)(i.Text,{as:"p",line_height:"s",size:"xs",weight:"bold",color:"prominent",className:"closing-account-error__title",children:a}),n&&(0,r.jsx)(i.Text,{as:"p",size:"xxs",className:"closing-account-error__description",children:n}),(0,r.jsx)("div",{className:"closing-account-error__wrapper",children:t})]})},b=(0,o.observer)((e=>{let{platform:t,account_balance:a}=e;const{traders_hub:n}=(0,o.useStore)(),{is_eu_user:s}=n,l=t===u.CFD_PLATFORMS.MT5;return(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Please withdraw your funds from the following {{platform_name}} account(s):",values:{platform_name:(0,u.getCFDPlatformLabel)(t)}}),children:a.map((e=>(0,r.jsx)(j,{currency_icon:(t=>{switch(t){case u.CFD_PLATFORMS.MT5:return`IcMt5-${(0,u.getMT5Icon)({market_type:e.market_type,is_eu:s,product:e.product})}`;case u.CFD_PLATFORMS.DXTRADE:return`IcDxtrade-${(0,u.getCFDAccount)({market_type:e.market_type,sub_account_type:e.sub_account_type,platform:t,is_eu:s})}`;case u.CFD_PLATFORMS.CTRADER:return"IcCtrader";default:return""}})(t),loginid:e.display_login,title:(0,u.getCFDAccountDisplay)({market_type:e.market_type,sub_account_type:e.sub_account_type,platform:t,shortcode:l?e.landing_company_short:void 0,is_eu:s,product:e.product})??"",value:e.currency&&(0,r.jsx)(i.Money,{currency:e.currency,amount:f.FormatUtils.formatMoney(e.balance??0,{currency:e.currency}),should_format:!1})},e.login)))})})),v=(0,o.observer)((e=>{let{platform:t,open_positions:a}=e;const{traders_hub:n}=(0,o.useStore)(),{is_eu_user:s}=n,i=t===u.CFD_PLATFORMS.MT5;return(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Please close your positions in the following {{platform_name}} account(s):",values:{platform_name:(0,u.getCFDPlatformLabel)(t)}}),children:a.map((e=>(0,r.jsx)(j,{currency_icon:(t=>{switch(t){case u.CFD_PLATFORMS.MT5:return`IcMt5-${(0,u.getMT5Icon)({market_type:e.market_type,is_eu:s,product:e.product})}`;case u.CFD_PLATFORMS.DXTRADE:return`IcDxtrade-${(0,u.getCFDAccount)({market_type:e.market_type,sub_account_type:e.sub_account_type,platform:t,is_eu:s})}`;case u.CFD_PLATFORMS.CTRADER:return"IcCtrader";default:return""}})(t),loginid:e.display_login,title:(0,u.getCFDAccountDisplay)({market_type:e.market_type,sub_account_type:e.sub_account_type,platform:t,shortcode:i?e.landing_company_short:void 0,is_eu:s,product:e.product})??"",value:(0,r.jsx)(c.Localize,{i18n_default_text:"{{number_of_positions}} position(s)",values:{number_of_positions:e.positions}})},e.login)))})})),C=(e,t)=>e.find((e=>e.loginid===t)),T=(e,t)=>e.find((e=>e.login===t)),w=(e,t)=>e.find((e=>e.account_id===t)),L=(0,o.observer)((e=>{let{details:t,onConfirm:a}=e;const{client:s}=(0,o.useStore)(),{dxtrade_accounts_list:l,mt5_login_list:d,account_list:_,ctrader_accounts_list:m}=s;let x=[],p=[],h=[],g=[],L=[],z=[],k=[],D=[],F=[];return t?.pending_withdrawals&&Object.keys(t.pending_withdrawals).forEach((e=>{const a={withdrawals:t.pending_withdrawals?.[e]},n=C(_,e);n&&(h=[...h,{...n,...a}])})),t?.open_positions&&Object.keys(t.open_positions).forEach((e=>{const a={positions:t.open_positions?.[e]},n=C(_,e);if(n)x=[...x,{...n,...a}];else{const t=T(d,e);t&&(g=[...g,{...t,...a}]);const n=w(l,e);n&&(z=[...z,{...n,...a}]);const s=w(m,e);s&&(D=[...D,{...s,...a}])}})),t?.balance&&Object.keys(t.balance).forEach((e=>{const a={balance:t.balance?.[e].balance,currency:t.balance?.[e].currency},n=C(_,e);if(n)p=[...p,{...n,...a}];else{const t=T(d,e);t&&(L=[...L,{...t,...a}]);const n=w(l,e);n&&(k=[...k,{...n,...a}]);const s=w(m,e);s&&(F=[...F,{...s,...a}])}})),(0,r.jsxs)(n.Fragment,{children:[(0,r.jsxs)(i.ThemedScrollbars,{autohide:!1,width:"43rem",children:[!!x.length&&(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Please close your positions in the following Deriv account(s):"}),children:x.map((e=>(0,r.jsx)(j,{currency_icon:`IcCurrency-${e.icon}`,loginid:e.loginid,title:e.title,value:(0,r.jsx)(c.Localize,{i18n_default_text:"{{number_of_positions}} position(s)",values:{number_of_positions:e.positions}})},e.loginid)))}),!!p.length&&(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Please withdraw your funds from the following Deriv account(s):"}),children:p.map((e=>(0,r.jsx)(j,{currency_icon:`IcCurrency-${e.icon}`,loginid:e.loginid,title:e.title,value:e.currency&&(0,r.jsx)(i.Money,{currency:e.currency,amount:f.FormatUtils.formatMoney(e.balance??0,{currency:e.currency}),should_format:!1})},e.loginid)))}),!!g.length&&(0,r.jsx)(v,{platform:u.CFD_PLATFORMS.MT5,open_positions:g}),!!L.length&&(0,r.jsx)(b,{platform:u.CFD_PLATFORMS.MT5,account_balance:L}),!!z.length&&(0,r.jsx)(v,{platform:u.CFD_PLATFORMS.DXTRADE,open_positions:z}),!!k.length&&(0,r.jsx)(b,{platform:u.CFD_PLATFORMS.DXTRADE,account_balance:k}),!!D.length&&(0,r.jsx)(v,{platform:u.CFD_PLATFORMS.CTRADER,open_positions:D}),!!F.length&&(0,r.jsx)(b,{platform:u.CFD_PLATFORMS.CTRADER,account_balance:F}),!!h.length&&(0,r.jsx)(y,{title:(0,r.jsx)(c.Localize,{i18n_default_text:"Pending withdrawal request:"}),description:(0,r.jsx)(c.Localize,{i18n_default_text:"We are still processing your withdrawal request.<0 />Please wait for the transaction to be completed before deactivating your account.",components:[(0,r.jsx)("br",{},0)]}),children:h.map((e=>(0,r.jsx)(j,{currency_icon:`IcCurrency-${e.icon}`,loginid:e.loginid,title:e.title,value:(0,r.jsx)(c.Localize,{i18n_default_text:"{{pending_withdrawals}} pending withdrawal(s)",values:{pending_withdrawals:e.withdrawals}})},e.loginid)))})]}),(0,r.jsx)("div",{children:(0,r.jsx)(i.Button,{className:"closing-account-error__button",primary:!0,onClick:a,children:(0,r.jsx)(c.Localize,{i18n_default_text:"OK"})})})]})}));var z=a("formik");const k={"financial-priorities":!1,"stop-trading":!1,"not-interested":!1,"another-website":!1,"not-user-friendly":!1,"difficult-transactions":!1,"lack-of-features":!1,"unsatisfactory-service":!1,"other-reasons":!1,other_trading_platforms:"",do_to_improve:""},D={is_checkbox_disabled:!1,total_checkbox_checked:0,remaining_characters:m,total_accumulated_characters:0},F=(e,t)=>{switch(t.type){case x:return{...e,is_checkbox_disabled:t.payload};case p:return{...e,total_checkbox_checked:t.payload};case h:return{...e,remaining_characters:t.payload};case g:return{...e,total_accumulated_characters:t.payload};default:return e}},A=e=>{let{onBackClick:t,onConfirmClick:a}=e;const[s,o]=(0,n.useReducer)(F,D),{localize:l}=(0,c.useTranslations)(),{is_checkbox_disabled:d,total_checkbox_checked:u,remaining_characters:_,total_accumulated_characters:f}=s;(0,n.useEffect)((()=>{3===u?o({type:x,payload:!0}):d&&o({type:x,payload:!1})}),[u,d]);const j=(e,t,a)=>{const n=e.target.value,s=t.length>n.length;(_<=0||f>=m)&&!s?e.preventDefault():a(e)},y=async e=>{const t=e.clipboardData.getData("text")||await navigator.clipboard.readText();(_<=0||t.length>_)&&e.preventDefault()},b=e=>{let t=v(e).map((e=>e[0])).toString();const a=!!e.other_trading_platforms.length,n=!!e.do_to_improve.length;return a&&(t=`${t}, ${e.other_trading_platforms}`),n&&(t=`${t}, ${e.do_to_improve}`),t.replace(/(\r\n|\n|\r)/gm," ")},v=e=>Object.entries(e).filter((e=>{let[t,a]=e;return!["other_trading_platforms","do_to_improve"].includes(t)&&a}));return(0,r.jsx)(z.Formik,{initialValues:k,validate:e=>{const t={},a=v(e).length,n=(e.other_trading_platforms+e.do_to_improve).length;let s=m-n;if(a){const a=b(e);s=s>=0?s:0,/^[a-zA-Z0-9.,'\-\s]*$/.test(a)||(t.characters_limits=l("Must be numbers, letters, and special characters . , ' -"))}else t.empty_reason=l("Please select at least one reason");return o({type:g,payload:n}),o({type:h,payload:s}),t},onSubmit:e=>{const t=b(e);a(t)},children:e=>{let{values:a,setFieldValue:n,errors:s,handleChange:x,dirty:h,isValid:g}=e;return(0,r.jsxs)(z.Form,{children:[[{name:"financial-priorities",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I have other financial priorities."})},{name:"stop-trading",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I want to stop myself from trading."})},{name:"not-interested",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I’m no longer interested in trading."})},{name:"another-website",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I prefer another trading website."})},{name:"not-user-friendly",label:(0,r.jsx)(c.Localize,{i18n_default_text:"The platforms aren’t user-friendly."})},{name:"difficult-transactions",label:(0,r.jsx)(c.Localize,{i18n_default_text:"Making deposits and withdrawals is difficult."})},{name:"lack-of-features",label:(0,r.jsx)(c.Localize,{i18n_default_text:"The platforms lack key features or functionality."})},{name:"unsatisfactory-service",label:(0,r.jsx)(c.Localize,{i18n_default_text:"Customer service was unsatisfactory."})},{name:"other-reasons",label:(0,r.jsx)(c.Localize,{i18n_default_text:"I’m closing my account for other reasons."})}].map((e=>(0,r.jsx)(z.Field,{name:e.name,children:t=>{let{field:s}=t;return(0,r.jsx)(i.Checkbox,{...s,disabled:d&&!a[s.name],className:"closing-account-reasons__checkbox",label:e.label,onChange:()=>{((e,t,a)=>{e[t]?(o({type:p,payload:u-1}),a(t,!e[t])):(o({type:p,payload:u+1}),a(t,!e[t]))})(a,s.name,n)}})}},e.name))),(0,r.jsx)(z.Field,{name:"other_trading_platforms",children:e=>{let{field:t}=e;return(0,r.jsx)(i.Input,{...t,className:"closing-account-reasons__input","data-lpignore":"true",autoComplete:"off",type:"textarea",placeholder:l("If you don’t mind sharing, which other trading platforms do you use?"),name:"other_trading_platforms",value:a.other_trading_platforms,max_characters:m,onChange:e=>j(e,a.other_trading_platforms,x),onPaste:y})}}),(0,r.jsx)(z.Field,{name:"do_to_improve",children:e=>{let{field:t}=e;return(0,r.jsx)(i.Input,{...t,className:"closing-account-reasons__input","data-lpignore":"true",autoComplete:"off",type:"textarea",placeholder:l("What could we do to improve?"),name:"do_to_improve",value:a.do_to_improve,max_characters:m,onChange:e=>j(e,a.do_to_improve,x),onPaste:y})}}),(0,r.jsxs)("div",{className:"closing-account-reasons__footer",children:[(0,r.jsxs)("div",{className:"closing-account-reasons__hint-wrapper",children:[(0,r.jsx)(i.Text,{size:"xxs",as:"p",color:"less-prominent",className:"closing-account-reasons__hint",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Remaining characters: {{remaining_characters}}",values:{remaining_characters:_}})}),!g&&Object.entries(s).map((e=>{let[t,a]=e;return(0,r.jsx)(i.Text,{as:"p",weight:"bold",size:"xs",color:"loss-danger",className:"closing-account-reasons__error",children:a},t)}))]}),(0,r.jsx)(i.FormSubmitButton,{is_disabled:!h||!g,label:l("Continue"),has_cancel:!0,cancel_label:l("Back"),onCancel:t})]})]})}})},S=e=>{let{show_warning_modal:t,startDeactivating:a,closeWarningModal:n}=e;const{localize:s}=(0,c.useTranslations)();return(0,r.jsx)(i.Modal,{className:"closing-account-reasons",is_open:t,toggleModal:n,children:(0,r.jsxs)("div",{className:"account-closure-warning-modal",children:[(0,r.jsx)(i.Icon,{icon:"IcRedWarning",size:96}),(0,r.jsx)(i.Text,{size:"xs",weight:"bold",className:"account-closure-warning-modal__warning-message",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Close your account?"})}),(0,r.jsx)("div",{className:"account-closure-warning-modal__content-wrapper",children:(0,r.jsx)(i.Text,{as:"p",align:"center",className:"account-closure-warning-modal__content",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Closing your account will automatically log you out. We shall delete your personal information as soon as our legal obligations are met."})})}),(0,r.jsx)(i.FormSubmitButton,{label:s("Close account"),className:"account-closure-warning-modal__close-account-button",has_cancel:!0,cancel_label:s("Go Back"),onClick:a,onCancel:n})]})})},N=e=>{let{message:t,onClick:a}=e;return(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)("div",{className:"closing-account-error__container closing-account-error__container-message",children:(0,r.jsx)("div",{className:"closing-account-error__details closing-account-error__details-message",children:(0,r.jsx)(i.Text,{size:"xs",children:t})})}),(0,r.jsx)("div",{children:(0,r.jsx)(i.Button,{className:"closing-account-error__button",primary:!0,onClick:a,children:(0,r.jsx)(c.Localize,{i18n_default_text:"OK"})})})]})},R=e=>{let{redirectToSteps:t}=e;const{mutate:a,error:o,isSuccess:l,isLoading:d}=(0,_.useCloseDerivAccount)(),[m,x]=(0,n.useState)(""),[p,h]=(0,n.useState)(""),[g,f]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(o&&"object"==typeof o&&"code"in o){const{code:e}=o;h("AccountHasPendingConditions"===e?"account_has_pending_conditions_modal":"MT5AccountInaccessible"===e?"inaccessible_modal":"error_modal")}}),[o]);const j=()=>{h("")},y=()=>{f(!1)};return l?(0,r.jsx)(s.Redirect,{to:u.routes.account_closed}):d?(0,r.jsx)(i.Loading,{is_fullscreen:!1}):(0,r.jsxs)("div",{className:"closing-account-reasons",children:[(0,r.jsx)(i.Text,{weight:"bold",size:"xs",className:"closing-account-reasons__title",as:"p",children:(0,r.jsx)(c.Localize,{i18n_default_text:"Please tell us why you’re leaving. (Select up to {{ allowed_reasons }} reasons.)",values:{allowed_reasons:3}})}),(0,r.jsx)(A,{onBackClick:t,onConfirmClick:e=>{f(!0),x(e)}}),g&&(0,r.jsx)(S,{show_warning_modal:g,closeWarningModal:y,startDeactivating:async()=>{y(),a({payload:{reason:m}})}}),(0,r.jsx)(i.Modal,{className:"closing-account-reasons",is_open:!!p,toggleModal:j,title:(()=>{if(!p)return"";switch(p){case"error_modal":return(0,r.jsx)(c.Localize,{i18n_default_text:"An error occurred"});case"inaccessible_modal":return(0,r.jsx)(c.Localize,{i18n_default_text:"Inaccessible MT5 account(s)"});default:return(0,r.jsx)(c.Localize,{i18n_default_text:"Action required"})}})(),children:(()=>{switch(p){case"account_has_pending_conditions_modal":return(0,r.jsx)(L,{details:o&&"object"==typeof o&&"details"in o&&"object"==typeof o.details?o.details:{},onConfirm:t});case"inaccessible_modal":return(0,r.jsx)(N,{message:o&&"object"==typeof o&&"message"in o&&"string"==typeof o.message?o.message:"",onClick:j});default:return null}})()})]})},M=()=>{const[e,t]=(0,n.useState)(!1);return(0,r.jsx)("div",{className:"closing-account","data-testid":"dt_closing_account",children:e?(0,r.jsx)(R,{redirectToSteps:()=>{t(!1)}}):(0,r.jsx)(d,{redirectToReasons:()=>{t(!0)}})})}}}]);